# 4.0 周期因子预测步骤

## 一、方案背景与目标

在余额宝申购/赎回等金融时序数据中，周期性规律（如月、周、节假日等）对资金流入流出有显著影响。基于3.7.1版本的特征工程与模型输出，我们拟制定一套以周期因子为核心的预测方案，旨在提升模型对周期性波动的捕捉能力，提高预测准确性和可解释性。

## 二、周期因子的定义与提取

1. **月周期因子**：
   - 通过`month_period`字段（如月初/中/末）构造。
   - 进一步细分为"月初效应""月末效应"等。
2. **周周期因子**：
   - 通过`weekday`字段（0-6，周一至周日）提取。
   - 捕捉工作日与周末的差异。
3. **节假日因子**：
   - 通过`is_holiday`、`is_workday_shift`等字段，标记法定节假日、调休补班、普通周末等。
   - 进一步引入"节前一天""节后第一天"等衍生因子。


## 三、特征工程

- **周期性特征构造**：
  - 结合原始数据user_balance_table.csv ，参考3.7.1_prophet_model yearly_f.pf中的特征工程，
  - 直接将`weekday`、`month_period`、`is_holiday`等作为分类变量输入模型。
  - 对于回归类模型，可用One-Hot编码、周期性正余弦变换（如sin/cos(2π*day/周期)）等方式增强表达。
- **先不与Prophet结合**：
  - Prophet本身支持年、月、周等季节性建模，也可通过`add_regressor`引入自定义周期因子。
  - 可将节假日、调休等作为holidays传入Prophet，或作为外部回归量。
- **分组均值/分位数法**：
  - 对历史数据按周期因子分组（如每周的周一、每月的月初等），计算均值/中位数作为基线预测。

## 四、预测建模流程

1. **数据准备**：
   - 基于原始数据user_balance_table.csv ，参考3.7.1_prophet_model yearly_f.pf中的特征工程，编写代码，提取周期性特征。
2. **特征分析**：
   - 可视化各周期因子与申购/赎回的关系，识别显著模式。
3. **建模方法选择**：
   - 实现周期因子的自动化提取与动态调整。
   - 使用周期因子进行预测
   
4. **模型训练与预测**：
   - 训练区间：2014-03-01至2014-08-31
   - 预测区间：2014-09-01至2014-10-10
   - 预测数据csv输出区间：2014-09-01至2014-9-30
5. **结果输出与评估**：
   - 输出预测结果csv、周期分解图、残差分析等。
   - 评估指标：RMSE、MAE、MAPE等。

