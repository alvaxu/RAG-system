# 7.0.1_fusion_model.py 程序说明书

## 一、程序功能与流程概述
本程序融合了Prophet模型与分组均值模型，对余额宝每日申购与赎回总额进行预测，采用固定权重加权融合，输出9月预测结果及多模型对比图。

## 二、特征工程
- **节假日特征**：利用`chinese_calendar`库自动生成2014-03-01至2014-09-30的法定节假日、调休补班日。
- **周期特征**：包括weekday、month_period（月内分段）、is_holiday、is_next_workday、is_month_end等。
- **特征输出**：所有特征工程结果均输出为csv，便于复用和分析。

## 三、融合模型选择与权重说明
- **模型类型**：Prophet（全局时序+节假日+周期）+ 分组均值法（周期+节假日分组），两者加权融合。
- **权重设置**：申购、赎回均为Prophet: 0.5，分组均值: 0.5（可调整）。
- **融合方式**：对每一天，融合预测 = Prophet预测 * 权重 + 分组均值预测 * (1-权重)。

## 四、训练与预测流程
- 训练区间：2014-03-01 ~ 2014-08-31
- 预测区间：2014-09-01 ~ 2014-09-30
- 训练流程：分别训练Prophet和分组均值模型，拟合历史数据。
- 预测流程：对全区间生成两种模型预测，再加权融合。
- 可视化：输出真实值、Prophet、分组均值、融合预测多模型对比图。

## 五、输入输出文件与格式
- 输入：
  - user_balance_table.csv（原始明细数据）
- 输出：
  - 7.0.1_feature_output/7.0.1_holidays.csv（节假日表）
  - 7.0.1_feature_output/7.0.1_daily_features.csv（特征工程结果）
  - 7.0.1_fusion_output/7.0.1_fusion_predict.csv（9月预测结果，竞赛格式）
  - 7.0.1_fusion_output/7.0.1_fusion_compare.png（多模型对比图）
  - 7.0.1_fusion_output/7.0.1_all_predictions_data.csv（全区间所有模型预测结果）

## 六、适用场景与局限性
- 适用于有明显周期性、节假日效应的金融时序预测。
- 融合模型提升了稳健性和泛化能力，但对突发性、结构性变化（如政策、活动）拟合有限。
- 仅基于全局序列，无法建模用户级异质性。 