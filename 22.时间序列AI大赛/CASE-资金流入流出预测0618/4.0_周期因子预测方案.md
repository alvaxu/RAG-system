# 4.0 周期因子预测方案

## 一、方案背景与目标

在余额宝申购/赎回等金融时序数据中，周期性规律（如月、周、节假日等）对资金流入流出有显著影响。基于3.7.1版本的特征工程与模型输出，我们拟制定一套以周期因子为核心的预测方案，旨在提升模型对周期性波动的捕捉能力，提高预测准确性和可解释性。

## 二、周期因子的定义与提取

1. **月周期因子**：
   - 通过`month_period`字段（如月初/中/末）或直接用每月的天数（1-31）构造。
   - 可进一步细分为"月初效应""月末效应"等。
2. **周周期因子**：
   - 通过`weekday`字段（0-6，周一至周日）提取。
   - 可捕捉工作日与周末的差异。
3. **节假日因子**：
   - 通过`is_holiday`、`is_workday_shift`等字段，标记法定节假日、调休补班、普通周末等。
   - 可进一步引入"节前一天""节后第一天"等衍生因子。
4. **其他周期因子**：
   - 季度、半年、年等更长周期（如有需要可扩展）。

## 三、特征工程建议

- **周期性特征构造**：
  - 直接将`weekday`、`month_period`、`is_holiday`等作为分类变量输入模型。
  - 对于回归类模型，可用One-Hot编码、周期性正余弦变换（如sin/cos(2π*day/周期)）等方式增强表达。
- **与Prophet结合**：
  - Prophet本身支持年、月、周等季节性建模，也可通过`add_regressor`引入自定义周期因子。
  - 可将节假日、调休等作为holidays传入Prophet，或作为外部回归量。
- **分组均值/分位数法**：
  - 对历史数据按周期因子分组（如每周的周一、每月的月初等），计算均值/中位数作为基线预测。

## 四、预测建模流程建议

1. **数据准备**：
   - 基于`3.7.1_feature_output/3.7.1_prophet_daily_features.csv`等，提取周期性特征。
2. **特征分析**：
   - 可视化各周期因子与申购/赎回的关系，识别显著模式。
3. **建模方法选择**：
   - Prophet模型：利用其内置和自定义季节性，结合holidays和外部周期因子。
   - 传统回归/树模型：以周期因子为主特征，辅以趋势项。
   - 分组均值法：作为简单基线或与模型集成。
4. **模型训练与预测**：
   - 训练区间：2014-03-01至2014-08-31
   - 预测区间：2014-09-01至2014-09-30（或更长）
5. **结果输出与评估**：
   - 输出预测结果csv、周期分解图、残差分析等。
   - 评估指标：RMSE、MAE、MAPE等。

## 五、方案优缺点与适用场景

**优点：**
- 能有效捕捉周期性规律，提升对节奏性波动的拟合能力。
- 方案灵活，可与多种模型结合。
- 解释性强，便于业务理解和调优。

**缺点：**
- 对突发性、非周期性事件敏感度较低。
- 周期因子需结合业务实际不断调整。
- 仅依赖周期因子时，趋势变化捕捉有限。

**适用场景：**
- 资金流、消费、流量等周期性强的时序预测。
- 业务对节假日、月初月末等敏感的场景。

## 六、后续可扩展方向

- 引入更多外部变量（如利率、宏观经济、促销等）。
- 周期因子与趋势因子、异常因子融合建模。
- 多模型集成与残差再建模。
- 周期因子的自动化提取与动态调整。

---
本方案为周期因子驱动的预测建模提供了系统思路，建议结合实际数据和业务需求灵活调整与实现。 