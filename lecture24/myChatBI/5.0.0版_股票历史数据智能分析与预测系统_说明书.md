# 5.0.0版 股票历史数据智能分析与预测系统 说明书（分阶段路线版）

## 一、项目定位与目标

本系统致力于打造一个集"深度学习LSTM预测+多工具智能分析+多种可视化+终端/大屏/AI Agent多模式交互"为一体的股票历史数据智能分析平台。

**核心目标**：  
- 支持单只或多只股票的深度预测、时序分析、异常检测与可视化。
- 提供极致用户体验，支持TUI、Web大屏、AI Agent智能对话等多种交互方式。
- 代码结构高度整合、复用，便于维护和持续扩展。
- **特征工程高度统一**，各类预测模型（LSTM、ARIMA、Prophet等）共用一套特征处理与衍生体系，提升一致性和可扩展性。

---

## 二、分阶段实现路线

### 第一步：核心分析与预测工具（TUI模式）

#### 主要功能模块

1. **K线图、折线图自动绘制**
   - 自动识别数据字段，智能生成plotly悬浮式K线图和折线图，支持中文无乱码。
   - 支持多股票对比、区间自定义、图片命名规范，兼容WebUI引用。

2. **ARIMA预测（arima_stock）**
   - 自动查询近一年数据，ARIMA(5,1,5)预测未来N天收盘价，输出表格和图片。
   - 支持参数自定义，异常处理健全。

3. **BOLL布林带异常点检测（boll_detection）**
   - 20日+2σ布林带，自动检测超买/超卖点，输出表格和布林带图。

4. **Prophet周期分析（prophet_analysis）**
   - 趋势、周、月、年周期分解，长假效应建模，输出分解图和表格。

5. **Prophet未来预测（prophet_predict）**
   - 支持自定义训练/验证区间，先评估验证集误差，再用全量数据预测未来N天，输出趋势图和表格。

6. **LSTM深度学习预测（lstm_predict）**
   - 复用4.1.9版多目标LSTM预测能力，支持窗口、特征、股票灵活配置。
   - 训练、预测、特征导出、可视化一体化，支持调试/正式切换。

#### 交互模式

- 以TUI为主，命令行菜单式交互，参数输入灵活，输出表格/图片路径/智能建议。

---

### 第二步：数据同步与股票管理

- 参考@1.1.1_stock_data_oracle_sync.py，支持自动建表、补齐缺失数据到当天、新增股票自动导入历史数据。
- 数据同步进度与异常提示，保证健壮性。
- 可与主分析程序解耦，作为独立脚本或集成到主程序菜单。

---

### 第三步：Web可视化大屏（前后端分离）

- 基于Flask（或FastAPI）+前端（可选echarts/plotly/dash等），搭建交互式可视化大屏。
- 支持所有分析与预测功能的Web化调用与展示。
- 图表可选plotly（交互性强）或echarts（美观、易集成）。
- 支持多股票对比、区间选择、图片/表格/建议一体化展示。

---

### 第四步：AI Agent智能对话与大屏融合

- 集成Qwen Agent/Assistant，支持自然语言提问、自动调用分析工具、生成图表并嵌入大屏。
- 支持多轮对话、上下文理解、智能推荐分析方案。
- 代码结构支持插件式扩展，便于后续接入更多AI能力。

---

## 三、系统架构与技术路线

- **数据层**：Oracle数据库，表结构`stock_history_data`，支持高效SQL查询与数据同步。
- **模型层**：LSTM、ARIMA、Prophet等多模型统一接口，特征工程与归一化高度复用。
- **工具层**：所有分析工具以类/函数注册，便于主程序和AI Agent统一调用。
- **可视化层**：K线、折线、BOLL、ARIMA、Prophet等图表生成函数统一，支持多种输出格式。
- **交互层**：TUI、Web、AI Agent三种模式共用核心分析逻辑，界面/入口分离，提升复用性。
- **特征工程整合**：
    - 所有预测与分析模型（LSTM、ARIMA、Prophet等）共用一套特征工程模块，包括：
        - 时间特征（如weekday、is_month_end、节假日等）
        - 价格/成交量衍生特征（如均线、振幅、量比、价差等）
        - 滚动统计特征（如均值、方差、极值等）
    - 特征工程模块以独立py文件实现，所有模型/工具通过统一接口调用，保证一致性和可维护性。
    - 支持特征选择、特征导出、特征可视化，便于调优和扩展。
- **异常与日志**：全流程异常捕获与日志输出，便于调试和维护。
- **中文注释与文档**：所有核心函数、类、脚本均有详细中文注释和使用说明。

---

## 四、代码整合与优化建议

- **特征工程统一**：
    - 所有模型和分析工具（LSTM、ARIMA、Prophet等）调用同一套特征工程函数，避免重复开发。
    - 特征工程支持灵活配置（如窗口长度、特征选择），便于不同模型需求。
    - 特征工程输出可直接用于多模型训练、预测和可视化。
- **数据读取、预处理、字段映射**全部抽象为工具函数/类，所有分析工具共用，减少冗余。
- **可视化与输出**统一命名规范，图片/表格/建议一体化输出，兼容WebUI和终端。
- **模型与工具接口**统一，便于后续扩展新模型或分析方法。
- **交互体验**极简，所有功能一键获取，结果清晰可见。
- **性能与健壮性**：调试/正式切换、性能提示、异常处理、日志输出全流程覆盖。

---

## 五、目录结构与主要文件（建议）

- `5.0.0_stock_tools.py`（主程序，集成所有工具，支持TUI/后续Web/Agent调用）
- `5.0.0_feature_engineering.py`（统一特征工程模块，供所有模型/工具调用）
- `5.0.0_kline_plot.py`（K线/折线图工具）
- `5.0.0_boll_detection.py`（BOLL检测工具）
- `5.0.0_arima_stock.py`（ARIMA预测工具）
- `5.0.0_prophet_analysis.py`（Prophet周期分析工具）
- `5.0.0_prophet_predict.py`（Prophet未来预测工具）
- `5.0.0_lstm_predict.py`（LSTM深度学习预测工具）
- `5.0.0_data_sync.py`（数据同步与股票管理工具）
- `5.0.0_image_show/`（图片输出目录）
- `5.0.0_features/`（特征/表格输出目录）

---

## 六、后续扩展建议

- 支持多股票联合建模与对比分析。
- 集成更多时序/机器学习模型（如Transformer、XGBoost等）。
- 增加实时行情与新闻舆情分析模块。
- 优化WebUI交互体验，支持自定义报表与批量导出。
- AI Agent能力持续升级，支持更复杂的自然语言分析与自动化决策。

---

**如需详细功能点、代码结构图或接口设计，可进一步补充。**  
请确认说明书内容，若有补充/修改需求请随时提出，确认后我将协助你搭建5.0.0版主程序及各功能模块代码。