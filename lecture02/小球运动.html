<!DOCTYPE html>
<html>
<head>
    <style>
        canvas {
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="600" height="400"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // 三角形顶点坐标（上顶点，左下，右下）
        const triangle = {
            top: { x: 300, y: 50 },
            left: { x: 100, y: 350 },
            right: { x: 500, y: 350 }
        };

        // 小球属性
        const ball = {
            x: 300,
            y: 200,
            radius: 8,
            speedX: 3,
            speedY: 3,
            color: '#FF0000'
        };

        // 边界反弹系数（控制速度衰减）
        const bounceFactor = 0.95;

        // 绘制三角形
        function drawTriangle() {
            ctx.beginPath();
            ctx.moveTo(triangle.top.x, triangle.top.y);
            ctx.lineTo(triangle.left.x, triangle.left.y);
            ctx.lineTo(triangle.right.x, triangle.right.y);
            ctx.closePath();
            ctx.strokeStyle = '#333';
            ctx.stroke();
        }

        // 边界碰撞检测
        function checkBoundaries() {
            // 将坐标转换为向量计算
            const point = { x: ball.x, y: ball.y };
            
            // 检测左边界的碰撞（左侧边：上顶点到左下顶点）
            if (isPointBelowLine(point, triangle.top, triangle.left)) {
                [ball.speedX, ball.speedY] = reflectVector(
                    [ball.speedX, ball.speedY],
                    getLineNormal(triangle.top, triangle.left)
                );
            }
            
            // 检测右边界的碰撞（右侧边：上顶点到右下顶点）
            if (isPointBelowLine(point, triangle.top, triangle.right)) {
                [ball.speedX, ball.speedY] = reflectVector(
                    [ball.speedX, ball.speedY],
                    getLineNormal(triangle.top, triangle.right)
                );
            }
            
            // 检测底边的碰撞（底边：左下到右下顶点）
            if (ball.y + ball.radius > triangle.left.y) {
                ball.speedY = -Math.abs(ball.speedY) * bounceFactor;
            }
        }

        // 向量反射计算（入射向量与法线向量）
        function reflectVector(vec, normal) {
            const dot = vec[0] * normal[0] + vec[1] * normal[1];
            return [
                vec[0] - 2 * dot * normal[0],
                vec[1] - 2 * dot * normal[1]
            ];
        }

        // 获取线段法线向量
        function getLineNormal(start, end) {
            const dx = end.x - start.x;
            const dy = end.y - start.y;
            const length = Math.sqrt(dx*dx + dy*dy);
            return [-dy/length, dx/length]; // 垂直方向单位向量
        }

        // 判断点是否在直线下方（用于边界的碰撞检测）
        function isPointBelowLine(point, lineStart, lineEnd) {
            const position = (lineEnd.x - lineStart.x) * (point.y - lineStart.y) 
                           - (lineEnd.y - lineStart.y) * (point.x - lineStart.x);
            return position > 0;
        }

        // 动画循环
        function animate() {
            // 添加半透明背景制造拖尾效果
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 更新小球位置
            ball.x += ball.speedX;
            ball.y += ball.speedY;
            
            // 边界检测与反弹
            checkBoundaries();
            
            // 绘制元素
            drawTriangle();
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
            ctx.fillStyle = ball.color;
            ctx.fill();
            
            requestAnimationFrame(animate);
        }

        // 启动动画
        animate();
    </script>
</body>
</html>