以下是对 `5.1_cycle_prophet_groupmean_fusion.py` 和 `5.2_cycle_prophet_groupmean_fusion.py` 两个程序的详细对比分析，以及为何它们输出结果完全一致的原因说明。

---

## 一、核心功能对比

| 版本 | 融合方式 | 融合权重 | 主要流程 |
|------|----------|----------|----------|
| 5.1  | 线性加权融合 | α | Prophet预测与分组均值法加权平均 |
| 5.2  | 残差修正融合 | β | Prophet预测 + β × (分组均值-Prophet) |

### 1. 5.1 线性加权融合
```python
purchase_fusion = best_alpha * purchase_prophet_pred + (1-best_alpha) * purchase_groupmean_pred
```

### 2. 5.2 残差修正融合
```python
purchase_fusion = purchase_prophet_pred + best_beta * (purchase_groupmean_pred - purchase_prophet_pred)
```

---

## 二、数学等价性分析

将 5.2 的残差修正公式展开：

\[
\text{purchase\_fusion} = \text{purchase\_prophet\_pred} + \beta \times (\text{purchase\_groupmean\_pred} - \text{purchase\_prophet\_pred})
\]
\[
= (1-\beta) \times \text{purchase\_prophet\_pred} + \beta \times \text{purchase\_groupmean\_pred}
\]

这与 5.1 的加权融合公式完全等价，只是权重的符号不同：

- 5.1 的 α 实际等价于 5.2 的 β 的互补值（即 α = 1-β）。

---

## 三、权重与RMSE对比

- 5.1 输出：最优融合权重 α=0.65，8月验证集RMSE=97354951.16
- 5.2 输出：最优残差修正权重 β=0.35，8月验证集RMSE=97354951.16

实际上：
- 5.1 的 α=0.65
- 5.2 的 β=0.35
- 代入公式：1-β = 0.65 = α

所以两者融合权重完全一致，融合结果也完全一致。

---

## 四、输出文件对比

你提供的 `/5.1_feature_output` 和 `/5.2_feature_output` 目录下的 csv 和 png 文件内容完全一致，正是因为两者的融合公式和权重本质上是等价的。

---

## 五、结论与建议

- **结果完全一致的根本原因**：两种融合方式数学等价，只是权重表达不同（α=1-β），且自动调优过程也一致，最终融合权重互补，输出结果必然一模一样。
- **建议**：如果你希望两种方法有不同的效果，需要更改融合方式或特征工程、分组策略、Prophet参数等核心流程，否则仅仅是表达方式不同，结果不会有差异。

---

## 参考公式对照

| 方式 | 融合公式 | 权重关系 |
|------|----------|----------|
| 5.1  | α × Prophet + (1-α) × GroupMean | α |
| 5.2  | Prophet + β × (GroupMean - Prophet) | β=1-α |

---

**如需进一步区分两种方法的效果，建议尝试：**
- 更换分组特征或分组降级策略
- 修改Prophet参数或特征
- 引入其他模型或非线性融合方式

