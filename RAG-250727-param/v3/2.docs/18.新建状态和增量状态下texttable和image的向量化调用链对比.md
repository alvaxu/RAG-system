# æ–°å»ºçŠ¶æ€å’Œå¢é‡çŠ¶æ€ä¸‹text/tableå’Œimageçš„å‘é‡åŒ–è°ƒç”¨é“¾å¯¹æ¯”

## ï¿½ï¿½ **å›¾1ï¼šæ–°å»ºçŠ¶æ€ä¸‹çš„å®Œæ•´å‘é‡åŒ–è°ƒç”¨é“¾**

```
V3MainProcessor._process_documents_new()
    â†“
ContentProcessor.process_document_content()
    â†“
â”œâ”€â”€ TextProcessor.process_batch()     # æ–‡æœ¬å¤„ç†ï¼ˆæ— å‘é‡åŒ–ï¼‰
â”œâ”€â”€ TableProcessor.process_batch()    # è¡¨æ ¼å¤„ç†ï¼ˆæ— å‘é‡åŒ–ï¼‰
â””â”€â”€ ImageProcessor.process_images()   # å›¾ç‰‡å¤„ç†ï¼ˆåŒ…å«å‘é‡åŒ–ï¼‰
    â†“
    â”œâ”€â”€ å›¾ç‰‡å¤åˆ¶
    â”œâ”€â”€ å›¾ç‰‡å¢å¼º
    â”œâ”€â”€ å›¾ç‰‡å‘é‡åŒ–
    â””â”€â”€ å…ƒæ•°æ®ç”Ÿæˆ
    â†“
VectorizationManager.vectorize_all_content()  # ç»Ÿä¸€å‘é‡åŒ–ç®¡ç†
    â†“
â”œâ”€â”€ TextVectorizer.vectorize_batch()     # æ–‡æœ¬å‘é‡åŒ–
â”œâ”€â”€ TableVectorizer.vectorize_batch()    # è¡¨æ ¼å‘é‡åŒ–
â””â”€â”€ å›¾ç‰‡å‘é‡åŒ–ç»“æœç›´æ¥æ”¶é›†ï¼ˆæ— éœ€é¢å¤–è°ƒç”¨ï¼‰
    â†“
ModelCaller.call_text_embedding()  # æ–‡æœ¬/è¡¨æ ¼å‘é‡åŒ–APIè°ƒç”¨
```

## ï¿½ï¿½ **å›¾2ï¼šå¢é‡çŠ¶æ€ä¸‹çš„å®Œæ•´å‘é‡åŒ–è°ƒç”¨é“¾**

```
V3MainProcessor._process_documents_incremental()
    â†“
V3MainProcessor._process_single_document_incremental()
    â†“
V3MainProcessor._process_pdf_incremental() / _process_json_incremental()
    â†“
ContentProcessor.process_document_content()
    â†“
â”œâ”€â”€ TextProcessor.process_batch()     # æ–‡æœ¬å¤„ç†ï¼ˆæ— å‘é‡åŒ–ï¼‰
â”œâ”€â”€ TableProcessor.process_batch()    # è¡¨æ ¼å¤„ç†ï¼ˆæ— å‘é‡åŒ–ï¼‰
â””â”€â”€ ImageProcessor.process_images()   # å›¾ç‰‡å¤„ç†ï¼ˆåŒ…å«å‘é‡åŒ–ï¼‰
    â†“
    â”œâ”€â”€ å›¾ç‰‡å¤åˆ¶
    â”œâ”€â”€ å›¾ç‰‡å¢å¼º
    â”œâ”€â”€ å›¾ç‰‡å‘é‡åŒ–
    â””â”€â”€ å…ƒæ•°æ®ç”Ÿæˆ
    â†“
V3MainProcessor._vectorize_content_incremental()  # å¢é‡å‘é‡åŒ–
    â†“
â”œâ”€â”€ VectorizationManager.vectorize_content()  # æ–‡æœ¬/è¡¨æ ¼å‘é‡åŒ–
â”‚   â†“
â”‚   â”œâ”€â”€ TextVectorizer.vectorize_batch()     # æ–‡æœ¬å‘é‡åŒ–
â”‚   â””â”€â”€ TableVectorizer.vectorize_batch()    # è¡¨æ ¼å‘é‡åŒ–
â”‚       â†“
â”‚       ModelCaller.call_text_embedding()    # æ–‡æœ¬/è¡¨æ ¼å‘é‡åŒ–APIè°ƒç”¨
â””â”€â”€ ç›´æ¥æ”¶é›†å›¾ç‰‡å‘é‡åŒ–ç»“æœï¼ˆæ— éœ€é¢å¤–è°ƒç”¨ï¼‰
```

## ğŸ“Š **å›¾3ï¼šæ–°å»ºçŠ¶æ€ vs å¢é‡çŠ¶æ€ - Text/Tableå‘é‡åŒ–å¯¹æ¯”**

```
æ–°å»ºçŠ¶æ€ (Text/Table):
V3MainProcessor._process_documents_new()
    â†“
ContentProcessor.process_document_content()
    â†“
TextProcessor.process_batch() / TableProcessor.process_batch()  # å†…å®¹å¤„ç†
    â†“
VectorizationManager.vectorize_all_content()  # ç»Ÿä¸€å‘é‡åŒ–ç®¡ç†
    â†“
TextVectorizer.vectorize_batch() / TableVectorizer.vectorize_batch()
    â†“
ModelCaller.call_text_embedding()

å¢é‡çŠ¶æ€ (Text/Table):
V3MainProcessor._process_documents_incremental()
    â†“
ContentProcessor.process_document_content()
    â†“
TextProcessor.process_batch() / TableProcessor.process_batch()  # å†…å®¹å¤„ç†
    â†“
V3MainProcessor._vectorize_content_incremental()
    â†“
VectorizationManager.vectorize_content()  # åˆ†æ•£å‘é‡åŒ–ç®¡ç†
    â†“
TextVectorizer.vectorize_batch() / TableVectorizer.vectorize_batch()
    â†“
ModelCaller.call_text_embedding()

å…³é”®å·®å¼‚ï¼š
âœ… æ–°å»ºçŠ¶æ€ï¼šç»Ÿä¸€ç®¡ç† + å•é˜¶æ®µå‘é‡åŒ–
âœ… å¢é‡çŠ¶æ€ï¼šåˆ†æ•£ç®¡ç† + å•é˜¶æ®µå‘é‡åŒ–
```

## ï¿½ï¿½ï¸ **å›¾4ï¼šæ–°å»ºçŠ¶æ€ vs å¢é‡çŠ¶æ€ - Imageå‘é‡åŒ–å¯¹æ¯”**

```
æ–°å»ºçŠ¶æ€ (Image):
V3MainProcessor._process_documents_new()
    â†“
ContentProcessor.process_document_content()
    â†“
ImageProcessor.process_images()  # å®Œæ•´å¤„ç†æµç¨‹
    â†“
â”œâ”€â”€ å›¾ç‰‡å¤åˆ¶
â”œâ”€â”€ å›¾ç‰‡å¢å¼º
â”œâ”€â”€ å›¾ç‰‡å‘é‡åŒ– â† å”¯ä¸€é˜¶æ®µå‘é‡åŒ–
â””â”€â”€ å…ƒæ•°æ®ç”Ÿæˆ
    â†“
VectorizationManager.vectorize_all_content()
    â†“
ç›´æ¥æ”¶é›†å·²å‘é‡åŒ–çš„ç»“æœï¼ˆæ— é¢å¤–APIè°ƒç”¨ï¼‰

å¢é‡çŠ¶æ€ (Image):
V3MainProcessor._process_documents_incremental()
    â†“
ContentProcessor.process_document_content()
    â†“
ImageProcessor.process_images()  # å®Œæ•´å¤„ç†æµç¨‹
    â†“
â”œâ”€â”€ å›¾ç‰‡å¤åˆ¶
â”œâ”€â”€ å›¾ç‰‡å¢å¼º
â”œâ”€â”€ å›¾ç‰‡å‘é‡åŒ– â† å”¯ä¸€é˜¶æ®µå‘é‡åŒ–
â””â”€â”€ å…ƒæ•°æ®ç”Ÿæˆ
    â†“
V3MainProcessor._vectorize_content_incremental()
    â†“
ç›´æ¥æ”¶é›†å·²å‘é‡åŒ–çš„ç»“æœï¼ˆæ— é¢å¤–APIè°ƒç”¨ï¼‰

å…³é”®å·®å¼‚ï¼š
âœ… æ–°å»ºçŠ¶æ€ï¼šå•é˜¶æ®µå‘é‡åŒ–ï¼ˆåªå¤„ç†ï¼Œä¸æ£€æŸ¥è¡¥å……ï¼‰
âœ… å¢é‡çŠ¶æ€ï¼šå•é˜¶æ®µå‘é‡åŒ–ï¼ˆåªå¤„ç†ï¼Œä¸æ£€æŸ¥è¡¥å……ï¼‰
```

## ğŸ” **è°ƒç”¨é“¾å·®å¼‚æ€»ç»“**

### **æ¸…ç†åçš„æ¶æ„ç‰¹ç‚¹ï¼š**
1. **ç»Ÿä¸€ImageVectorizer**ï¼šæ‰€æœ‰å›¾ç‰‡å‘é‡åŒ–éƒ½é€šè¿‡`vectorization.image_vectorizer.ImageVectorizer`
2. **æ¶ˆé™¤é‡å¤è°ƒç”¨**ï¼šåˆ é™¤äº†"è¾…åŠ©å·¥ä½œ"ä¸­çš„é‡å¤å›¾ç‰‡å‘é‡åŒ–é€»è¾‘
3. **ç®€åŒ–æµç¨‹**ï¼šå›¾ç‰‡å‘é‡åŒ–åªåœ¨`ImageProcessor.process_images()`ä¸­æ‰§è¡Œä¸€æ¬¡

### **æ–°å»ºçŠ¶æ€ç‰¹ç‚¹ï¼š**
1. **ç»Ÿä¸€ç®¡ç†**ï¼šé€šè¿‡`VectorizationManager.vectorize_all_content()`ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å‘é‡åŒ–
2. **å•é˜¶æ®µå‘é‡åŒ–**ï¼šå›¾ç‰‡åªå¤„ç†ä¸€æ¬¡ï¼Œä¸é‡å¤å‘é‡åŒ–
3. **å®Œæ•´æ€§ä¿è¯**ï¼šç¡®ä¿æ‰€æœ‰å†…å®¹éƒ½è¢«æ­£ç¡®å‘é‡åŒ–
4. **èµ„æºä¼˜åŒ–**ï¼šé¿å…é‡å¤çš„APIè°ƒç”¨

### **å¢é‡çŠ¶æ€ç‰¹ç‚¹ï¼š**
1. **åˆ†æ•£ç®¡ç†**ï¼šæ–‡æœ¬/è¡¨æ ¼é€šè¿‡VectorizationManagerï¼Œå›¾ç‰‡ç›´æ¥æ”¶é›†ç»“æœ
2. **å•é˜¶æ®µå‘é‡åŒ–**ï¼šå›¾ç‰‡åªå¤„ç†ä¸€æ¬¡ï¼Œä¸é‡å¤å‘é‡åŒ–
3. **æ•ˆç‡ä¼˜å…ˆ**ï¼šé¿å…é‡å¤å¤„ç†ï¼Œå‡å°‘APIè°ƒç”¨
4. **èµ„æºèŠ‚çº¦**ï¼šæ›´é«˜æ•ˆçš„å†…å­˜å’ŒAPIä½¿ç”¨

### **æ¸…ç†åçš„ä¼˜åŠ¿ï¼š**
- **æ¶æ„ç»Ÿä¸€**ï¼šå›¾ç‰‡å‘é‡åŒ–é€»è¾‘å®Œå…¨ç»Ÿä¸€ï¼Œæ— é‡å¤å®ç°
- **æ€§èƒ½æå‡**ï¼šæ¶ˆé™¤é‡å¤è°ƒç”¨ï¼Œå‡å°‘èµ„æºæµªè´¹
- **ç»´æŠ¤ç®€åŒ–**ï¼šå•ä¸€å®ç°ï¼Œä¾¿äºç»´æŠ¤å’Œè°ƒè¯•
- **ä¸¤ç§æ¨¡å¼ä¸€è‡´**ï¼šæ–°å»ºå’Œå¢é‡çŠ¶æ€ä¸‹çš„å›¾ç‰‡å‘é‡åŒ–æµç¨‹å®Œå…¨ä¸€è‡´

### **é‡è¦è¯´æ˜ï¼š**
ç»è¿‡æ¸…ç†åï¼Œæ–°å»ºçŠ¶æ€å’Œå¢é‡çŠ¶æ€ä¸‹çš„å›¾ç‰‡å‘é‡åŒ–è°ƒç”¨é“¾**å®Œå…¨ä¸€è‡´**ï¼Œéƒ½åªåœ¨`ImageProcessor.process_images()`ä¸­æ‰§è¡Œä¸€æ¬¡ï¼Œä¸å†æœ‰"è¾…åŠ©å·¥ä½œ"ä¸­çš„é‡å¤å‘é‡åŒ–è°ƒç”¨ã€‚è¿™ç¡®ä¿äº†ç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œæ•ˆç‡ã€‚