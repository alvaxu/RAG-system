

# V3ç‰ˆæœ¬å‘é‡æ•°æ®åº“æ„å»ºç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## ç³»ç»Ÿæ¦‚è¿°

### é¡¹ç›®ç›®æ ‡
å°†ç°æœ‰RAGç³»ç»Ÿé‡æ„ä¸ºä¸¤ä¸ªç‹¬ç«‹éƒ¨åˆ†ï¼š
1. **ç¬¬ä¸€éƒ¨åˆ†**ï¼šå‘é‡æ•°æ®åº“æ„å»ºç³»ç»Ÿï¼ˆå½“å‰é‡ç‚¹ï¼‰
2. **ç¬¬äºŒéƒ¨åˆ†**ï¼šRAGæŸ¥è¯¢ç³»ç»Ÿï¼ˆåç»­å¼€å‘ï¼‰

### æ ¸å¿ƒè®¾è®¡åŸåˆ™
- **ä¿æŒä¼˜ç§€**ï¼šä¿ç•™ç°æœ‰ä»£ç çš„ä¼˜ç§€è®¾è®¡å’Œå®ç°
- **ç»Ÿä¸€æ¥å£**ï¼šæ•´åˆæ–°å»ºå’Œå¢åŠ æ¨¡å¼ï¼Œæä¾›ç»Ÿä¸€å…¥å£
- **æ¨¡å—åŒ–é‡æ„**ï¼šå°†åˆ†æ•£çš„ä»£ç æ•´åˆåˆ°æ¸…æ™°çš„æ¨¡å—ç»“æ„ä¸­
- **é…ç½®é›†ä¸­åŒ–**ï¼šç»Ÿä¸€é…ç½®ç®¡ç†ï¼Œæ”¯æŒç¯å¢ƒå˜é‡
- **åŒé‡embedding**ï¼šå›¾ç‰‡æ”¯æŒè§†è§‰å’Œè¯­ä¹‰åŒé‡å‘é‡åŒ–

## ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾
```
ç”¨æˆ·è¾“å…¥ â†’ V3MainProcessor â†’ DocumentTypeDetector â†’ ContentProcessor â†’ VectorizationManager â†’ MetadataManager â†’ VectorStoreManager
```

### æ ¸å¿ƒæ¨¡å—å…³ç³»
```
V3MainProcessor (ä¸»æ§åˆ¶å™¨)
â”œâ”€â”€ DocumentTypeDetector (æ–‡æ¡£ç±»å‹æ£€æµ‹)
â”œâ”€â”€ ContentProcessor (å†…å®¹å¤„ç†å™¨)
â”‚   â”œâ”€â”€ TextProcessor (æ–‡æœ¬å¤„ç†)
â”‚   â”œâ”€â”€ ImageProcessor (å›¾åƒå¤„ç†)
â”‚   â””â”€â”€ TableProcessor (è¡¨æ ¼å¤„ç†)
â”œâ”€â”€ VectorizationManager (å‘é‡åŒ–ç®¡ç†)
â”‚   â”œâ”€â”€ TextVectorizer (æ–‡æœ¬å‘é‡åŒ–)
â”‚   â”œâ”€â”€ ImageVectorizer (å›¾åƒå‘é‡åŒ–)
â”‚   â””â”€â”€ TableVectorizer (è¡¨æ ¼å‘é‡åŒ–)
â”œâ”€â”€ MetadataManager (å…ƒæ•°æ®ç®¡ç†)
â””â”€â”€ VectorStoreManager (å‘é‡å­˜å‚¨ç®¡ç†)
```

## æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 1. V3MainProcessor (ä¸»æ§åˆ¶å™¨)
**èŒè´£**ï¼šç»Ÿä¸€çš„ç¨‹åºå…¥å£ï¼Œæ™ºèƒ½é€‰æ‹©å¤„ç†æ¨¡å¼
**æ ¸å¿ƒé€»è¾‘**ï¼š
```python
def process_documents(self, input_path: str, target_vector_db: str) -> Dict:
    # 1. æ£€æµ‹ç›®æ ‡å‘é‡æ•°æ®åº“çŠ¶æ€
    db_exists = self._check_vector_db_exists(target_vector_db)
    
    # 2. æ™ºèƒ½é€‰æ‹©æ¨¡å¼
    if db_exists:
        return self._incremental_process(input_path, target_vector_db)
    else:
        return self._new_process(input_path, target_vector_db)
```

**è®¾è®¡è¦ç‚¹**ï¼š
- è‡ªåŠ¨æ£€æµ‹å‘é‡æ•°æ®åº“çŠ¶æ€
- ç»Ÿä¸€çš„æ–°å»º/å¢é‡å¤„ç†æ¥å£
- ä¿æŒä¸ç°æœ‰ç³»ç»Ÿçš„å…¼å®¹æ€§

### 2. ContentProcessor (å†…å®¹å¤„ç†å™¨)
**èŒè´£**ï¼šç»Ÿä¸€ç®¡ç†ä¸åŒç±»å‹å†…å®¹çš„å¤„ç†
**æ ¸å¿ƒé€»è¾‘**ï¼š
```python
def process_content(self, content: Any, content_type: str) -> List[Document]:
    processor = self._get_processor(content_type)
    return processor.process(content)
```

**è®¾è®¡è¦ç‚¹**ï¼š
- æ•´åˆç°æœ‰çš„å¤„ç†å™¨æ¨¡å—
- ä¿æŒå„å¤„ç†å™¨çš„ç‹¬ç«‹æ€§
- ç»Ÿä¸€çš„å¤„ç†æ¥å£

### 3. VectorizationManager (å‘é‡åŒ–ç®¡ç†)
**èŒè´£**ï¼šç»Ÿä¸€ç®¡ç†å„ç§å†…å®¹çš„å‘é‡åŒ–ï¼Œæ”¯æŒåŒé‡embeddingç­–ç•¥

#### 3.1 æ–‡æœ¬å‘é‡åŒ–
```python
class TextVectorizer:
    def __init__(self, config):
        self.model = DashScopeEmbeddings(
            dashscope_api_key=config['dashscope_api_key'],
            model=config['vectorization']['text_embedding_model']
        )
    
    def vectorize(self, text: str) -> List[float]:
        return self.model.embed_documents([text])[0]
```

#### 3.2 å›¾åƒå‘é‡åŒ–ï¼ˆåŒé‡embeddingï¼‰
```python
class ImageVectorizer:
    def __init__(self, config):
        # è§†è§‰embeddingæ¨¡å‹ï¼ˆOne_Peaceï¼‰
        self.image_embedding_model = DashScopeEmbeddings(
            dashscope_api_key=config['dashscope_api_key'],
            model=config['vectorization']['image_embedding_model']
        )
        
        # è¯­ä¹‰embeddingæ¨¡å‹ï¼ˆtext-embedding-v1ï¼‰
        self.text_embedding_model = DashScopeEmbeddings(
            dashscope_api_key=config['dashscope_api_key'],
            model=config['vectorization']['text_embedding_model']
        )
    
    def vectorize_image(self, image_path: str, enhanced_description: str) -> Dict:
        # 1. ç”Ÿæˆè§†è§‰embedding
        image_vector = self.image_embedding_model.embed_image(image_path)
        
        # 2. ç”Ÿæˆè¯­ä¹‰embedding
        text_vector = self.text_embedding_model.embed_documents([enhanced_description])[0]
        
        return {
            'image_vector': image_vector,
            'text_vector': text_vector,
            'image_path': image_path
        }
```

#### 3.3 è¡¨æ ¼å‘é‡åŒ–
```python
class TableVectorizer:
    def __init__(self, config):
        self.model = DashScopeEmbeddings(
            dashscope_api_key=config['dashscope_api_key'],
            model=config['vectorization']['text_embedding_model']
        )
    
    def vectorize(self, table_content: str) -> List[float]:
        return self.model.embed_documents([table_content])[0]
```

### 4. MetadataManager (å…ƒæ•°æ®ç®¡ç†)
**èŒè´£**ï¼šè§„èŒƒåŒ–å…ƒæ•°æ®ç®¡ç†ï¼Œæ”¯æŒåŒé‡embeddingå­˜å‚¨

#### 4.1 ç»Ÿä¸€å…ƒæ•°æ®æ¨¡å¼
```python
{
    "document_info": {
        "document_name": "æ–‡æ¡£åç§°",
        "document_type": "pdf|markdown",
        "page_number": 1,
        "chunk_index": 0,
        "chunk_type": "text|image|table",
        "source_file": "åŸå§‹æ–‡ä»¶è·¯å¾„"
    },
    "content_info": {
        "content": "å®é™…å†…å®¹",
        "content_preview": "å†…å®¹é¢„è§ˆ",
        "content_length": 1000,
        "content_hash": "å†…å®¹å”¯ä¸€æ ‡è¯†"
    },
    "vector_info": {
        "vector_id": "å‘é‡ID",
        "embedding_model": "ä½¿ç”¨çš„æ¨¡å‹",
        "vector_dimension": 1536,
        "similarity_score": 0.85
    },
    "processing_info": {
        "created_at": "åˆ›å»ºæ—¶é—´",
        "updated_at": "æ›´æ–°æ—¶é—´",
        "processing_version": "å¤„ç†ç‰ˆæœ¬å·",
        "enhancement_applied": true
    }
}
```

#### 4.2 ç±»å‹ç‰¹å®šå…ƒæ•°æ®

**æ–‡æœ¬ç±»å‹**ï¼š
```python
{
    "type_specific": {
        "text_type": "paragraph|heading|list",
        "text_level": 1,
        "text_style": "normal|bold|italic",
        "language": "zh|en",
        "semantic_context": "ä¸Šä¸‹æ–‡ä¿¡æ¯"
    }
}
```

**å›¾åƒç±»å‹ï¼ˆåŒé‡embeddingï¼‰**ï¼š
```python
{
    "type_specific": {
        "image_id": "å›¾ç‰‡å”¯ä¸€æ ‡è¯†",
        "image_path": "å›¾ç‰‡æ–‡ä»¶è·¯å¾„",
        "image_filename": "å›¾ç‰‡æ–‡ä»¶å",
        "image_type": "chart|diagram|photo",
        "image_format": "jpg|png|gif",
        "image_size": "å›¾ç‰‡å°ºå¯¸",
        "img_caption": ["å›¾ç‰‡æ ‡é¢˜1", "å›¾ç‰‡æ ‡é¢˜2"],
        "img_footnote": ["è„šæ³¨1", "è„šæ³¨2"],
        "enhanced_description": "AIç”Ÿæˆçš„å¢å¼ºæè¿°",
        "enhancement_timestamp": 1234567890,
        "enhancement_enabled": true,
        "layered_descriptions": {
            "åŸºç¡€è§†è§‰æè¿°": "åŸºç¡€æè¿°å†…å®¹",
            "å†…å®¹ç†è§£æè¿°": "ç†è§£æè¿°å†…å®¹",
            "æ•°æ®è¶‹åŠ¿æè¿°": "è¶‹åŠ¿æè¿°å†…å®¹",
            "è¯­ä¹‰ç‰¹å¾æè¿°": "ç‰¹å¾æè¿°å†…å®¹"
        },
        "structured_info": {
            "chart_type": "å›¾è¡¨ç±»å‹",
            "data_points": "æ•°æ®ç‚¹æ•°é‡",
            "trends": "è¶‹åŠ¿ä¿¡æ¯",
            "key_insights": "å…³é”®æ´å¯Ÿ"
        },
        # åŒé‡embeddingå­˜å‚¨
        "image_embedding": [0.1, 0.2, ...],      # One_Peaceè§†è§‰å‘é‡
        "text_embedding": [0.3, 0.4, ...]        # æ–‡æœ¬è¯­ä¹‰å‘é‡
    }
}
```

**è¡¨æ ¼ç±»å‹**ï¼š
```python
{
    "type_specific": {
        "table_id": "è¡¨æ ¼å”¯ä¸€æ ‡è¯†",
        "table_type": "data_table|form|chart",
        "table_title": "è¡¨æ ¼æ ‡é¢˜",
        "table_summary": "è¡¨æ ¼æ‘˜è¦",
        "table_headers": ["åˆ—1", "åˆ—2", "åˆ—3"],
        "table_row_count": 100,
        "table_column_count": 5,
        "html_content": "<table>...</table>",
        "processed_table_content": "è¯­ä¹‰åŒ–å†…å®¹",
        "related_text": "ç›¸å…³æ–‡æœ¬å†…å®¹",
        "table_structure": {
            "has_header": true,
            "has_footer": false,
            "is_regular": true,
            "merge_cells": []
        }
    }
}
```

## ğŸ”„ å¤„ç†æµç¨‹è®¾è®¡

### 1. å®Œæ•´å¤„ç†æµç¨‹
```
è¾“å…¥æ£€æµ‹ â†’ ç±»å‹è¯†åˆ« â†’ å†…å®¹å¤„ç† â†’ åŒé‡å‘é‡åŒ– â†’ å…ƒæ•°æ®ç”Ÿæˆ â†’ å­˜å‚¨ç®¡ç† â†’ ç»“æœæŠ¥å‘Š
```

### 2. æ™ºèƒ½æ¨¡å¼é€‰æ‹©
```
æ£€æŸ¥ç›®æ ‡å‘é‡æ•°æ®åº“ â†’ å­˜åœ¨ï¼Ÿ â†’ æ˜¯ï¼šå¢é‡æ¨¡å¼ / å¦ï¼šæ–°å»ºæ¨¡å¼
```

### 3. å›¾åƒå¢å¼ºæµç¨‹
```
å›¾åƒè¾“å…¥ â†’ åŸºç¡€ä¿¡æ¯æå– â†’ å¢å¼ºå¼€å…³æ£€æŸ¥ â†’ å¼€å¯ï¼šæ‰§è¡Œå¢å¼º â†’ ç”Ÿæˆå¢å¼ºæè¿° â†’ åŒé‡å‘é‡åŒ–
```

### 4. minerUé›†æˆæµç¨‹
```
PDFæ–‡ä»¶ â†’ minerU APIè°ƒç”¨ â†’ è§£æç»“æœä¸‹è½½ â†’ Markdown + JSON + Images â†’ å†…å®¹å¤„ç† â†’ åŒé‡å‘é‡åŒ–
```

**å…³é”®æ­¥éª¤**ï¼š
1. **PDFä¸Šä¼ **ï¼šè°ƒç”¨ `minerU_batch_local_files.py` çš„æ‰¹é‡ä¸Šä¼ åŠŸèƒ½
2. **è§£æç­‰å¾…**ï¼šè½®è¯¢ç­‰å¾…minerUè§£æå®Œæˆ
3. **ç»“æœä¸‹è½½**ï¼šä¸‹è½½åŒ…å«Markdownã€JSONå’Œå›¾ç‰‡çš„ZIPæ–‡ä»¶
4. **æ–‡ä»¶è§£å‹**ï¼šè§£å‹å¹¶é‡å‘½åæ–‡ä»¶ï¼Œä¿æŒæ–‡ä»¶å…³è”æ€§

**æ–‡ä»¶å…³è”ç»“æ„**ï¼š
```
document_name.pdf â†’ document_name.md + document_name_1.json + images/
```

## ğŸ“ ç›®å½•ç»“æ„è®¾è®¡

```
v3/
â”œâ”€â”€ main.py                          # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config_manager.py            # é…ç½®ç®¡ç†å™¨ä¸»ç±»
â”‚   â”œâ”€â”€ config_validator.py          # é…ç½®éªŒè¯å™¨
â”‚   â”œâ”€â”€ config_loader.py             # é…ç½®åŠ è½½å™¨
â”‚   â”œâ”€â”€ environment_manager.py       # ç¯å¢ƒå˜é‡ç®¡ç†å™¨ï¼ˆWindowså…¼å®¹ï¼‰
â”‚   â”œâ”€â”€ path_manager.py              # è·¯å¾„ç®¡ç†å™¨
â”‚   â”œâ”€â”€ failure_handler.py           # å¤±è´¥å¤„ç†ç®¡ç†å™¨
â”‚   â”œâ”€â”€ v3_config.json              # V3é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ v3_config_schema.json       # é…ç½®æ¨¡å¼æ–‡ä»¶
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ v3_main_processor.py         # ä¸»æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ content_processor.py          # å†…å®¹å¤„ç†å™¨
â”‚   â”œâ”€â”€ vectorization_manager.py      # å‘é‡åŒ–ç®¡ç†
â”‚   â””â”€â”€ metadata_manager.py           # å…ƒæ•°æ®ç®¡ç†
â”œâ”€â”€ processors/
â”‚   â”œâ”€â”€ text_processor.py             # æ–‡æœ¬å¤„ç†å™¨
â”‚   â”œâ”€â”€ image_processor.py            # å›¾åƒå¤„ç†å™¨
â”‚   â””â”€â”€ table_processor.py            # è¡¨æ ¼å¤„ç†å™¨
â”œâ”€â”€ vectorization/
â”‚   â”œâ”€â”€ text_vectorizer.py            # æ–‡æœ¬å‘é‡åŒ–
â”‚   â”œâ”€â”€ image_vectorizer.py           # å›¾åƒå‘é‡åŒ–ï¼ˆåŒé‡embeddingï¼‰
â”‚   â””â”€â”€ table_vectorizer.py           # è¡¨æ ¼å‘é‡åŒ–
â”œâ”€â”€ metadata/
â”‚   â”œâ”€â”€ metadata_schema.py            # å…ƒæ•°æ®æ¨¡å¼
â”‚   â”œâ”€â”€ metadata_manager.py           # å…ƒæ•°æ®ç®¡ç†å™¨
â”‚   â””â”€â”€ metadata_validator.py         # å…ƒæ•°æ®éªŒè¯å™¨
â””â”€â”€ utils/
    â”œâ”€â”€ document_type_detector.py     # æ–‡æ¡£ç±»å‹æ£€æµ‹
    â””â”€â”€ vector_db_validator.py        # å‘é‡æ•°æ®åº“éªŒè¯
```

## é…ç½®ç®¡ç†è®¾è®¡

### é…ç½®æ–‡ä»¶ç»“æ„
```json
{
  "paths": {
    "input_pdf_dir": "./document/orig_pdf",
    "mineru_output_dir": "./document/md",
    "final_image_dir": "./central/images",
    "vector_db_dir": "./central/vector_db",
    "temp_dir": "./temp",
    "logs_dir": "./logs"
  },
  "document_processing": {
    "chunk_size": 1000,
    "chunk_overlap": 200
  },
  "vectorization": {
    "text_embedding_model": "text-embedding-v1",
    "image_embedding_model": "multimodal-embedding-one-peace-v1"
  },
  "image_processing": {
    "enable_enhancement": true,
    "enhancement_model": "qwen-vl-plus",
    "enhancement_model_api": "dashscope"
  },
  "mineru": {
    "api_endpoint": "https://api.mineru.com",
    "batch_size": 10,
    "timeout": 300,
    "retry_count": 3,
    "poll_interval": 10
  },
  "api_rate_limiting": {
    "enhancement_batch_size": 5,
    "enhancement_delay_seconds": 2,
    "vectorization_batch_size": 10,
    "vectorization_delay_seconds": 1,
    "max_retries": 3,
    "retry_delay_seconds": 5,
    "enable_rate_limiting": true
  },
  "batch_processing": {
    "enhancement_workers": 2,
    "vectorization_workers": 3,
    "queue_size": 100,
    "timeout_seconds": 300,
    "progress_report_interval": 10
  },
  "failure_handling": {
    "skip_failed_images": true,
    "max_retries": 3,
    "retry_delay_seconds": 5,
    "continue_on_failure": true,
    "generate_failure_report": true,
    "failure_report_path": "./logs/failure_report.json",
    "mark_for_later_processing": true,
    "failure_report_format": "detailed"
  },
  "storage": {
    "backup_enabled": true,
    "backup_interval": 24
  }
}
```

### é…ç½®ç®¡ç†ç‰¹ç‚¹
- **é›†ä¸­åŒ–**ï¼šæ‰€æœ‰é…ç½®åœ¨JSONæ–‡ä»¶ä¸­
- **ç¯å¢ƒå˜é‡**ï¼šAPIå¯†é’¥ä»Windowsç¯å¢ƒå˜é‡è¯»å–
- **å‚æ•°éªŒè¯**ï¼šå¼€å‘æ¨¡å—ä¸è®¾é»˜è®¤å€¼ï¼Œç¼ºå°‘å‚æ•°ç›´æ¥æç¤º

## ğŸ” åŒé‡embeddingæ£€ç´¢ç­–ç•¥

### 1. å›¾ç‰‡åˆ°å›¾ç‰‡ï¼ˆè§†è§‰ç›¸ä¼¼åº¦ï¼‰
```python
def search_similar_images(self, query_image_path: str, top_k: int = 5) -> List[Dict]:
    # 1. ç”ŸæˆæŸ¥è¯¢å›¾ç‰‡çš„è§†è§‰embedding
    query_vector = self.image_embedding_model.embed_image(query_image_path)
    
    # 2. åœ¨å›¾ç‰‡chunkä¸­æœç´¢è§†è§‰ç›¸ä¼¼çš„å›¾ç‰‡
    results = self.vector_store.similarity_search(
        query_vector,
        filter={"chunk_type": "image"},
        search_in="image_embedding",  # ä½¿ç”¨è§†è§‰embedding
        top_k=top_k
    )
    
    return [self._format_image_result(doc) for doc in results]
```

### 2. æ–‡æœ¬åˆ°å›¾ç‰‡ï¼ˆè¯­ä¹‰ç›¸ä¼¼åº¦ï¼‰
```python
def search_images_by_text(self, query_text: str, top_k: int = 5) -> List[Dict]:
    # 1. ç”ŸæˆæŸ¥è¯¢æ–‡æœ¬çš„è¯­ä¹‰embedding
    query_vector = self.text_embedding_model.embed_documents([query_text])[0]
    
    # 2. åœ¨å›¾ç‰‡chunkä¸­æœç´¢è¯­ä¹‰ç›¸ä¼¼çš„å›¾ç‰‡
    results = self.vector_store.similarity_search(
        query_vector,
        filter={"chunk_type": "image"},
        search_in="text_embedding",  # ä½¿ç”¨è¯­ä¹‰embedding
        top_k=top_k
    )
    
    return [self._format_image_result(doc) for doc in results]
```

### 3. æ··åˆæŸ¥è¯¢ï¼ˆè§†è§‰+è¯­ä¹‰ï¼‰
```python
def search_images_hybrid(self, query_image_path: str, query_text: str, 
                         visual_weight: float = 0.5, text_weight: float = 0.5,
                         top_k: int = 5) -> List[Dict]:
    # 1. ç”ŸæˆåŒé‡æŸ¥è¯¢å‘é‡
    visual_vector = self.image_embedding_model.embed_image(query_image_path)
    text_vector = self.text_embedding_model.embed_documents([query_text])[0]
    
    # 2. åŠ æƒç»„åˆæŸ¥è¯¢å‘é‡
    combined_vector = [
        visual_weight * v + text_weight * t 
        for v, t in zip(visual_vector, text_vector)
    ]
    
    # 3. æ··åˆæœç´¢
    results = self.vector_store.similarity_search(
        combined_vector,
        filter={"chunk_type": "image"},
        top_k=top_k
    )
    
    return [self._format_image_result(doc) for doc in results]
```

## ğŸš€ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„é‡æ„ï¼ˆ1å‘¨ï¼‰
1. åˆ›å»ºV3ç›®å½•ç»“æ„
2. å®ç° `V3MainProcessor` ä¸»æ§åˆ¶å™¨
3. æ•´åˆç°æœ‰çš„é…ç½®ç®¡ç†

### ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒæ¨¡å—é‡æ„ï¼ˆ2å‘¨ï¼‰
1. é‡æ„ `ContentProcessor`ï¼Œæ•´åˆç°æœ‰å¤„ç†å™¨
2. é‡æ„ `VectorizationManager`ï¼Œå®ç°åŒé‡embedding
3. å®ç° `MetadataManager`ï¼Œæ ‡å‡†åŒ–å…ƒæ•°æ®

### ç¬¬ä¸‰é˜¶æ®µï¼šæµç¨‹æ•´åˆï¼ˆ1å‘¨ï¼‰
1. æ•´åˆæ–°å»ºå’Œå¢é‡å¤„ç†æµç¨‹
2. å®ç°æ™ºèƒ½æ¨¡å¼é€‰æ‹©
3. æµ‹è¯•å’Œä¼˜åŒ–

### ç¬¬å››é˜¶æ®µï¼šæ¥å£æ ‡å‡†åŒ–ï¼ˆ1å‘¨ï¼‰
1. å®šä¹‰RAGç³»ç»Ÿæ¥å£
2. ç¼–å†™æ¥å£æ–‡æ¡£
3. æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–

## ğŸ” å…³é”®æŠ€æœ¯å®ç°

### 1. ç°æœ‰ä»£ç æ•´åˆç­–ç•¥
- **ä¿æŒå…¼å®¹æ€§**ï¼šä¿æŒä¸ç°æœ‰ `DocumentProcessingPipeline` çš„æ¥å£å…¼å®¹
- **æ¸è¿›å¼é‡æ„**ï¼šé€æ­¥é‡æ„å„æ¨¡å—ï¼Œé¿å…å¤§è§„æ¨¡é‡å†™
- **æµ‹è¯•é©±åŠ¨**ï¼šæ¯ä¸ªé‡æ„æ­¥éª¤éƒ½è¦æœ‰å¯¹åº”çš„æµ‹è¯•

### 2. åŒé‡embeddingå®ç°è¦ç‚¹
- **æ¨¡å‹é€‰æ‹©**ï¼šOne_Peaceç”¨äºè§†è§‰ï¼Œtext-embedding-v1ç”¨äºè¯­ä¹‰
- **å‘é‡å­˜å‚¨**ï¼šåœ¨åŒä¸€ä¸ªchunkä¸­å­˜å‚¨ä¸¤ç§å‘é‡
- **æ£€ç´¢ç­–ç•¥**ï¼šæ ¹æ®æŸ¥è¯¢ç±»å‹é€‰æ‹©ç›¸åº”çš„å‘é‡è¿›è¡Œç›¸ä¼¼åº¦è®¡ç®—
- **æ€§èƒ½ä¼˜åŒ–**ï¼šè€ƒè™‘å‘é‡é™ç»´å’Œç´¢å¼•ä¼˜åŒ–

### 3. æ¨¡å—åŒ–é‡æ„è¦ç‚¹
- **èŒè´£åˆ†ç¦»**ï¼šæ˜ç¡®å„æ¨¡å—çš„èŒè´£è¾¹ç•Œ
- **æ¥å£ç»Ÿä¸€**ï¼šç»Ÿä¸€å„å¤„ç†å™¨çš„æ¥å£è®¾è®¡
- **ä¾èµ–æ³¨å…¥**ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥é™ä½æ¨¡å—é—´è€¦åˆ

### 4. é…ç½®ç®¡ç†ä¼˜åŒ–
- **ç¯å¢ƒå˜é‡æ”¯æŒ**ï¼šæ”¯æŒä»ç¯å¢ƒå˜é‡è¯»å–æ•æ„Ÿé…ç½®
- **é…ç½®éªŒè¯**ï¼šæä¾›é…ç½®éªŒè¯å’Œé”™è¯¯æç¤º
- **é»˜è®¤å€¼ç®¡ç†**ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­ç®¡ç†é»˜è®¤å€¼ï¼Œä»£ç ä¸­ä¸ç¡¬ç¼–ç 

### 5. å…ƒæ•°æ®æ ‡å‡†åŒ–
- **ç»“æ„ç»Ÿä¸€**ï¼šç»Ÿä¸€ä¸åŒç±»å‹æ–‡æ¡£çš„metadataç»“æ„
- **å­—æ®µè§„èŒƒ**ï¼šè§„èŒƒå­—æ®µå‘½åå’Œå«ä¹‰
- **æ‰©å±•æ€§**ï¼šæ”¯æŒç±»å‹ç‰¹å®šçš„å…ƒæ•°æ®æ‰©å±•

## âš ï¸ é£é™©è¯„ä¼°ä¸ç¼“è§£

### ä¸»è¦é£é™©
1. **ç°æœ‰åŠŸèƒ½ç ´å**ï¼šé‡æ„è¿‡ç¨‹ä¸­å¯èƒ½ç ´åç°æœ‰åŠŸèƒ½
2. **æ€§èƒ½ä¸‹é™**ï¼šé‡æ„åå¯èƒ½å½±å“å¤„ç†æ€§èƒ½
3. **é…ç½®æ··ä¹±**ï¼šæ–°æ—§é…ç½®ç³»ç»Ÿå¹¶å­˜å¯èƒ½é€ æˆæ··ä¹±

### ç¼“è§£ç­–ç•¥
1. **æ¸è¿›å¼é‡æ„**ï¼šåˆ†é˜¶æ®µé‡æ„ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰æµ‹è¯•
2. **æ€§èƒ½ç›‘æ§**ï¼šé‡æ„è¿‡ç¨‹ä¸­æŒç»­ç›‘æ§æ€§èƒ½æŒ‡æ ‡
3. **é…ç½®è¿ç§»**ï¼šæä¾›é…ç½®è¿ç§»å·¥å…·å’Œæ–‡æ¡£

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å‘é‡ç»´åº¦ä¼˜åŒ–
- è€ƒè™‘å¯¹One_Peaceå’Œtext-embeddingçš„å‘é‡è¿›è¡Œé™ç»´
- ä½¿ç”¨PCAæˆ–å…¶ä»–é™ç»´æŠ€æœ¯ï¼Œå°†1536ç»´é™åˆ°512ç»´æˆ–256ç»´
- è¿™æ ·å¯ä»¥æ˜¾è‘—æé«˜æ£€ç´¢é€Ÿåº¦å’Œå‡å°‘å­˜å‚¨ç©ºé—´

### 2. ç´¢å¼•ç­–ç•¥ä¼˜åŒ–
- å¯¹äºè§†è§‰ç›¸ä¼¼åº¦æŸ¥è¯¢ï¼Œä½¿ç”¨ä¸“é—¨çš„è§†è§‰å‘é‡ç´¢å¼•
- å¯¹äºè¯­ä¹‰ç›¸ä¼¼åº¦æŸ¥è¯¢ï¼Œä½¿ç”¨ä¸“é—¨çš„è¯­ä¹‰å‘é‡ç´¢å¼•
- æ”¯æŒæ··åˆæŸ¥è¯¢æ—¶ï¼Œå¯ä»¥åˆ†åˆ«æŸ¥è¯¢ä¸¤ä¸ªç´¢å¼•ï¼Œç„¶ååˆå¹¶ç»“æœ

### 3. ç¼“å­˜ç­–ç•¥
- ç¼“å­˜å¸¸ç”¨çš„æŸ¥è¯¢å‘é‡
- ç¼“å­˜æŸ¥è¯¢ç»“æœ
- ä½¿ç”¨Redisç­‰ç¼“å­˜ç³»ç»Ÿæé«˜å“åº”é€Ÿåº¦

è¿™ä¸ªé‡å†™çš„è®¾è®¡æ–‡æ¡£åŸºäºæˆ‘ä»¬çš„æ·±å…¥è®¨è®ºï¼Œç‰¹åˆ«å¼ºè°ƒäº†ï¼š
1. **åŒé‡embeddingç­–ç•¥**ï¼šå›¾ç‰‡æ”¯æŒè§†è§‰å’Œè¯­ä¹‰åŒé‡å‘é‡åŒ–
2. **ç»Ÿä¸€å­˜å‚¨ç­–ç•¥**ï¼šåœ¨åŒä¸€ä¸ªchunkä¸­å­˜å‚¨å®Œæ•´ä¿¡æ¯
3. **çµæ´»çš„æ£€ç´¢ç­–ç•¥**ï¼šæ”¯æŒè§†è§‰ã€è¯­ä¹‰å’Œæ··åˆæŸ¥è¯¢
4. **æ€§èƒ½ä¼˜åŒ–è€ƒè™‘**ï¼šå‘é‡é™ç»´ã€ç´¢å¼•ä¼˜åŒ–å’Œç¼“å­˜ç­–ç•¥