# 测试程序使用说明

## 概述
`tools/` 目录包含了各种测试和调试程序，用于验证RAG系统V2.0.0的各项功能。

## 主要测试程序

### 1. test_doc_structure_fix.py - 文档结构修复验证测试
**用途**: 验证文档结构修复是否有效
**测试内容**:
- 测试 dict_keys(['doc_id', 'doc', 'score', 'match_type']) 结构的处理
- 验证 chunk_type 字段的正确提取
- 确认来源信息的正确显示
- 解决"未知来源"问题

**使用方法**:
```bash
cd tools/
python test_doc_structure_fix.py
```

**预期结果**:
- ✅ 正确处理新的文档结构
- ✅ chunk_type 字段正确提取
- ✅ 来源信息正确显示
- ✅ 不再出现"未知来源"

### 2. test_llm_and_sources.py - LLM答案和来源信息修复验证测试
**用途**: 验证LLM答案生成和来源信息提取的修复效果
**测试内容**:
- LLM答案是否正确生成和显示
- 来源信息是否正确提取和格式化
- 元数据是否正确传递
- 优化管道是否正常工作

**使用方法**:
```bash
cd tools/
python test_llm_and_sources.py
```

**预期结果**:
- ✅ LLM答案正常生成（长度>50字符）
- ✅ 来源信息正确显示（文档名、页码、类型）
- ✅ 元数据包含优化管道信息
- ✅ 不再出现"未知来源"

### 3. test_fix_verification.py - 前端修复验证测试
**用途**: 验证前端修复后的功能是否正常工作
**测试内容**:
- 预设问题加载
- 记忆统计功能
- 不同查询类型的结果验证
- 来源类型匹配验证

**使用方法**:
```bash
cd tools/
python test_fix_verification.py
```

**预期结果**:
- ✅ 预设问题正确加载
- ✅ 记忆统计正常显示
- ✅ 查询类型正确过滤结果
- ✅ 来源类型与查询类型匹配

### 4. test_v2_qa_fulltest.py - 完整功能测试
**用途**: 全面测试V2系统的问答功能
**测试内容**: 包含所有核心功能的端到端测试

### 5. test_v2_memory_manager.py - 记忆管理测试
**用途**: 测试记忆管理系统的各项功能
**测试内容**: 会话记忆、用户记忆、记忆清理等

### 6. test_optimization_status.py - 优化管道状态测试
**用途**: 测试优化管道的运行状态
**测试内容**: 重排序、智能过滤、LLM生成等步骤

### 7. test_source_display.py - 来源显示测试
**用途**: 测试来源信息的显示格式
**测试内容**: 来源格式化、元数据提取等

## 调试程序

### 1. debug_memory_integration.py - 记忆集成调试
**用途**: 调试记忆系统与主系统的集成问题

### 2. debug_llm_context.py - LLM上下文调试
**用途**: 调试LLM生成过程中的上下文问题

### 3. check_db_structure.py - 数据库结构检查
**用途**: 检查向量数据库和文档存储的结构

### 4. check_document_metadata.py - 文档元数据检查
**用途**: 检查文档的元数据信息

## 使用建议

### 开发阶段
1. **功能开发后**: 使用对应的测试程序验证功能
2. **问题调试**: 使用调试程序定位问题
3. **系统检查**: 使用检查程序验证系统状态

### 测试顺序
1. 先运行基础检查程序 (`check_*.py`)
2. 再运行功能测试程序 (`test_*.py`)
3. 最后运行完整测试程序

### 注意事项
- 确保RAG系统正在运行
- 检查API端点是否可访问
- 注意测试数据的准备
- 避免在生产环境中运行测试程序

## 常见问题

### Q: 测试程序运行失败怎么办？
A: 检查系统状态、网络连接、API配置等

### Q: 控制台出现"无法识别的文档结构"警告怎么办？
A: 使用 `test_doc_structure_fix.py` 测试程序验证修复效果，该程序专门处理新的文档结构格式

### Q: 来源信息显示"未知来源"怎么办？
A: 运行 `test_doc_structure_fix.py` 测试程序，检查是否还有未知来源，确认文档结构修复是否完全生效

### Q: 如何添加新的测试？
A: 在 `tools/` 目录下创建新的测试文件，遵循命名规范

### Q: 测试结果如何解读？
A: 查看控制台输出，关注✅和❌标记，理解测试逻辑

### Q: LLM答案显示"抱歉，没有找到相关内容"怎么办？
A: 运行 `test_llm_and_sources.py` 检查优化管道状态和LLM引擎配置

### Q: 来源信息显示"未知来源"怎么办？
A: 运行 `test_llm_and_sources.py` 检查元数据提取和文档结构

## 维护说明
- 定期更新测试程序以适应系统变化
- 保持测试数据的时效性
- 记录测试结果和发现的问题
- 及时修复测试程序中的bug
