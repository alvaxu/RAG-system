# 资金流入流出预测分析与预测方案建议书

## 1. 数据文件分析

本次预测任务主要围绕用户资金的申购和赎回金额进行。相关数据文件包括：

*   `user_balance_table.csv`: 核心数据文件，包含用户的申购（`total_purchase_amt`）和赎回（`total_redeem_amt`）金额，以及对应的 `report_date`。
*   `user_profile_table.csv`: 用户画像数据，可能包含用户的人口统计学信息、活跃度等，可作为外部特征。
*   `mfd_bank_shibor.csv`: 银行间拆放利率数据，宏观经济指标，可能影响用户资金行为。
*   `mfd_day_share_interest.csv`: 每日基金份额收益数据，可能影响用户赎回意愿。
*   `comp_predict_table.csv`: 竞赛提供的预测结果提交文件模板。

## 2. 探索性数据分析 (EDA)

### 2.1 趋势分析

对 `user_balance_table.csv` 中的 `total_purchase_amt` 和 `total_redeem_amt` 进行时间序列趋势分析，可以观察到以下现象：

*   **整体趋势**：申购和赎回金额通常表现出一定的波动性，可能存在季节性或周期性。
*   **节假日效应**：观察到在春节、国庆、端午等节假日期间，资金流入流出通常会有显著变化，例如节前申购高峰或节后赎回高峰。
*   **周末效应**：周末通常没有交易数据或数据量较小。

### 2.2 平稳性检验

对申购和赎回金额序列进行 ADF（Augmented Dickey-Fuller）平稳性检验是时间序列建模的关键一步：

*   **检验结果**：根据之前的分析，申购金额序列可能是平稳的（或弱平稳），而赎回金额序列可能非平稳。非平稳序列需要通过差分操作（如一阶差分）转换为平稳序列才能进行 ARIMA/SARIMA 建模。

### 2.3 季节性分析

通过绘制自相关函数（ACF）和偏自相关函数（PACF）图，或进行周期性分解，可以识别数据的季节性模式：

*   **周级别季节性**：由于周末和工作日资金行为的差异，可能存在周级别的季节性。
*   **月级别季节性**：月末、月初等时间点可能存在资金波动。
*   **年级别季节性**：受大型节假日或年度经济事件影响，可能存在年级别的季节性。

### 2.4 异常值与缺失值处理

*   **缺失值**：检查数据中是否存在缺失值，并根据情况选择填充（如前向填充、插值）或删除。
*   **异常值**：识别并处理异常的申购/赎回金额，避免其对模型训练产生不良影响。异常值可能是数据录入错误，也可能是特殊事件导致（如大型促销活动）。

## 3. 模型选择与方案建议

考虑到资金流入流出数据的特性，以下是几种建议的模型及其应用方案：

### 3.1 时间序列模型：SARIMAX

**SARIMAX (Seasonal Autoregressive Integrated Moving Average with eXogenous regressors)** 是处理带有趋势、季节性和外部变量的时间序列数据的强大模型。

*   **模型参数选择**：
    *   `d` (差分阶数)：通过 ADF 检验结果确定，对于非平稳序列进行差分，直到序列平稳。
    *   `p, q` (AR和MA阶数)：通过观察平稳序列的 ACF 和 PACF 图来初步判断，或使用 `pmdarima.auto_arima` 进行自动搜索，以最小化 AIC/BIC 等信息准则。
    *   `P, D, Q, S` (季节性参数)：`D` 通过季节性差分确定，`P, Q` 通过观察季节性 ACF 和 PACF 图来初步判断，`S` 为季节周期（例如，周季节性 S=7，年季节性 S=365）。`pmdarima.auto_arima` 也可以自动选择这些参数。
*   **外部变量 (eXogenous regressors)**：
    *   **日期特征**：星期几（独热编码）、是否是月末/月初、月份、季度。
    *   **节假日特征**：创建二元变量（0/1）表示是否是节假日，可以进一步细分节假日的类型（如春节、国庆等），或者考虑节假日的影响持续时间（节前、节中、节后）。
    *   **宏观经济指标**：`mfd_bank_shibor.csv` 中的数据（如 SHIBOR 利率）可以作为外部变量。
    *   **基金收益率**：`mfd_day_share_interest.csv` 中的数据。

### 3.2 机器学习模型：LightGBM / XGBoost

将时间序列预测问题转化为监督学习问题，构建丰富的特征集，然后使用 LightGBM 或 XGBoost 等梯度提升树模型进行预测。

*   **特征工程**：
    *   **滞后特征 (Lagged Features)**：过去几天的申购/赎回金额。这是最重要的特征之一。
    *   **滚动统计特征 (Rolling Statistics)**：过去 N 天的申购/赎回金额的均值、中位数、标准差、最大值、最小值等。
    *   **时间特征 (Time Features)**：星期几、月份、季度、年份、是否为周末、是否为节假日、距离最近节假日的日期等。这些特征可以直接捕捉日期相关的模式。
    *   **外部数据特征**：将 `user_profile_table.csv`, `mfd_bank_shibor.csv`, `mfd_day_share_interest.csv` 中的相关信息合并到主数据集中。
    *   **趋势特征**：可以尝试加入线性趋势或非线性趋势项。
*   **优势**：处理非线性关系、自动处理特征交互、速度快、效果好。

### 3.3 深度学习模型：LSTM

对于复杂的时间序列模式和长序列依赖，循环神经网络 (RNN) 特别是长短期记忆网络 (LSTM) 可能表现出色。

*   **输入特征**：与机器学习模型类似，可以将滞后特征、滚动统计特征、时间特征和外部数据特征作为 LSTM 模型的输入。
*   **网络结构**：可以设计单层或多层 LSTM 网络，并结合全连接层进行输出。考虑使用 Dropout 进行正则化。
*   **优势**：擅长捕捉时间序列中的长期依赖关系和复杂模式。

### 3.4 模型融合

结合不同模型的预测结果，通常可以获得比单一模型更好的性能。

*   **简单平均/加权平均**：对 SARIMAX、LightGBM/XGBoost、LSTM 等模型的预测结果进行简单平均或根据交叉验证性能进行加权平均。
*   **Stacking/Blending**：使用一个次级模型（如线性回归或简单树模型）学习如何结合多个基模型的预测。

## 4. 评估策略

采用合适的评估指标和验证方法来衡量模型性能：

*   **评估指标**：
    *   **RMSE (Root Mean Squared Error)**：衡量预测值与真实值之间的偏差，对大误差敏感。
    *   **MAE (Mean Absolute Error)**：衡量预测值与真实值之间绝对误差的平均值，鲁棒性较好。
*   **验证方法**：
    *   **时间序列交叉验证 (Time Series Cross-Validation)**：由于时间序列数据的顺序性，不能随机划分训练集和测试集。通常采用滚动预测（Rolling Forecast Origin）或扩展窗口（Expanding Window）的方法进行验证，确保测试集的数据始终在训练集之后。

## 5. 预测结果输出

最终预测结果应按照竞赛要求，输出到 CSV 文件中，格式为 `report_date, purchase, redeem`，且不包含表头。

以上是针对资金流入流出预测任务的分析与预测方案建议，希望对您有所帮助。 