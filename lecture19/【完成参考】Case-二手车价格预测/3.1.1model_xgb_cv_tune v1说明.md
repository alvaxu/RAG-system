# 3.1model_xgb_cv_tune v1.py 使用说明

## 一、程序功能简介

本程序实现了二手车价格预测的全流程，包括：
- 数据读取与基础特征工程
- 特征交互、分桶与编码
- 匿名特征PCA降维
- 特征归一化
- XGBoost参数调优（GridSearchCV）
- 5折交叉验证评估
- SHAP特征重要性分析
- 测试集预测与结果输出

适用于二手车价格回归建模场景，便于理解和扩展。

---

## 二、主要流程说明

### 1. 数据读取与预处理
- 读取训练集 `used_car_train_20200313.csv` 和测试集 `used_car_testB_20200421.csv`，以空格分隔。
- 合并数据，统一做特征工程处理。

### 2. 特征工程
- **时间特征**：提取注册年、月、创建年、月、车龄、注册年份分桶等。
- **缺失值处理**：数值型用中位数填充，分类型用众数填充。
- **异常值处理**：过滤极端价格、动力、公里数等异常样本。
- **特征交互与分桶**：如品牌-车型、品牌-车身型、品牌-注册年分桶、品牌-公里数分桶、动力分桶等。
- **类别特征编码**：LabelEncoder编码所有类别特征。
- **匿名特征PCA降维**：对15个匿名特征做PCA，保留10个主成分。
- **数值归一化**：对数值型特征做标准化。

### 3. 模型训练与调优
- **参数网格**：max_depth, learning_rate, n_estimators, subsample, colsample_bytree。
- **GridSearchCV**：以MAE为评分，5折交叉验证，自动搜索最优参数。
- **交叉验证评估**：用最优参数做5折CV，输出MAE和RMSE均值。

### 4. 特征重要性分析
- **SHAP分析**：输出SHAP特征重要性summary图，便于解释模型。

### 5. 预测与结果输出
- 用最优模型对测试集预测，输出结果为 `used_car_sample_submit_xgb_cv_tune.csv`。

---

## 三、输出内容

- 控制台输出：最优参数、最优MAE、5折CV MAE/RMSE均值
- 图片文件：`shap_feature_importance.png`（SHAP特征重要性图）
- 预测结果：`used_car_sample_submit_xgb_cv_tune.csv`

---

## 四、主要依赖

- Python 3.7 及以上
- pandas
- numpy
- scikit-learn
- xgboost
- shap
- matplotlib

安装依赖建议：
```bash
pip install pandas numpy scikit-learn xgboost shap matplotlib
```

---

## 五、硬件环境建议（估算）

- **内存**：建议 8GB 及以上（数据量较大，PCA和GridSearchCV会占用较多内存）
- **CPU**：建议 4核及以上（GridSearchCV和XGBoost支持多线程，n_jobs=-1）
- **硬盘**：剩余空间建议 2GB 以上（用于中间文件和结果输出）
- **显卡**：无需GPU，全部为CPU计算

> **备注**：在普通8GB内存的笔记本/台式机上可运行，但参数网格较大时GridSearchCV会较慢，建议耐心等待。

---

## 六、使用建议

- 若运行速度较慢，可适当缩小参数网格范围或减少n_estimators、K折数。
- 若内存不足，可分批处理或在服务器/云主机上运行。
- 若只需预测结果，可跳过SHAP分析部分。

---

## 七、联系方式

如有问题可随时反馈。

