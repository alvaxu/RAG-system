

---

# 二手车价格预测项目说明书

## 项目简介

本项目旨在通过多种机器学习模型（XGBoost、CatBoost、LightGBM）及其融合（Blending）方法，对二手车的交易价格进行高精度预测。项目流程包括数据特征工程、三大主流回归模型训练与预测、以及模型融合优化，最终输出比单一模型更优的预测结果。

---

## 文件结构

```
.
├── feature_engineering.py           # 特征工程与数据预处理
├── main_model_7000.py               # XGBoost模型训练与预测
├── main_model_catboost.py           # CatBoost模型训练与预测
├── main_model_lgb.py                # LightGBM模型训练与预测
├── main_model_blend.py              # 融合三模型的Blending预测
├── used_car_train_20200313.csv      # 原始训练数据
├── used_car_testB_20200421.csv      # 原始测试数据
├── train_features.csv               # 特征工程后的训练集
├── test_features.csv                # 特征工程后的测试集
├── main_model_7000_predict.csv      # XGBoost测试集预测
├── main_model_catboost_predict.csv  # CatBoost测试集预测
├── main_model_lgb_predict.csv       # LightGBM测试集预测
├── main_model_7000_val_pred.csv     # XGBoost验证集预测
├── main_model_catboost_val_pred.csv # CatBoost验证集预测
├── main_model_lgb_val_pred.csv      # LightGBM验证集预测
├── main_model_blend_predict.csv     # 融合模型测试集预测
├── requirements.txt                 # 依赖包列表
└── README.md                        # 项目说明
```

---

## 环境配置

1. **Python 版本**：建议 Python 3.8 及以上
2. **依赖安装**：
    ```bash
    pip install -r requirements.txt
    ```

---

## 运行流程

### 1. 特征工程

运行 `feature_engineering.py`，对原始数据进行清洗、特征构造、编码、归一化等处理，生成后续建模所需的 `train_features.csv` 和 `test_features.csv`。

```bash
python feature_engineering.py
```

### 2. 单模型训练与预测

分别运行以下脚本，完成三种主流回归模型的训练、验证和测试集预测：

#### XGBoost
```bash
python main_model_7000.py
```
- 输出：`main_model_7000_predict.csv`、`main_model_7000_val_pred.csv`

#### CatBoost
```bash
python main_model_catboost.py
```
- 输出：`main_model_catboost_predict.csv`、`main_model_catboost_val_pred.csv`

#### LightGBM
```bash
python main_model_lgb.py
```
- 输出：`main_model_lgb_predict.csv`、`main_model_lgb_val_pred.csv`

每个模型脚本均会自动保存验证集预测结果（用于后续融合）。

### 3. 融合（Blending）

运行融合脚本，对三种模型的预测结果进行加权融合，自动搜索最优权重，使验证集MAE最小化，输出最终融合预测。

```bash
python main_model_blend.py
```
- 输出：`main_model_blend_predict.csv`

---

## 特征工程说明

- **时间特征**：注册年、月、日，创建年、月、日，车龄、是否新车、每年公里数等
- **分箱特征**：公里数、功率、注册年份等分段
- **交互特征**：品牌与分箱、品牌与车龄、公里数*车龄、功率*车龄等
- **类别特征编码**：高基数特征频数编码、LabelEncoder、目标编码（brand/model）
- **匿名特征降维**：PCA对匿名特征降维
- **归一化**：数值特征标准化
- **异常值处理**：分位数裁剪、异常标记

---

## 各模型参数与表现

| 模型      | 主要参数                      | 验证集MAE | 测试集成绩（融合前） |
|-----------|------------------------------|-----------|---------------------|
| XGBoost   | n_estimators=7000, max_depth=10, learning_rate=0.03 | 504.94    | 486.96              |
| CatBoost  | iterations=5000, depth=10, learning_rate=0.03       | 525.58    | 514.57              |
| LightGBM  | num_boost_round=20000, max_depth=10, learning_rate=0.03 | 550.85    | 530.65              |
| **融合**  | 自动调优权重（如0.55/0.30/0.15）                    | 490.97    | 478.13              |

> 具体融合权重和成绩以 `main_model_blend.py` 输出为准。

---

## 结果输出

- `main_model_7000_predict.csv`、`main_model_catboost_predict.csv`、`main_model_lgb_predict.csv`：各模型测试集预测
- `main_model_blend_predict.csv`：融合模型最终测试集预测（提交此结果）
- `main_model_7000_val_pred.csv`、`main_model_catboost_val_pred.csv`、`main_model_lgb_val_pred.csv`：各模型验证集预测（用于融合调优）

---

## 复现与自定义

- 可根据实际需求调整各模型参数、特征工程策略或融合方式。
- 若需更复杂的融合（如Stacking、Bagging等），可在 `main_model_blend.py` 基础上扩展。

---

## 贡献与建议

如有任何疑问、建议或改进想法，欢迎在项目仓库留言或提交PR！

---

**本项目通过系统的特征工程与多模型融合，有效提升了二手车价格预测的精度。最终提交融合模型的预测结果。**

---

