# 4.2.1model_xgb_more_feature_save_train_result_4000(best).py 与 5.3_xgb_optimize_feature.py 差异对比

## 1. 数据读取与基础处理
- **4.2.1**
  - 训练集和测试集合并，测试集`price`设为-1。
  - 没有添加`is_test`标识列。
- **5.3**
  - 训练集和测试集分别添加`is_test`标识列，合并后区分数据来源。
  - 明确输出常量特征处理信息。

## 2. 特征工程
### 时间特征
- **4.2.1**
  - 处理了`regDate`、`creatDate`，生成了年、月、日、车龄、是否新车、相对年份、季节等。
  - 车龄分段、注册年份分段、公里数分段、功率分段、品牌相关分段。
- **5.3**
  - 处理方式基本一致，但部分缺失值填充推迟到统一缺失值处理环节。
  - 明确输出每一步处理进度。

### 缺失值处理
- **4.2.1**
  - 只对部分特征做缺失标记，数值型用中位数，类别型用众数填充。
- **5.3**
  - 分类了不同类型特征的缺失处理方式（新类别、分组中位数、全局中位数），并统一生成缺失指示特征。
  - 缺失处理更细致，且有详细日志输出。

### 异常值处理
- **4.2.1**
  - 仅对训练集做异常值过滤和clip，生成异常值标记。
- **5.3**
  - 训练集和测试集都做clip，异常值处理更细致。

### 统计特征
- **4.2.1**
  - 生成品牌均值/中位数/标准差/计数等，保存joblib。
- **5.3**
  - 统计特征更丰富，增加了区域-品牌统计、品牌-车龄-公里等。
  - 统计特征不再保存joblib。

### 特征交互
- **4.2.1**
  - 主要有品牌与其他特征的拼接、km_age、power_age、log特征。
- **5.3**
  - 交互特征更丰富，增加了多种组合和交互。

### 高基数类别特征
- **4.2.1**
  - 只对部分高基数特征做频数编码，保存joblib。
- **5.3**
  - 对更多高基数特征做频数编码，不再保存joblib。

### 其它类别特征编码
- **4.2.1**
  - 用LabelEncoder，保存joblib。
- **5.3**
  - 用LabelEncoder，不再保存joblib。

### 匿名特征PCA
- **4.2.1**
  - 对v_0~v_14做PCA，保存模型。
- **5.3**
  - 同样做PCA，但不保存模型。

### 数值归一化
- **4.2.1**
  - 只对部分特征做归一化，保存scaler。
- **5.3**
  - 归一化特征更全面，不保存scaler。

## 3. 特征列表与数据集划分
- **4.2.1**
  - 特征列表较长，包含所有工程特征。
  - 没有`is_test`区分，测试集用`price==-1`。
- **5.3**
  - 特征列表更精细，部分特征只保留重要的。
  - 用`is_test`区分训练和测试。

## 4. 特征唯一性与类型处理
- **4.2.1**
  - 检查重复特征名，尝试将object转float，若失败则警告。
- **5.3**
  - 明确检查object类型，直接报错，要求全部为数值型。

## 5. 模型训练与参数
- **4.2.1**
  - XGBRegressor参数：max_depth=10, learning_rate=0.03, n_estimators=4000, subsample=0.8, colsample_bytree=0.9。
  - 训练时未用early_stopping。
- **5.3**
  - XGBRegressor参数更灵活，支持调优。
  - 支持early_stopping，eval_metric='rmse'。

## 6. 结果输出
- **4.2.1**
  - 保存模型、预测结果。
  - 评估、绘图部分注释掉。
- **5.3**
  - 保存模型、预测结果。
  - 评估（MAE、RMSE）、绘制预测对比图、特征重要性图。

## 7. 其它
- **4.2.1**
  - 保存了大量joblib文件（特征工程相关）。
- **5.3**
  - 不再保存特征工程相关joblib，仅保存最终模型。

---

# 总结
- 5.3_xgb_optimize_feature.py 在特征工程、特征处理、日志输出、模型评估等方面更为细致和规范，便于后续调优和分析。
- 4.2.1model_xgb_more_feature_save_train_result_4000(best).py 更偏向于一次性工程实现，特征工程和模型保存更为繁琐。 