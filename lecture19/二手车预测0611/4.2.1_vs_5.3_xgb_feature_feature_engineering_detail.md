# 4.2.1model_xgb_more_feature_save_train_result_4000(best).py 与 5.3_xgb_optimize_feature.py 特征工程详细对比

## 1. 原始特征处理

### 4.2.1
- 直接读取原始数据，合并训练集和测试集。
- 主要原始特征包括：`SaleID`, `name`, `regDate`, `model`, `brand`, `bodyType`, `fuelType`, `gearbox`, `power`, `kilometer`, `notRepairedDamage`, `regionCode`, `seller`, `offerType`, `creatDate`。
- 测试集`price`设为-1。

### 5.3
- 读取数据后，分别为训练集和测试集添加`is_test`标识。
- 明确删除常量特征（如`seller`、`offerType`），并输出日志。
- 原始特征与4.2.1基本一致。

**优缺点分析**：
- 5.3的`is_test`标识更清晰，便于后续分割。
- 明确删除无用特征，提升数据质量。

**推荐做法**：

- 明确区分训练/测试，删除常量或无用特征。

---

## 2. 时间特征衍生

### 4.2.1
- 处理`regDate`、`creatDate`，生成：
  - `regDate_dt`, `creatDate_dt`（datetime格式）
  - `car_age_days`, `car_age`（车辆使用年限，天/年）
  - `regYear`, `regMonth`, `regDay`, `creatYear`, `creatMonth`, `creatDay`
  - `is_new_car`（是否新车）
  - `regYear_from_now`, `creatYear_from_now`（相对年份）
  - `regSeason`, `creatSeason`（季节）
  - `km_per_year`（每年行驶公里数）
  - `age_segment`（车龄分段）
  - `regYear_bin`（注册年份分段）
  - `km_bin`（公里数分段）
  - `power_bin`（功率分段）
  - 品牌相关分段（如`brand_km_bin`等）

### 5.3
- 时间特征衍生方式与4.2.1基本一致。
- 但部分衍生特征的缺失值填充推迟到统一缺失值处理环节。
- 日志输出更详细。

**优缺点分析**：
- 5.3的处理更规范，便于追踪每一步。
- 统一缺失值处理更安全，减少遗漏。

**推荐做法**：
- 时间特征衍生应规范、统一，缺失值处理应集中。

---

## 3. 缺失值处理

### 4.2.1
- 只对部分特征做缺失标记（如`bodyType_missing`等）。
- 数值型用中位数填充，类别型用众数填充。
- 缺失标记特征直接加到数据中。

### 5.3
- 分类别特征、数值特征分别采用不同策略：
  - 类别特征：填充新类别（如'Unknown'）
  - 数值特征：有的按品牌分组中位数填充，有的用全局中位数
- 所有可能缺失的特征都生成缺失指示符（`xxx_missing`）。
- 日志详细输出每个特征的缺失处理过程。

**优缺点分析**：
- 5.3的缺失处理更细致，能保留更多信息，减少信息损失。
- 4.2.1处理简单，可能遗漏部分特征的缺失标记。

**推荐做法**：
- 分类别、数值特征分开处理，生成缺失指示符，填充方式应结合业务和分组统计。

---

## 4. 异常值处理

### 4.2.1
- 仅对训练集做异常值过滤（如`price`、`power`、`kilometer`），并clip到合理区间。
- 生成异常值标记（如`power_outlier`）。

### 5.3
- 对训练集和测试集都做clip，异常值处理更细致。
- clip区间基于分位数和IQR。
- 生成异常值指示特征。

**优缺点分析**：
- 5.3对异常值处理更全面，防止测试集出现极端值影响模型。
- 4.2.1只处理训练集，测试集可能有未处理的极端值。

**推荐做法**：
- clip应覆盖全数据，异常值指示特征有助于模型学习。

---

## 5. 统计特征

### 4.2.1
- 生成品牌均值/中位数/标准差/计数等统计特征。
- 统计特征保存为joblib文件。

### 5.3
- 统计特征更丰富，增加了区域-品牌统计、品牌-车龄-公里等。
- 统计特征不再保存joblib，仅用于当前流程。
- 统计特征缺失时用全局中位数填充。

**优缺点分析**：
- 5.3统计特征更丰富，且缺失填充更合理。
- 4.2.1保存joblib便于后续复用，但流程繁琐。

**推荐做法**：
- 统计特征应丰富，缺失填充要合理，是否保存视实际需求。

---

## 6. 特征交互与衍生

### 4.2.1
- 品牌与其他特征拼接（如`brand_model`等）。
- 生成`km_age`、`power_age`、`power_log`、`kilometer_log`、`car_age_log`等。

### 5.3
- 交互特征更丰富，增加了多种组合和交互（如`brand_model_age`、`powertrain_type`、`v3_car_age_interaction`等）。
- 增加了分位数分箱（如`power_10bins`）。

**优缺点分析**：
- 5.3交互特征更丰富，有助于提升模型表达能力。
- 4.2.1交互特征较少，信息利用不充分。

**推荐做法**：
- 结合业务和特征重要性，设计多样化交互特征。

---

## 7. 高基数类别特征编码

### 4.2.1
- 只对部分高基数特征做频数编码，保存joblib。

### 5.3
- 对更多高基数特征做频数编码，不再保存joblib。
- 频数编码映射直接用于当前流程。

**优缺点分析**：
- 5.3编码更全面，减少高基数特征对模型的影响。
- 4.2.1保存joblib便于复用，但流程繁琐。

**推荐做法**：
- 高基数特征建议用频数编码，是否保存映射视需求。

---

## 8. 其它类别特征编码

### 4.2.1
- 用LabelEncoder编码，保存joblib。

### 5.3
- 用LabelEncoder编码，不再保存joblib。
- 编码前统一转str，防止类型问题。

**优缺点分析**：
- 5.3编码更规范，减少类型报错。
- 4.2.1保存joblib便于复用。

**推荐做法**：
- LabelEncoder编码应规范，建议不保存joblib，直接在流程内处理。

---

## 9. 匿名特征PCA降维

### 4.2.1
- 对v_0~v_14做PCA，生成10个主成分，保存PCA模型。

### 5.3
- 同样做PCA，但不保存模型。
- PCA特征直接加入数据。

**优缺点分析**：
- 5.3流程更简洁，PCA特征直接用。
- 4.2.1保存PCA模型便于复用。

**推荐做法**：
- 若流程稳定可不保存PCA模型，需复用时再保存。

---

## 10. 数值归一化

### 4.2.1
- 只对部分特征做归一化，保存scaler。

### 5.3
- 归一化特征更全面，不保存scaler。

**优缺点分析**：
- 5.3归一化更全面，减少特征量纲影响。
- 4.2.1保存scaler便于复用。

**推荐做法**：
- 建议归一化所有数值特征，是否保存scaler视需求。

---

# 总结与推荐

- **5.3_xgb_optimize_feature.py** 在特征工程各环节更细致、全面，日志输出丰富，便于调试和追踪。
- **4.2.1model_xgb_more_feature_save_train_result_4000(best).py** 流程更偏向一次性工程实现，特征工程和模型保存更为繁琐。

## 推荐特征工程处理方法：
1. 明确区分训练/测试，删除无用特征。
2. 时间特征衍生应规范、统一，缺失值处理应集中。
3. 分类别、数值特征分开处理，生成缺失指示符，填充方式结合分组统计。
4. clip应覆盖全数据，异常值指示特征有助于模型学习。
5. 统计特征应丰富，缺失填充要合理。
6. 结合业务和特征重要性，设计多样化交互特征。
7. 高基数特征建议用频数编码。
8. LabelEncoder编码应规范，建议不保存joblib，直接在流程内处理。
9. 若流程稳定可不保存PCA模型，需复用时再保存。
10. 建议归一化所有数值特征。 