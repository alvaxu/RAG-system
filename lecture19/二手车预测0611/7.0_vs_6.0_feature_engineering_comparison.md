# 6.0 vs 7.0 特征工程详细对比

## 1. 脚本定位与主要区别
- **6.0_blending.py**：在5.8基础上，采用优化特征，三模型（XGBoost、CatBoost、LightGBM）Blending，特征工程与4.2.1保持一致。
- **7.0_blending_eda.py**：在6.0基础上进一步优化特征工程，增加特征筛选、唯一值剔除、方差过滤、特征统计输出，特征工程更自动化和健壮。

---

## 2. 特征工程流程对比

| 步骤 | 6.0_blending.py | 7.0_blending_eda.py |
|------|----------------|---------------------|
| 数据读取 | 训练/测试拼接 | 训练/测试拼接 |
| 删除无用特征 | seller, offerType | seller, offerType |
| 缺失值处理 | 填充+缺失指示 | 填充+缺失指示，notRepairedDamage特殊处理，name加入缺失指示 |
| 时间特征衍生 | regDate/creatDate衍生，car_age, regYear等 | regDate/creatDate衍生，car_age, regYear等，car_age裁剪 |
| 异常值处理 | power/kilometer/v_0分位裁剪+outlier | power/kilometer/v_0分位裁剪+outlier，car_age裁剪 |
| 统计特征 | brand_price_mean等 | brand_price_mean等 |
| 特征交互 | brand_model, brand_bodyType等 | brand_model, brand_bodyType等 |
| 高基数频数编码 | model, brand_model等 | model, brand_model, name等 |
| LabelEncoder | 多类别特征 | 多类别特征，name加入 |
| 匿名特征PCA | v_0~v_14降维 | v_0~v_14降维 |
| 数值归一化 | power, kilometer等 | power, kilometer等 |
| 特征冗余/唯一值 | - | 剔除唯一值/常量特征 |
| 方差过滤 | - | VarianceThreshold(1e-5) |
| 最终特征列表 | 明确列出 | 自动筛选，数值型且通过方差过滤 |

---

## 3. 最终特征数量与特征列表

- **6.0_blending.py**：最终特征数量 92
- **7.0_blending_eda.py**：最终特征数量 76

### 7.0特征列表（部分，详见7.0_blending_eda_features.txt）
- name, model, brand, bodyType, fuelType, gearbox, power, kilometer, notRepairedDamage, regionCode, v_0~v_14, ...
- 统计特征、交互特征、PCA特征、缺失指示、outlier、brand_price_mean等

### 6.0特征列表（部分，详见6.0_blending_output.txt）
- model_freq, brand_model_freq, brand_power_bin_freq, brand_age_segment_freq, brand, bodyType, fuelType, gearbox, regionCode, regYear_bin, km_bin, power_bin, age_segment, brand_bodyType, brand_regYear_bin, brand_km_bin, notRepairedDamage, power, kilometer, car_age, regYear, regMonth, creatYear, creatMonth, regDay, creatDay, is_new_car, regYear_from_now, creatYear_from_now, regSeason, creatSeason, km_per_year, brand_price_mean, brand_price_median, brand_price_std, brand_price_count, brand_price_ratio, km_age, power_age, power_log, kilometer_log, car_age_log, v_0~v_14, v_pca_0~v_pca_9, 缺失指示, outlier

### 主要差异
- 7.0自动剔除唯一值/常量特征，部分缺失指示和outlier被剔除
- 7.0增加了name相关特征（如name, name_freq, name_missing）
- 7.0特征选择更严格，特征数减少

---

## 4. 特征重要性Top50对比

### 6.0_blending_XGBoost特征重要性Top50
- 头部特征：v_3, v_12, v_0, v_pca_0, v_pca_1, notRepairedDamage, v_10, km_age, kilometer_log, km_bin, power_log, car_age_log, power, regYear, ...
- 以匿名特征v_3, v_12, v_0为主，PCA特征、notRepairedDamage、km_age等也较重要

### 7.0_blending_eda_XGBoost特征重要性Top50
- 头部特征：v_3, v_12, v_0, v_pca_0, v_pca_2, notRepairedDamage, v_pca_1, km_age, v_10, km_bin, power_log, car_age_log, regYear_from_now, ...
- 头部特征与6.0高度重合，但排序略有变化，部分新特征如regYear_from_now、brand_price_std等进入Top50

---

## 5. 模型表现对比

| 指标 | 6.0_blending.py | 7.0_blending_eda.py |
|------|----------------|---------------------|
| Blending验证集 MAE | 540.1930 | 536.9245 |
| Blending验证集 RMSE | 1192.8828 | 1182.4833 |
| XGBoost权重 | 0.5637 | 0.6183 |
| CatBoost权重 | 0.1757 | 0.1347 |
| LightGBM权重 | 0.2710 | 0.2573 |

- 7.0整体表现略优于6.0，MAE和RMSE均有小幅提升。
- 7.0中XGBoost权重提升，CatBoost和LightGBM略降。

---

## 6. 优缺点与优化点总结

### 6.0_blending.py
- **优点**：特征工程流程清晰，特征丰富，覆盖多种统计、交互、PCA、归一化、缺失指示等。
- **缺点**：特征选择较为静态，未自动剔除常量/唯一值，部分冗余特征可能影响模型泛化。

### 7.0_blending_eda.py
- **优点**：
  - 自动剔除唯一值/常量特征，特征更精炼。
  - 方差过滤提升特征有效性。
  - 增加name相关特征，特征覆盖更全。
  - 特征统计、输出更详细，便于EDA和后续分析。
  - 模型表现略有提升。
- **缺点**：
  - 部分特征如部分缺失指示、outlier被剔除，需关注是否丢失有用信息。
  - 特征选择更严格，可能遗漏部分弱相关特征。

---

## 7. 结论与建议
- 7.0在特征工程自动化、特征选择、模型表现等方面优于6.0，建议以7.0为主线继续优化。
- 可进一步探索：
  - 对剔除的缺失指示、outlier特征做单独重要性分析，决定是否保留。
  - 针对name等高基数特征做更深入的特征衍生。
  - 结合特征重要性和模型表现，做特征递归消融实验。

---

> 详细特征列表、统计、重要性排名等详见 `7.0_blending_eda_features.txt`、`6.0_blending_output.txt`、`7.0_blending_output.txt`。 