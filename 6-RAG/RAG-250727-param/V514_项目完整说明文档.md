# RAG智能问答系统 - 完整项目说明文档

## 📋 项目概述

### 项目简介
本项目是一个基于RAG（Retrieval-Augmented Generation）技术的智能问答系统，专门用于处理和分析企业文档。系统支持PDF和Markdown格式的文档处理，具备文本问答、图片识别、表格处理等多项功能。

### 核心特性
- ✅ **多格式文档支持**: PDF、Markdown文档处理
- ✅ **智能文本问答**: 基于向量检索的精准问答
- ✅ **图片识别与搜索**: 支持文档中图片的识别和查询
- ✅ **表格数据处理**: 自动识别和结构化表格内容
- ✅ **记忆管理**: 支持对话历史和用户记忆
- ✅ **Web界面**: 友好的Web交互界面
- ✅ **配置管理**: 灵活的配置系统

### 技术栈
- **后端框架**: Python + Flask
- **向量数据库**: FAISS
- **大语言模型**: 通义千问 (DashScope)
- **文档处理**: LangChain
- **前端**: HTML + JavaScript
- **配置管理**: JSON配置文件

---

## 🏗️ 系统架构

### 整体架构图
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   文档输入层     │    │   处理管道层     │    │   存储层        │
│                 │    │                 │    │                 │
│ • PDF文件       │───▶│ • 文档分块      │───▶│ • 向量数据库    │
│ • Markdown文件  │    │ • 图片提取      │    │ • 记忆数据库    │
│ • 图片文件      │    │ • 表格处理      │    │ • 配置文件      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │
                                ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   应用层        │    │   服务层        │    │   用户界面层    │
│                 │    │                 │    │                 │
│ • 问答系统      │◀───│ • Web API       │◀───│ • Web界面       │
│ • 记忆管理      │    │ • 向量检索      │    │ • 命令行工具    │
│ • 配置管理      │    │ • LLM调用       │    │ • 状态监控      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 核心模块说明

#### 1. 文档处理模块 (`document_processing/`)
- **pipeline.py**: 统一处理管道，协调各组件
- **document_chunker.py**: 文档分块处理
- **image_processor.py**: 图片提取和处理
- **table_processor.py**: 表格识别和结构化
- **vector_generator.py**: 向量数据库生成

#### 2. 核心服务模块 (`core/`)
- **qa_system.py**: 问答系统核心逻辑
- **memory_manager.py**: 记忆管理
- **vector_store.py**: 向量存储管理

#### 3. 配置管理模块 (`config/`)
- **settings.py**: 系统配置定义
- **config_manager.py**: 配置管理工具

#### 4. Web服务模块 (`api/`)
- **app.py**: Flask应用主文件
- **routes.py**: API路由定义

---

## 🚀 功能特性详解

### 1. 文档处理功能

#### PDF文档处理
```bash
# 从PDF开始处理
python V501_simplified_document_processor.py --mode pdf
```
- 自动PDF转Markdown
- 图片提取和保存
- 表格识别和结构化
- 文档分块和向量化

#### Markdown文档处理
```bash
# 从Markdown开始处理
python V501_simplified_document_processor.py --mode markdown
```
- 直接处理Markdown文件
- 提取内嵌图片
- 识别表格结构
- 生成向量表示

### 2. 智能问答功能

#### 文本问答
- 基于语义相似度的文档检索
- 上下文感知的答案生成
- 多文档信息融合

#### 图片搜索
- 图片类型识别和分类
- 图片元数据管理
- 图片相关查询支持

#### 表格处理
- 表格结构识别
- 表格数据向量化
- 表格查询支持

### 3. 记忆管理功能
- 会话记忆：保存当前对话上下文
- 用户记忆：长期用户偏好和习惯
- 记忆检索：智能匹配相关历史信息

### 4. Web界面功能
- 实时问答界面
- 文档上传和管理
- 对话历史查看
- 系统状态监控

---

## 📁 项目文件结构

```
RAG-250727-param/
├── 📁 api/                          # Web API模块
│   ├── __init__.py
│   ├── app.py                       # Flask应用
│   └── routes.py                    # API路由
├── 📁 config/                       # 配置管理
│   ├── __init__.py
│   ├── config_manager.py            # 配置管理器
│   ├── paths.py                     # 路径配置
│   └── settings.py                  # 设置定义
├── 📁 core/                         # 核心服务
│   ├── __init__.py
│   ├── memory_manager.py            # 记忆管理
│   ├── qa_system.py                 # 问答系统
│   └── vector_store.py              # 向量存储
├── 📁 document_processing/          # 文档处理
│   ├── __init__.py
│   ├── document_chunker.py          # 文档分块
│   ├── enhanced_chunker.py          # 增强分块
│   ├── image_extractor.py           # 图片提取
│   ├── image_processor.py           # 图片处理
│   ├── markdown_processor.py        # Markdown处理
│   ├── pdf_processor.py             # PDF处理
│   ├── pipeline.py                  # 处理管道
│   ├── table_processor.py           # 表格处理
│   └── vector_generator.py          # 向量生成
├── 📁 logs/                         # 日志文件
├── 📁 memory_db/                    # 记忆数据库
├── 📁 md_test/                      # 测试文档
│   └── 📁 images/                   # 测试图片
├── 📁 pdf_test/                     # 测试PDF
├── 📁 vector_db_test/               # 向量数据库
├── 📁 web_app_test/                 # Web测试
├── 📄 V501_simplified_document_processor.py  # 简化文档处理器
├── 📄 V503_unified_main.py          # 统一主程序
├── 📄 V512_test_qa_system.py        # 问答系统测试
├── 📄 V513_recreate_vector_db.py    # 向量数据库重建
├── 📄 V514_项目完整说明文档.md       # 本文档
├── 📄 config.json                   # 配置文件
├── 📄 requirements.txt               # 依赖包
└── 📄 项目交付文档.md                # 项目交付文档
```

---

## 🛠️ 安装和配置

### 1. 环境要求
- Python 3.8+
- 通义千问API密钥
- 足够的磁盘空间（用于向量数据库）

### 2. 安装步骤

#### 克隆项目
```bash
git clone <项目地址>
cd RAG-250727-param
```

#### 安装依赖
```bash
pip install -r requirements.txt
```

#### 配置API密钥
```bash
# 设置环境变量
export MY_DASHSCOPE_API_KEY="你的API密钥"

# 或在Windows中
set MY_DASHSCOPE_API_KEY=你的API密钥
```

#### 验证配置
```bash
python V501_simplified_document_processor.py --validate
```

### 3. 配置文件说明

#### config.json 主要配置项
```json
{
  "dashscope_api_key": "你的API密钥",
  "pdf_dir": "./pdf_test",
  "md_dir": "./md_test", 
  "output_dir": "./output",
  "vector_db_dir": "./vector_db_test",
  "memory_db_dir": "./memory_db",
  "log_level": "INFO"
}
```

---

## 📖 使用指南

### 1. 快速开始

#### 步骤1: 准备文档
将PDF或Markdown文件放入相应目录：
- PDF文件 → `pdf_test/`
- Markdown文件 → `md_test/`

#### 步骤2: 处理文档
```bash
# 处理PDF文档
python V501_simplified_document_processor.py --mode pdf

# 处理Markdown文档  
python V501_simplified_document_processor.py --mode markdown
```

#### 步骤3: 启动Web服务
```bash
python V503_unified_main.py --mode web
```

#### 步骤4: 开始问答
打开浏览器访问 `http://localhost:5000`

### 2. 命令行使用

#### 文档处理
```bash
# 使用默认配置处理PDF
python V501_simplified_document_processor.py --mode pdf

# 指定输入输出目录
python V501_simplified_document_processor.py --mode pdf --input ./my_pdfs --output ./my_output

# 处理Markdown文档
python V501_simplified_document_processor.py --mode markdown
```

#### 问答测试
```bash
# 测试问答系统
python V503_unified_main.py --mode qa --question "中芯国际的产能利用率如何？"

# 不使用记忆的问答
python V503_unified_main.py --mode qa --question "文档中有哪些图片？" --no-memory
```

#### 系统状态
```bash
# 查看系统状态
python V503_unified_main.py --mode status
```

### 3. Web界面使用

#### 主要功能
1. **文档上传**: 支持PDF和Markdown文件上传
2. **智能问答**: 输入问题，获取AI回答
3. **对话历史**: 查看历史对话记录
4. **系统监控**: 查看系统运行状态

#### 使用技巧
- 使用具体问题获得更准确的回答
- 图片相关问题会自动搜索图片内容
- 系统会记住对话上下文，提供连贯的回答

---

## 🔧 故障排除

### 常见问题及解决方案

#### 1. 向量数据库加载失败
**问题**: `cannot unpack non-iterable InMemoryDocstore object`
**解决**: 
```bash
python V513_recreate_vector_db.py
```

#### 2. API密钥错误
**问题**: `未配置有效的DashScope API密钥`
**解决**: 检查环境变量设置
```bash
echo $MY_DASHSCOPE_API_KEY  # Linux/Mac
echo %MY_DASHSCOPE_API_KEY% # Windows
```

#### 3. 文档内容为空
**问题**: 问答系统返回"没有找到相关信息"
**解决**: 重新生成向量数据库，确保文档内容正确保存

#### 4. 图片搜索不工作
**问题**: 图片相关问题无法正确回答
**解决**: 检查图片提取和向量化过程

### 调试工具

#### 测试脚本
```bash
# 测试问答系统
python V512_test_qa_system.py

# 检查向量数据库
python V510_check_image_vectors.py
```

#### 日志查看
```bash
# 查看处理日志
tail -f document_processing.log

# 查看系统日志
tail -f logs/app.log
```

---

## 📊 性能优化

### 1. 向量数据库优化
- 使用FAISS进行高效向量检索
- 支持GPU加速（如果可用）
- 定期重建向量数据库以优化性能

### 2. 内存管理
- 实现文档分块减少内存占用
- 使用流式处理大文件
- 定期清理临时文件

### 3. 响应速度优化
- 缓存常用查询结果
- 异步处理文档上传
- 优化向量检索参数

---

## 🔄 版本历史

### V5.x 系列（当前版本）
- **V501**: 简化文档处理器
- **V503**: 统一主程序
- **V510-V514**: 问题修复和功能完善

### 主要改进
1. **向量数据库兼容性**: 修复FAISS版本兼容问题
2. **图片搜索功能**: 新增图片识别和搜索
3. **问答系统优化**: 改进LLM调用方式
4. **配置管理**: 完善配置系统
5. **错误处理**: 增强错误处理和日志记录

---

## 🎯 未来规划

### 短期目标
- [ ] 支持更多文档格式（Word、Excel等）
- [ ] 优化图片识别准确率
- [ ] 增加多语言支持
- [ ] 改进Web界面用户体验

### 长期目标
- [ ] 支持实时文档更新
- [ ] 集成更多LLM模型
- [ ] 实现分布式部署
- [ ] 添加用户权限管理

---

## 📞 技术支持

### 联系方式
- **项目维护**: [维护者信息]
- **问题反馈**: [GitHub Issues链接]
- **文档更新**: [文档仓库链接]

### 贡献指南
欢迎提交Issue和Pull Request来改进项目！

---

## 📄 许可证

本项目采用 [许可证类型] 许可证，详见 LICENSE 文件。

---

*最后更新时间: 2024年7月29日*
*文档版本: V1.0* 