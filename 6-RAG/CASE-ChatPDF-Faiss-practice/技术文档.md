# ChatPDF 项目技术文档

## 1. 项目概述

### 1.1 项目目的
本项目旨在构建一个基于大语言模型的智能 PDF 文档问答系统，能够：
- 解析 PDF 文档内容
- 将文档内容转换为向量表示并存储
- 支持用户通过自然语言提问
- 基于文档内容生成准确回答
- 提供回答的来源信息

### 1.2 技术特点
- 使用通义千问（Qwen）系列模型进行问答
- 采用 FAISS 向量数据库进行相似度搜索
- 使用 DashScope API 进行文本向量化
- 支持中文文档处理
- 提供来源追踪功能

## 2. 系统架构

### 2.1 整体架构
```
chatpdf/
├── config.py           # 配置文件
├── pdf_processor.py    # PDF处理模块
├── vector_store.py     # 向量数据库管理
├── qa_chain.py         # 问答处理模块
└── main.py            # 主程序入口
```

### 2.2 数据流程
1. PDF 文档 → 文本提取 → 文本分块
2. 文本块 → 向量化 → 向量存储
3. 用户问题 → 向量化 → 相似度搜索
4. 相关文本 → 大模型 → 答案生成

## 3. 核心模块

### 3.1 PDF 处理模块 (pdf_processor.py)
#### 功能
- PDF 文档解析
- 文本提取
- 文本分块
- 元数据生成

#### 技术实现
- 使用 PyPDF2 进行 PDF 解析
- 自定义文本分块算法
- 支持按页存储元数据

#### 关键参数
```python
CHUNK_SIZE = 1000      # 文本块大小
CHUNK_OVERLAP = 200    # 文本块重叠大小
```

### 3.2 向量存储模块 (vector_store.py)
#### 功能
- 文本向量化
- 向量存储
- 相似度搜索

#### 技术实现
- 使用 DashScopeEmbeddings 进行文本向量化
- 使用 FAISS 进行向量存储和检索
- 支持元数据关联

#### 关键配置
```python
EMBEDDING_MODEL = "text-embedding-v1"  # 向量化模型
DIMENSION = 1536                       # 向量维度
```

### 3.3 问答处理模块 (qa_chain.py)
#### 功能
- 问题理解
- 上下文检索
- 答案生成
- 来源追踪

#### 技术实现
- 使用 Tongyi 模型进行问答
- 使用 load_qa_chain 构建问答链
- 支持上下文检索和答案生成

#### 关键参数
```python
LLM_MODEL = "qwen-turbo"  # 大语言模型
TEMPERATURE = 0.7         # 生成温度
```

## 4. 配置管理

### 4.1 环境配置
- 需要设置 DASHSCOPE_API_KEY 环境变量
- 支持自定义模型参数
- 可配置文本处理参数

### 4.2 依赖管理
```python
langchain==0.1.0
langchain-community==0.0.13
PyPDF2==3.0.1
faiss-cpu==1.7.4
dashscope==1.13.3
numpy==1.24.3
```

## 5. 使用说明

### 5.1 环境准备
1. 安装依赖：
```bash
pip install -r requirements.txt
```

2. 设置环境变量：
```bash
export DASHSCOPE_API_KEY=your_api_key
```

### 5.2 运行程序
```bash
python main.py
```

### 5.3 交互流程
1. 输入 PDF 文件路径
2. 等待文档处理完成
3. 输入问题开始问答
4. 输入"退出"结束对话

## 6. 注意事项

### 6.1 性能考虑
- 文本分块大小影响处理效果
- 向量维度影响存储空间
- API 调用频率影响响应速度

### 6.2 限制说明
- 需要有效的 DashScope API 密钥
- PDF 文档需要可读
- 中文文档处理效果更好

### 6.3 优化建议
- 可添加文档缓存机制
- 可优化文本分块策略
- 可增加错误重试机制

## 7. 后续规划

### 7.1 功能扩展
- 支持更多文档格式
- 添加批量处理功能
- 增加用户界面

### 7.2 性能优化
- 优化向量检索效率
- 改进文本分块算法
- 添加缓存机制

### 7.3 应用场景
- 企业文档智能问答
- 教育资料智能检索
- 法律文档智能分析
