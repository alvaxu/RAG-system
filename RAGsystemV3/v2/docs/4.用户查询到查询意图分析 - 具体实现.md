## ğŸ§  **ç”¨æˆ·æŸ¥è¯¢åˆ°æŸ¥è¯¢æ„å›¾åˆ†æ - å…·ä½“å®ç°ï¼ˆä¿®æ­£ç‰ˆï¼‰**

### **æ•´ä½“æµç¨‹**

```
ç”¨æˆ·æŸ¥è¯¢ â†’ æŸ¥è¯¢ç±»å‹æ£€æŸ¥ â†’ æ„å›¾åˆ†æ â†’ å¼•æ“é€‰æ‹© â†’ æ‰§è¡ŒæŸ¥è¯¢
```

### ğŸ¯ **æ­¥éª¤1ï¼šæŸ¥è¯¢ç±»å‹æ£€æŸ¥**

åœ¨ `process_query` æ–¹æ³•ä¸­ï¼Œç³»ç»Ÿé¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰æ˜ç¡®çš„æŸ¥è¯¢ç±»å‹ï¼š

```python
# 1. æ£€æŸ¥æ˜¯å¦æœ‰æ˜ç¡®çš„æŸ¥è¯¢ç±»å‹
query_type = kwargs.get('query_type')
if query_type:
    self.logger.info(f"æ£€æµ‹åˆ°æ˜ç¡®çš„æŸ¥è¯¢ç±»å‹: {query_type}")
    # æ ¹æ®æŸ¥è¯¢ç±»å‹é€‰æ‹©å¼•æ“
    engines_to_use = self._select_engines_by_query_type(query_type)
    # å½“æœ‰æ˜ç¡®æŸ¥è¯¢ç±»å‹æ—¶ï¼Œè®¾ç½®é»˜è®¤çš„æŸ¥è¯¢æ„å›¾
    query_intent = f"åŸºäºæŸ¥è¯¢ç±»å‹ {query_type} çš„æ£€ç´¢"
```

**æ”¯æŒçš„ç±»å‹**ï¼š
- `QueryType.TEXT` - æ–‡æœ¬æŸ¥è¯¢ âœ… **å·²å®ç°**
- `QueryType.IMAGE` - å›¾åƒæŸ¥è¯¢ âœ… **å·²å®ç°**  
- `QueryType.TABLE` - è¡¨æ ¼æŸ¥è¯¢ âœ… **å·²å®ç°**
- `QueryType.HYBRID` - æ··åˆæŸ¥è¯¢ âœ… **å·²ä¿®å¤å¹¶æ­£å¸¸å·¥ä½œ**
- `QueryType.SMART` - æ™ºèƒ½æŸ¥è¯¢ âœ… **å·²å®Œå…¨å®ç°å¹¶æµ‹è¯•é€šè¿‡**

### ğŸ§  **æ­¥éª¤2ï¼šæŸ¥è¯¢æ„å›¾åˆ†æ**

å¦‚æœæ²¡æœ‰æ˜ç¡®çš„æŸ¥è¯¢ç±»å‹ï¼Œç³»ç»Ÿä¼šä½¿ç”¨ `QueryIntentAnalyzer` è¿›è¡Œæ™ºèƒ½åˆ†æï¼š

```python
else:
    # 2. åˆ†ææŸ¥è¯¢æ„å›¾
    query_intent = self.intent_analyzer.analyze_intent(query)
    self.logger.info(f"æŸ¥è¯¢æ„å›¾åˆ†æç»“æœ: {query_intent}")
    
    # 3. é€‰æ‹©è¦ä½¿ç”¨çš„å¼•æ“
    engines_to_use = self._select_engines_by_intent(query_intent)
```

### ğŸ” **æ­¥éª¤3ï¼šæ„å›¾åˆ†æå™¨æ ¸å¿ƒé€»è¾‘**

`QueryIntentAnalyzer` ç±»å®ç°äº†å¤šç»´åº¦æ„å›¾åˆ†æï¼š

#### **3.1 æ„å›¾å…³é”®è¯æ˜ å°„**
```python
self.intent_keywords = {
    'image': ['å›¾ç‰‡', 'å›¾åƒ', 'ç…§ç‰‡', 'å›¾è¡¨', 'å¯è§†åŒ–', 'å›¾', 'ç”»', 'icon', 'image', 'picture', 'chart', 'figure'],
    'text': ['æ–‡æœ¬', 'æ–‡æ¡£', 'å†…å®¹', 'æè¿°', 'è¯´æ˜', 'æ–‡å­—', 'æ–‡ç« ', 'text', 'document', 'content'],
    'table': ['è¡¨æ ¼', 'æ•°æ®', 'ç»Ÿè®¡', 'æ•°å­—', 'åˆ—è¡¨', 'è¡¨', 'æ•°æ®è¡¨', 'table', 'data', 'statistics'],
    'hybrid': ['æ··åˆ', 'ç»¼åˆ', 'å…¨éƒ¨', 'æ‰€æœ‰', 'hybrid', 'mixed', 'all', 'comprehensive'],
    'smart': ['æ™ºèƒ½', 'è‡ªåŠ¨', 'åˆ†æ', 'ç»¼åˆ', 'smart', 'auto', 'analyze', 'comprehensive']  # æ–°å¢æ™ºèƒ½æŸ¥è¯¢å…³é”®è¯
}
```

#### **3.2 ä¸šåŠ¡é¢†åŸŸæ£€æµ‹**
```python
self.domain_keywords = {
    'technical': ['æŠ€æœ¯', 'æŠ€æœ¯æ–‡æ¡£', 'API', 'ä»£ç ', 'ç¼–ç¨‹', 'å¼€å‘', 'technical', 'api', 'code', 'development'],
    'business': ['ä¸šåŠ¡', 'å•†ä¸š', 'å¸‚åœº', 'è´¢åŠ¡', 'ç®¡ç†', 'business', 'market', 'finance', 'management'],
    'academic': ['å­¦æœ¯', 'ç ”ç©¶', 'è®ºæ–‡', 'å­¦æœ¯è®ºæ–‡', 'academic', 'research', 'paper', 'thesis']
}
```

#### **3.3 å¤æ‚åº¦æ£€æµ‹**
```python
self.complexity_keywords = {
    'simple': ['ç®€å•', 'åŸºç¡€', 'åŸºæœ¬', 'ç®€å•æŸ¥è¯¢', 'simple', 'basic', 'elementary'],
    'complex': ['å¤æ‚', 'é«˜çº§', 'æ·±åº¦', 'å¤æ‚æŸ¥è¯¢', 'complex', 'advanced', 'deep'],
    'enhanced': ['å¢å¼º', 'ä¼˜åŒ–', 'æ”¹è¿›', 'enhanced', 'optimized', 'improved']
}
```

### ğŸ¯ **æ­¥éª¤4ï¼šæ„å›¾å†³ç­–ç®—æ³•**

æ„å›¾åˆ†æå™¨ä½¿ç”¨å¤šæ­¥éª¤å†³ç­–ç®—æ³•ï¼š

```python
def _make_intent_decision(self, intent_scores, has_hybrid_intent, detected_domain, complexity, enhanced_content_type, query_lower):
    # 1. å¦‚æœæœ‰æ˜ç¡®çš„æ··åˆæ„å›¾ï¼Œç›´æ¥è¿”å›
    if has_hybrid_intent:
        return "hybrid"
    
    # 2. å¦‚æœæœ‰æ˜ç¡®çš„æ™ºèƒ½æŸ¥è¯¢æ„å›¾ï¼Œè¿”å›æ™ºèƒ½æŸ¥è¯¢
    if 'smart' in query_lower or 'æ™ºèƒ½' in query_lower or 'è‡ªåŠ¨' in query_lower:
        return "smart"
    
    # 3. æ‰¾å‡ºæœ€é«˜åˆ†æ•°çš„æ„å›¾
    max_score = 0.0
    best_intent = "hybrid"
    
    for intent, score in intent_scores.items():
        if score > max_score:
            max_score = score
            best_intent = intent
    
    # 4. å¦‚æœæœ€é«˜åˆ†æ•°å¤ªä½ï¼Œä½¿ç”¨æ··åˆæ„å›¾
    if max_score < 0.3:
        return "hybrid"
    
    # 5. æ ¹æ®ä¸šåŠ¡é¢†åŸŸè°ƒæ•´æ„å›¾
    if detected_domain == "technical" and best_intent == "text":
        return "technical_text"
    elif detected_domain == "business" and best_intent == "table":
        return "business_table"
    elif detected_domain == "academic" and best_intent == "text":
        return "academic_text"
    
    # 6. æ ¹æ®å¤æ‚åº¦è°ƒæ•´æ„å›¾
    if complexity == "complex" and best_intent in ["text", "table"]:
        return f"complex_{best_intent}"
    elif complexity == "enhanced" and best_intent == "image":
        return "enhanced_image"
    
    return best_intent
```

### ğŸ”§ **æ­¥éª¤5ï¼šå¼•æ“é€‰æ‹©ç­–ç•¥**

æ ¹æ®åˆ†æå‡ºçš„æ„å›¾ï¼Œç³»ç»Ÿé€‰æ‹©ç›¸åº”çš„å¼•æ“ï¼š

```python
def _select_engines_by_intent(self, query_intent: str) -> Dict[str, Any]:
    engines_to_use = {}
    
    # æ ¹æ®æ„å›¾é€‰æ‹©å¼•æ“
    if 'image' in query_intent.lower() or 'å›¾ç‰‡' in query_intent:
        if self.image_engine and getattr(self.hybrid_config, 'enable_image_search', True):
            engines_to_use['image'] = self.image_engine
    
    if 'text' in query_intent.lower() or 'æ–‡æœ¬' in query_intent or 'æ–‡æ¡£' in query_intent:
        if self.text_engine and getattr(self.hybrid_config, 'enable_text_search', True):
            engines_to_use['text'] = self.text_engine
    
    if 'table' in query_intent.lower() or 'è¡¨æ ¼' in query_intent or 'æ•°æ®' in query_intent:
        if self.table_engine and getattr(self.hybrid_config, 'enable_table_search', True):
            engines_to_use['table'] = self.table_engine
    
    # æ–°å¢ï¼šæ™ºèƒ½æŸ¥è¯¢æ„å›¾å¤„ç†
    if 'smart' in query_intent.lower() or 'æ™ºèƒ½' in query_intent:
        # æ™ºèƒ½æŸ¥è¯¢ä½¿ç”¨æ‰€æœ‰å¯ç”¨å¼•æ“ï¼Œè®©ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä½³ç»„åˆ
        if getattr(self.hybrid_config, 'enable_hybrid_search', True):
            if self.image_engine and getattr(self.hybrid_config, 'enable_image_search', True):
                engines_to_use['image'] = self.image_engine
            if self.text_engine and getattr(self.hybrid_config, 'enable_text_search', True):
                engines_to_use['text'] = self.text_engine
            if self.table_engine and getattr(self.hybrid_config, 'enable_table_search', True):
                engines_to_use['table'] = self.table_engine
    
    # å¦‚æœæ²¡æœ‰ç‰¹å®šæ„å›¾ï¼Œä½¿ç”¨æ··åˆæŸ¥è¯¢
    if not engines_to_use:
        if getattr(self.hybrid_config, 'enable_hybrid_search', True):
            if self.image_engine and getattr(self.hybrid_config, 'enable_image_search', True):
                engines_to_use['image'] = self.image_engine
            if self.text_engine and getattr(self.hybrid_config, 'enable_text_search', True):
                engines_to_use['text'] = self.text_engine
            if self.table_engine and getattr(self.hybrid_config, 'enable_table_search', True):
                engines_to_use['table'] = self.table_engine
    
    return engines_to_use
```

### ğŸ“Š **å®é™…åº”ç”¨ç¤ºä¾‹**

**ç¤ºä¾‹1ï¼šæ˜ç¡®æŸ¥è¯¢ç±»å‹**
```python
# ç”¨æˆ·ä¼ å…¥ query_type=QueryType.HYBRID
# ç³»ç»Ÿç›´æ¥é€‰æ‹©æ··åˆæŸ¥è¯¢æ¨¡å¼ï¼Œè·³è¿‡æ„å›¾åˆ†æ
engines_to_use = {'image': image_engine, 'text': text_engine, 'table': table_engine}
query_intent = "åŸºäºæŸ¥è¯¢ç±»å‹ HYBRID çš„æ··åˆæ£€ç´¢"
```

**ç¤ºä¾‹2ï¼šæ™ºèƒ½æ„å›¾åˆ†æ**
```python
# ç”¨æˆ·æŸ¥è¯¢ï¼š"è¯·æ™ºèƒ½åˆ†æä¸­èŠ¯å›½é™…çš„æŠ€æœ¯å‘å±•æƒ…å†µ"
# æ„å›¾åˆ†æç»“æœï¼š
# - æ£€æµ‹åˆ° 'æ™ºèƒ½' â†’ smart intent
# - æ£€æµ‹åˆ° 'æŠ€æœ¯å‘å±•' â†’ technical domain
# - æœ€ç»ˆæ„å›¾ï¼šsmart_technical
# - é€‰æ‹©å¼•æ“ï¼šæ‰€æœ‰å¯ç”¨å¼•æ“ï¼ˆæ™ºèƒ½ç»„åˆï¼‰
```

**ç¤ºä¾‹3ï¼šæ··åˆæŸ¥è¯¢**
```python
# ç”¨æˆ·æŸ¥è¯¢ï¼š"ç»¼åˆæŸ¥è¯¢æ‰€æœ‰ç›¸å…³å†…å®¹"
# æ„å›¾åˆ†æç»“æœï¼š
# - æ£€æµ‹åˆ° 'ç»¼åˆ' â†’ hybrid intent
# - æœ€ç»ˆæ„å›¾ï¼šhybrid
# - é€‰æ‹©å¼•æ“ï¼šæ‰€æœ‰å¯ç”¨å¼•æ“
```

### ğŸ¯ **å½“å‰å®ç°çŠ¶æ€**

#### **å·²å®ç°å¹¶æ­£å¸¸å·¥ä½œçš„åŠŸèƒ½**
- âœ… **å›¾ç‰‡æŸ¥è¯¢**ï¼šèƒ½å¤Ÿæ­£ç¡®é€‰æ‹© `image_engine`
- âœ… **æ–‡æœ¬æŸ¥è¯¢**ï¼šèƒ½å¤Ÿæ­£ç¡®é€‰æ‹© `text_engine`
- âœ… **è¡¨æ ¼æŸ¥è¯¢**ï¼šèƒ½å¤Ÿæ­£ç¡®é€‰æ‹© `table_engine`
- âœ… **æ··åˆæŸ¥è¯¢**ï¼šèƒ½å¤Ÿæ­£ç¡®é€‰æ‹©æ‰€æœ‰å¯ç”¨å¼•æ“ï¼Œå·²ä¿®å¤å¹¶æµ‹è¯•éªŒè¯é€šè¿‡
- âœ… **æ™ºèƒ½æŸ¥è¯¢**ï¼šå·²å®Œå…¨å®ç°ï¼Œä½¿ç”¨QueryIntentAnalyzerè¿›è¡Œæ„å›¾åˆ†æï¼Œèƒ½å¤Ÿæ™ºèƒ½é€‰æ‹©æœ€ä½³æŸ¥è¯¢ç±»å‹

#### **å·²é›†æˆçš„åŠŸèƒ½**
- âœ… **æ„å›¾è¯†åˆ«å™¨é›†æˆ**ï¼š`QueryIntentAnalyzer` å·²å®Œå…¨é›†æˆåˆ°æ™ºèƒ½æŸ¥è¯¢æµç¨‹ä¸­ï¼Œæ”¯æŒå¤šç»´åº¦æ„å›¾åˆ†æ

### ğŸš€ **è®¾è®¡ä¼˜åŠ¿**

1. **æ™ºèƒ½åŒ–**ï¼šç³»ç»Ÿèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·æŸ¥è¯¢å†…å®¹è‡ªåŠ¨åˆ¤æ–­æœ€ä½³æŸ¥è¯¢æ–¹å¼
2. **çµæ´»æ€§**ï¼šæ”¯æŒæ˜ç¡®çš„æŸ¥è¯¢ç±»å‹æŒ‡å®šå’Œæ™ºèƒ½æ„å›¾åˆ†æä¸¤ç§æ–¹å¼
3. **ä¸€è‡´æ€§**ï¼šæ‰€æœ‰æŸ¥è¯¢ç±»å‹éƒ½é€šè¿‡ç»Ÿä¸€çš„å¼•æ“é€‰æ‹©é€»è¾‘å¤„ç†
4. **æ‰©å±•æ€§**ï¼šæ–°å¢æ™ºèƒ½æŸ¥è¯¢ç±»å‹ï¼Œä¿æŒç³»ç»Ÿæ¶æ„çš„ä¸€è‡´æ€§
5. **ç”¨æˆ·ä½“éªŒ**ï¼šç”¨æˆ·å¯ä»¥é€‰æ‹©æ‰‹åŠ¨æŒ‡å®šç±»å‹ï¼Œä¹Ÿå¯ä»¥è®©ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­
6. **æŠ€æœ¯æˆç†Ÿåº¦**ï¼šæ··åˆæŸ¥è¯¢åŠŸèƒ½å·²å®Œå…¨ä¿®å¤å¹¶éªŒè¯ï¼Œä¸ºæ™ºèƒ½æŸ¥è¯¢å®ç°å¥ å®šåŸºç¡€

è¿™æ ·çš„å®ç°æ—¢æ”¯æŒæ˜ç¡®çš„æŸ¥è¯¢ç±»å‹æŒ‡å®šï¼Œåˆå…·å¤‡æ™ºèƒ½çš„æ„å›¾è¯†åˆ«èƒ½åŠ›ï¼Œèƒ½å¤Ÿæ ¹æ®ç”¨æˆ·æŸ¥è¯¢å†…å®¹è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å¼•æ“ç»„åˆï¼ŒåŒæ—¶æ–°å¢çš„æ™ºèƒ½æŸ¥è¯¢ç±»å‹å®Œå…¨é›†æˆåˆ°ç°æœ‰æ¶æ„ä¸­ã€‚






