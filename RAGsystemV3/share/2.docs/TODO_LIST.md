# V3版本系统TODO列表

## 🐛 需要修复的问题

### 1. 数据库诊断工具文档名统计问题
- **问题描述**：数据库诊断工具中，`'unknown'` 被错误计算为独立文档名，导致"唯一文档名"数量不准确
- **具体表现**：当前显示"唯一文档名：2个"，但实际只有1个真实文档（中原证券报告）
- **原因分析**：系统块（system chunk）或某些特殊块的 `document_name` 字段值为 `'unknown'` 或缺失
- **影响**：不影响实际功能，但统计显示不准确
- **修复方案**：在统计时过滤掉 `'unknown'` 或空值的文档名
- **优先级**：低（显示问题，不影响核心功能）

### 2. 增量模式向量保存问题
- **问题描述**：增量模式能正确识别和处理新增文档，但向量没有保存到数据库中
- **具体表现**：光大证券报告处理完成（39个文本+19个表格+1个图片），但数据库仍只有51个向量（中原证券报告）
- **原因分析**：`_update_results` 方法期望的数据结构与增量处理返回的数据结构不匹配
- **影响**：增量模式无法真正保存新文档的向量，失去增量功能的意义
- **修复方案**：修复数据结构不匹配问题，确保增量处理的向量能正确保存到数据库
- **优先级**：高（影响增量模式的核心功能）

## ✅ 已完成的任务

### 1. 数据库检测逻辑修复
- **问题**：V3版本的数据库检测逻辑期望 `metadata.pkl` 文件，但实际使用 `index.pkl`
- **修复**：使用 `VectorStoreManager.load()` 方法进行检测，并添加传统文件检测作为回退方案
- **状态**：已完成

### 2. 增量模式数据库加载问题修复
- **问题**：`VectorStoreManager.load()` 方法传入父目录路径，但 `FAISS.load_local()` 期望包含 `langchain_faiss_index` 子目录的路径
- **修复**：在 `load()` 方法中自动检测并添加 `langchain_faiss_index` 子目录，确保路径正确
- **状态**：已完成

### 2. 数据库诊断功能增强
- **功能**：添加向量数据分析、相似度分析、质量报告等高级功能
- **状态**：已完成

## 🔄 进行中的任务

### 1. 增量文档功能测试
- **目标**：测试系统能否正确识别现有数据库并使用增量模式
- **状态**：准备中（数据库已备份，准备测试）

## 📋 待办任务

### 1. 完善增量模式实现
- **描述**：当前增量模式的方法体还是空的，需要实现具体的增量处理逻辑
- **优先级**：中

### 2. 优化文档名统计逻辑
- **描述**：改进数据库诊断工具中的文档名统计，过滤无效值
- **优先级**：低

---
*最后更新：2025-08-30 15:45*
