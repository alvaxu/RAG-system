让我查看一下配置文件，看看有哪些参数可以调整来增加召回数量。


[1 tool called]

现在让我查看一下RAG系统的配置，看看还有哪些相关的参数：


[1 tool called]

基于我对配置文件的分析，以下是你可以调整来增加召回数量的关键参数：

## 增加召回数量的配置参数

### 1. **全局查询处理参数** (`rag_system.query_processing`)
```json
{
  "max_results": 10,           // 全局最大结果数量，可以增加到 20-50
  "relevance_threshold": 0.5,  // 相关性阈值，降低到 0.3-0.4 可获得更多结果
  "max_context_length": 4000   // 上下文长度，可以增加到 6000-8000
}
```

### 2. **各引擎的最大结果数量** (`rag_system.engines`)
```json
{
  "text_engine": {
    "max_results": 10,              // 文本引擎结果数，可增加到 20-30
    "similarity_threshold": 0.7     // 文本相似度阈值，降低到 0.5-0.6
  },
  "image_engine": {
    "max_results": 20,              // 图片引擎结果数，可增加到 30-50
    "similarity_threshold": 0.3     // 图片相似度阈值，降低到 0.2-0.25
  },
  "table_engine": {
    "max_results": 15,              // 表格引擎结果数，可增加到 25-40
    "similarity_threshold": 0.65    // 表格相似度阈值，降低到 0.5-0.55
  },
  "hybrid_engine": {
    "max_results": 25,              // 混合引擎结果数，可增加到 40-60
    "weights": {
      "image": 0.3,
      "text": 0.4,
      "table": 0.3
    }
  }
}
```

### 3. **重排序模型参数** (`rag_system.models.reranking`)
```json
{
  "reranking": {
    "model_name": "gte-rerank-v2",
    "batch_size": 32,               // 批处理大小，可增加到 64-128
    "similarity_threshold": 0.7     // 重排序相似度阈值，降低到 0.5-0.6
  }
}
```

### 4. **性能参数** (`rag_system.performance`)
```json
{
  "performance": {
    "max_concurrent_queries": 10,   // 最大并发查询数，可增加到 15-20
    "query_timeout": 60,            // 查询超时时间，可增加到 90-120
    "enable_monitoring": true
  }
}
```

## 推荐的调整策略

### **保守调整**（适度增加召回）
```json
{
  "rag_system": {
    "query_processing": {
      "max_results": 15,           // 10 → 15
      "relevance_threshold": 0.4   // 0.5 → 0.4
    },
    "engines": {
      "text_engine": {
        "max_results": 15,         // 10 → 15
        "similarity_threshold": 0.6 // 0.7 → 0.6
      },
      "image_engine": {
        "max_results": 30,         // 20 → 30
        "similarity_threshold": 0.25 // 0.3 → 0.25
      },
      "table_engine": {
        "max_results": 20,         // 15 → 20
        "similarity_threshold": 0.55 // 0.65 → 0.55
      },
      "hybrid_engine": {
        "max_results": 35          // 25 → 35
      }
    }
  }
}
```

### **激进调整**（大幅增加召回）
```json
{
  "rag_system": {
    "query_processing": {
      "max_results": 30,           // 10 → 30
      "relevance_threshold": 0.3   // 0.5 → 0.3
    },
    "engines": {
      "text_engine": {
        "max_results": 25,         // 10 → 25
        "similarity_threshold": 0.5 // 0.7 → 0.5
      },
      "image_engine": {
        "max_results": 50,         // 20 → 50
        "similarity_threshold": 0.2 // 0.3 → 0.2
      },
      "table_engine": {
        "max_results": 35,         // 15 → 35
        "similarity_threshold": 0.5 // 0.65 → 0.5
      },
      "hybrid_engine": {
        "max_results": 60          // 25 → 60
      }
    }
  }
}
```

## 注意事项

1. **性能影响**：增加召回数量会提高响应时间和计算资源消耗
2. **质量权衡**：降低相似度阈值可能引入更多不相关的结果
3. **内存使用**：更多结果需要更多内存来存储和处理
4. **建议逐步调整**：先进行保守调整，观察效果后再决定是否进一步增加



## 参数优先级和作用机制

### **实际起作用的参数优先级**

1. **API请求参数** (最高优先级)
   - 前端发送的 `max_results` 和 `relevance_threshold`
   - 这些参数直接传递给处理函数

2. **各引擎配置参数** (中等优先级)
   - `rag_system.engines.text_engine.max_results`
   - `rag_system.engines.text_engine.similarity_threshold`
   - 这些参数在引擎内部使用

3. **全局配置参数** (最低优先级)
   - `rag_system.query_processing.max_results`
   - `rag_system.query_processing.relevance_threshold`
   - 这些参数**目前没有被使用**

### **具体分析**

#### **max_results 参数流向**：
```
API请求 → QueryOptions → unified_services.retrieve() → retrieval_service.retrieve_texts()
```
- **API默认值**: `Field(10, ...)` 
- **实际使用**: API请求中的 `max_results` 直接传递给各引擎
- **各引擎配置**: 在 `retrieve_texts()` 中读取 `text_engine.max_results`，但**被API参数覆盖**

#### **similarity_threshold 参数流向**：
```
API请求 → QueryOptions → unified_services.retrieve() → vector_db_integration.search_texts()
```
- **API默认值**: `Field(0.5, ...)`
- **实际使用**: API请求中的 `relevance_threshold` 传递给 `search_texts()`
- **各引擎配置**: 在 `retrieve_texts()` 中读取 `text_engine.similarity_threshold`，但**被API参数覆盖**

### **结论**

**各引擎的参数起作用，全局参数不起作用**

- ✅ **各引擎配置参数** (`rag_system.engines.*.max_results`, `rag_system.engines.*.similarity_threshold`) 是**实际生效的**
- ❌ **全局配置参数** (`rag_system.query_processing.*`) 在代码中**没有被使用**

### **要增加召回数量，应该调整**：

```json
{
  "rag_system": {
    "engines": {
      "text_engine": {
        "max_results": 20,              // 从10增加到20
        "similarity_threshold": 0.4     // 从0.7降低到0.4
      },
      "image_engine": {
        "max_results": 30,              // 从20增加到30
        "similarity_threshold": 0.25    // 从0.3降低到0.25
      },
      "table_engine": {
        "max_results": 25,              // 从15增加到25
        "similarity_threshold": 0.5     // 从0.65降低到0.5
      },
      "hybrid_engine": {
        "max_results": 40               // 从25增加到40
      }
    }
  }
}
```

**全局参数可以忽略**，因为它们在实际代码中没有被使用。