å¥½çš„ï¼Œè®©æˆ‘æ€»ç»“ä¸€ä¸‹å¯¹äº text å’Œ table éœ€è¦åšçš„ä¿®æ”¹ã€‚

## **ğŸ“‹ Text å’Œ Table ä¿®æ”¹æ€»ç»“**

### **ğŸ¯ ç›®æ ‡**
**ç§»é™¤ TextProcessor å’Œ TableProcessorï¼Œè®© ContentProcessor ç›´æ¥ä½¿ç”¨ ContentMetadataExtractor çš„ç»“æœï¼Œç®€åŒ–æ•´ä¸ªæ•°æ®æµã€‚**

### **ï¿½ï¿½ éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶å’Œå†…å®¹**

#### **1. ä¿®æ”¹ TextVectorizer.vectorize_batch()**
**æ–‡ä»¶ï¼š** `v3/vectorization/text_vectorizer.py`
**ä¿®æ”¹å†…å®¹ï¼š**
```python
def vectorize_batch(self, texts: List[Dict]) -> List[Dict[str, Any]]:
    vectorized_texts = []
    
    for i, text_item in enumerate(texts):
        try:
            # ä¿®æ”¹ï¼šä½¿ç”¨ 'text' è€Œä¸æ˜¯ 'text_content'
            text_content = text_item.get('text', '')  # â† è¿™é‡Œæ”¹ä¸º 'text'
            metadata = text_item.get('metadata', {})
            
            if not text_content:
                logging.warning(f"æ–‡æœ¬ {i+1} ç¼ºå°‘å†…å®¹")
                continue
            
            # ... å…¶ä»–é€»è¾‘ä¿æŒä¸å˜
```

#### **2. ä¿®æ”¹ TableVectorizer.vectorize_batch()**
**æ–‡ä»¶ï¼š** `v3/vectorization/table_vectorizer.py`
**ä¿®æ”¹å†…å®¹ï¼š**
```python
def vectorize_batch(self, tables: List[Dict]) -> List[Dict[str, Any]]:
    vectorized_tables = []
    
    for i, table_item in enumerate(tables):
        try:
            # ä¿®æ”¹ï¼šä½¿ç”¨ 'table_content' è€Œä¸æ˜¯ 'table_body'
            table_content = table_item.get('table_content', '')  # â† è¿™é‡Œæ”¹ä¸º 'table_content'
            metadata = table_item.get('metadata', {})
            
            if not table_content:
                logging.warning(f"è¡¨æ ¼ {i+1} ç¼ºå°‘å†…å®¹")
                continue
            
            # ... å…¶ä»–é€»è¾‘ä¿æŒä¸å˜
```

#### **3. ä¿®æ”¹ TableVectorizer.vectorize() æ–¹æ³•ç­¾å**
**æ–‡ä»¶ï¼š** `v3/vectorization/table_vectorizer.py`
**ä¿®æ”¹å†…å®¹ï¼š**
```python
def vectorize(self, table_content: str, metadata: Dict = None) -> Dict[str, Any]:
    """
    å¯¹å•ä¸ªè¡¨æ ¼è¿›è¡Œå‘é‡åŒ–
    
    :param table_content: è¡¨æ ¼çº¯æ–‡æœ¬å†…å®¹ï¼ˆç”¨äºå‘é‡åŒ–ï¼‰
    :param metadata: è¡¨æ ¼å…ƒæ•°æ®
    :return: å‘é‡åŒ–ç»“æœå­—å…¸
    """
    try:
        if not table_content or not table_content.strip():
            raise ValueError("è¡¨æ ¼å†…å®¹ä¸ºç©º")
        
        logging.info(f"å¼€å§‹å‘é‡åŒ–è¡¨æ ¼: {table_content[:50]}...")
        
        # æ­¥éª¤1: è¡¨æ ¼å†…å®¹é¢„å¤„ç†ï¼ˆå·²ç»æ˜¯çº¯æ–‡æœ¬ï¼Œä¸éœ€è¦å†æå–ï¼‰
        processed_content = self._preprocess_table_content(table_content)
        
        # ... å…¶ä»–é€»è¾‘ä¿æŒä¸å˜
```

#### **4. ä¿®æ”¹ ContentProcessor.process_document_content()**
**æ–‡ä»¶ï¼š** `v3/core/content_processor.py`
**ä¿®æ”¹å†…å®¹ï¼š**
```python
def process_document_content(self, json_path: str, doc_name: str) -> Dict[str, Any]:
    try:
        start_time = time.time()
        logging.info(f"å¼€å§‹å¤„ç†æ–‡æ¡£å†…å®¹: {doc_name}")
        
        # 1. æå–å…ƒæ•°æ®ï¼ˆå·²ç»åŒ…å«å®Œæ•´çš„ text å’Œ table å¤„ç†ç»“æœï¼‰
        metadata_results = self.metadata_extractor.extract_metadata_from_json(json_path, doc_name)
        
        # 2. å¤„ç†æ–‡æœ¬å†…å®¹ï¼ˆç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦å†å¤„ç†ï¼‰
        if metadata_results.get('text_chunks'):
            text_count = len(metadata_results['text_chunks'])
            logging.info(f"æ–‡æœ¬å¤„ç†å®Œæˆ: {text_count} ä¸ªï¼ˆé¢„åˆ†æå·²å®Œæˆï¼‰")
            # ç§»é™¤ï¼šmetadata_results['text_chunks'] = self.text_processor.process_batch(...)
        
        # 3. å¤„ç†è¡¨æ ¼å†…å®¹ï¼ˆç›´æ¥ä½¿ç”¨ï¼Œä¸éœ€è¦å†å¤„ç†ï¼‰
        if metadata_results.get('tables'):
            table_count = len(metadata_results['tables'])
            logging.info(f"è¡¨æ ¼å¤„ç†å®Œæˆ: {table_count} ä¸ªï¼ˆé¢„åˆ†æå·²å®Œæˆï¼‰")
            # ç§»é™¤ï¼šmetadata_results['tables'] = self.table_processor.process_batch(...)
        
        # 4. å¤„ç†å›¾ç‰‡å†…å®¹ï¼ˆéœ€è¦ AI å¢å¼ºå’Œå‘é‡åŒ–ï¼‰
        if metadata_results.get('images'):
            image_count = len(metadata_results['images'])
            logging.info(f"å¤„ç†å›¾ç‰‡: {image_count} å¼ ")
            metadata_results['images'] = self.image_processor.process_images(
                metadata_results['images']
            )
            logging.info(f"å›¾ç‰‡å¤„ç†å®Œæˆ: {image_count} å¼ ")
        
        # ... å…¶ä»–é€»è¾‘ä¿æŒä¸å˜
```

#### **5. ä¿®æ”¹ ContentProcessor çš„åˆå§‹åŒ–**
**æ–‡ä»¶ï¼š** `v3/core/content_processor.py`
**ä¿®æ”¹å†…å®¹ï¼š**
```python
def __init__(self, config_manager):
    self.config_manager = config_manager
    self.config = config_manager.get_all_config()
    
    # è·å–å¤±è´¥å¤„ç†å™¨
    self.failure_handler = config_manager.get_failure_handler()
    
    # ç§»é™¤ï¼šself._initialize_processors() ä¸­çš„ text_processor å’Œ table_processor
    
    # åªä¿ç•™ image_processorï¼ˆå› ä¸ºå›¾ç‰‡ç¡®å®éœ€è¦ AI å¢å¼ºå’Œå‘é‡åŒ–ï¼‰
    from processors.image_processor import ImageProcessor
    self.image_processor = ImageProcessor(config_manager)
    
    # åˆå§‹åŒ–å…ƒæ•°æ®æå–å™¨
    self.metadata_extractor = ContentMetadataExtractor(config_manager)
    
    # ... å…¶ä»–é€»è¾‘ä¿æŒä¸å˜
```

### **ï¿½ï¿½ï¸ å¯ä»¥åˆ é™¤çš„æ–‡ä»¶**

1. **`v3/processors/text_processor.py`** - å®Œå…¨åˆ é™¤
2. **`v3/processors/table_processor.py`** - å®Œå…¨åˆ é™¤

### **ï¿½ï¿½ ä¿®æ”¹åçš„æ•°æ®æµ**

```
ä¿®æ”¹å‰ï¼š
ContentMetadataExtractor.extract_metadata_from_json()
    â†“
ContentProcessor.process_document_content()
    â”œâ”€â”€ TextProcessor.process_batch()     # å…ƒæ•°æ®é‡åŒ…è£…
    â”œâ”€â”€ TableProcessor.process_batch()    # å…ƒæ•°æ®é‡åŒ…è£…
    â””â”€â”€ ImageProcessor.process_images()   # å®è´¨å·¥ä½œ
    â†“
VectorizationManager.vectorize_all_content()
    â”œâ”€â”€ TextVectorizer.vectorize_batch()     # éœ€è¦å­—æ®µè½¬æ¢
    â””â”€â”€ TableVectorizer.vectorize_batch()    # éœ€è¦å­—æ®µè½¬æ¢

ä¿®æ”¹åï¼š
ContentMetadataExtractor.extract_metadata_from_json()
    â†“ (ç›´æ¥ç”Ÿæˆæ ‡å‡†æ ¼å¼)
ContentProcessor.process_document_content()
    â”œâ”€â”€ ç›´æ¥ä½¿ç”¨ text_chunksï¼ˆæ— éœ€å¤„ç†ï¼‰
    â”œâ”€â”€ ç›´æ¥ä½¿ç”¨ tablesï¼ˆæ— éœ€å¤„ç†ï¼‰
    â””â”€â”€ ImageProcessor.process_images()   # å®è´¨å·¥ä½œ
    â†“
VectorizationManager.vectorize_all_content()
    â”œâ”€â”€ TextVectorizer.vectorize_batch()     # ç›´æ¥ä½¿ç”¨ 'text' å­—æ®µ
    â””â”€â”€ TableVectorizer.vectorize_batch()    # ç›´æ¥ä½¿ç”¨ 'table_content' å­—æ®µ
```

### **âœ… ä¿®æ”¹åçš„ä¼˜åŠ¿**

1. **ç®€åŒ–æ¶æ„**ï¼šç§»é™¤ä¸å¿…è¦çš„ Processor å±‚
2. **æé«˜æ€§èƒ½**ï¼šé¿å…é‡å¤çš„å…ƒæ•°æ®ç”Ÿæˆå’Œè½¬æ¢
3. **å‡å°‘ç»´æŠ¤æˆæœ¬**ï¼šå‡å°‘ä»£ç é‡å¤å’Œå¤æ‚æ€§
4. **æ•°æ®ä¸€è‡´æ€§**ï¼šç¡®ä¿å­—æ®µååœ¨æ•´ä¸ªæµç¨‹ä¸­ä¿æŒä¸€è‡´

**è¿™æ ·ä¿®æ”¹åï¼Œtext å’Œ table çš„å¤„ç†å°±å®Œå…¨ç®€åŒ–äº†ï¼Œæ•´ä¸ªç³»ç»Ÿæ›´åŠ é«˜æ•ˆå’Œæ˜“äºç»´æŠ¤ã€‚**