å¥½çš„ï¼æˆ‘æ¥å†™V3 RAGç³»ç»Ÿå‰ç«¯å±•ç¤ºæ¨¡å¼é€‰æ‹©æ¨¡å—çš„è¯¦ç»†è®¾è®¡æ–‡æ¡£ï¼š

# M20-RAGç³»ç»Ÿå‰ç«¯å±•ç¤ºæ¨¡å¼é€‰æ‹©æ¨¡å—è¯¦ç»†è®¾è®¡æ–‡æ¡£

## ä¸€ã€æ–‡æ¡£åŸºç¡€ä¿¡æ¯

| æ¨¡å—åç§° | M20-RAGç³»ç»Ÿå‰ç«¯å±•ç¤ºæ¨¡å¼é€‰æ‹©æ¨¡å—                              | æ‰€å±é¡¹ç›® | V3ç‰ˆæœ¬RAGç³»ç»Ÿ                     |
| -------- | ------------------------------------------------------------ | -------- | --------------------------------- |
| æ–‡æ¡£ç‰ˆæœ¬ | V3.0                                                         | æ–‡æ¡£çŠ¶æ€ | â˜‘ è‰ç¨¿ â–¡ è¯„å®¡ä¸­ â–¡ å·²ç¡®è®¤ â–¡ å·²å½’æ¡£ |
| ç¼–å†™äºº   | AIåŠ©æ‰‹                                                       | ç¼–å†™æ—¥æœŸ | 2025å¹´1æœˆ                         |
| å…³è”æ–‡æ¡£ | ã€Š1.å‘é‡æ•°æ®åº“æœºåˆ¶è¯¦è§£.mdã€‹ã€Š2.RAGç³»ç»ŸPromptæ„å»ºæœºåˆ¶è¯¦è§£.mdã€‹ã€Š3.æ··åˆæŸ¥è¯¢æµç¨‹åˆ†æ.mdã€‹ã€Š4.æ™ºèƒ½æŸ¥è¯¢æµç¨‹åˆ†æ.mdã€‹ã€Š5.RAGç³»ç»Ÿé‡æ’åºæœºåˆ¶è¯¦è§£.mdã€‹ã€Š45.RAGç³»ç»Ÿå‰åç«¯äº¤äº’è¯¦ç»†è®¾è®¡æ–‡æ¡£.mdã€‹ |          |                                   |

## äºŒã€æ¨¡å—æ¦‚è¿°

### 1. å®šä½ä¸ç›®æ ‡

ä½œä¸ºV3 RAGç³»ç»Ÿå‰ç«¯çš„**æ™ºèƒ½å±•ç¤ºæ¨¡å¼é€‰æ‹©æ ¸å¿ƒæ¨¡å—**ï¼Œå±•ç¤ºæ¨¡å¼é€‰æ‹©æ¨¡å—æ‰¿æ‹…æ ¹æ®æŸ¥è¯¢ç±»å‹ã€å†…å®¹ç‰¹å¾å’ŒLLMå›ç­”æ™ºèƒ½é€‰æ‹©æœ€ä½³å±•ç¤ºæ–¹å¼çš„é‡è¦èŒè´£ã€‚åŸºäºå®é™…Vue 3.x + Composition APIå®ç°ï¼Œæœ¬æ¨¡å—é‡‡ç”¨"æ™ºèƒ½åˆ†æ+åŠ¨æ€é€‰æ‹©"ç­–ç•¥ï¼Œç¡®ä¿å±•ç¤ºæ¨¡å¼ä¸å†…å®¹ç‰¹å¾çš„æœ€ä½³åŒ¹é…ï¼Œä¸ºç”¨æˆ·æä¾›æœ€ä¼˜çš„æŸ¥è¯¢ç»“æœå±•ç¤ºä½“éªŒã€‚

**æŠ€æœ¯å®ç°**ï¼šåŸºäºVue 3.x + Composition API + Element Plusï¼Œé€šè¿‡DisplayModeSelectorå’ŒSmartQAResultç»„ä»¶å®ç°æ™ºèƒ½å±•ç¤ºæ¨¡å¼é€‰æ‹©ï¼Œä¸FastAPIåç«¯æ·±åº¦é›†æˆã€‚

### 2. è®¾è®¡åŸåˆ™

- **æ™ºèƒ½åˆ†æä¼˜å…ˆ**ï¼šåŸºäºcontentAnalysiså’Œconfidenceè¿›è¡Œæ™ºèƒ½å±•ç¤ºæ¨¡å¼é€‰æ‹©
- **å†…å®¹ç‰¹å¾åŒ¹é…**ï¼šå±•ç¤ºæ¨¡å¼ä¸å†…å®¹ç±»å‹å’Œç‰¹å¾é«˜åº¦åŒ¹é…
- **åŠ¨æ€é€‰æ‹©ç­–ç•¥**ï¼šæ ¹æ®æŸ¥è¯¢ç»“æœåŠ¨æ€é€‰æ‹©æœ€ä½³å±•ç¤ºæ¨¡å¼
- **å±•ç¤ºæ•ˆæœä¼˜åŒ–**ï¼šç¡®ä¿æ¯ç§å†…å®¹ç±»å‹éƒ½èƒ½å¾—åˆ°æœ€ä½³çš„å±•ç¤ºæ•ˆæœ
- **Vue 3.xç°ä»£åŒ–**ï¼šä½¿ç”¨Composition APIå’Œç°ä»£Vue 3ç‰¹æ€§
- **ç»„ä»¶åŒ–è®¾è®¡**ï¼šDisplayModeSelectorå’ŒSmartQAResultç»„ä»¶åˆ†ç¦»å…³æ³¨ç‚¹

### 3. ä¾èµ–ä¸äº¤äº’

| å…³è”æ¨¡å—         | äº¤äº’æ–¹å‘ | æ ¸å¿ƒäº¤äº’å†…å®¹                 |
| ---------------- | -------- | ---------------------------- |
| æŸ¥è¯¢ç±»å‹é€‰æ‹©æ¨¡å— | è¢«è°ƒç”¨   | è·å–ç”¨æˆ·é€‰æ‹©çš„æŸ¥è¯¢ç±»å‹       |
| å†…å®¹åˆ†ææ¨¡å—     | ä¾èµ–     | åˆ†ææŸ¥è¯¢å†…å®¹å’ŒLLMå›ç­”ç‰¹å¾    |
| ç»“æœå±•ç¤ºæ¨¡å—     | è¢«è°ƒç”¨   | æä¾›å±•ç¤ºæ¨¡å¼é€‰æ‹©ç»“æœ         |
| æº¯æºä¿¡æ¯æ¨¡å—     | ä¾èµ–     | è·å–æº¯æºä¿¡æ¯ç”¨äºå±•ç¤ºæ¨¡å¼åˆ¤æ–­ |

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 1. åŠŸèƒ½æ¸…å•

| åŠŸèƒ½ID | åŠŸèƒ½åç§°     | æ ¸å¿ƒæè¿°                                 | æ“ä½œè§’è‰²       | å‰ç½®æ¡ä»¶              |
| ------ | ------------ | ---------------------------------------- | -------------- | --------------------- |
| F001   | æŸ¥è¯¢ç±»å‹è¯†åˆ« | è¯†åˆ«ç”¨æˆ·é€‰æ‹©çš„æŸ¥è¯¢ç±»å‹ï¼ˆtext/image/table/smart/hybridï¼‰ | DisplayModeSelector | ç”¨æˆ·å®ŒæˆæŸ¥è¯¢ç±»å‹é€‰æ‹©  |
| F002   | æ™ºèƒ½åˆ†ææ˜¾ç¤º | æ˜¾ç¤ºåç«¯è¿”å›çš„contentAnalysiså’Œconfidenceä¿¡æ¯ | DisplayModeSelector | åç«¯è¿”å›åˆ†æç»“æœ |
| F003   | æ™ºèƒ½æ¨¡å¼é€‰æ‹© | æ ¹æ®contentAnalysisæ™ºèƒ½é€‰æ‹©æœ€ä½³å±•ç¤ºæ¨¡å¼ | DisplayModeSelector | å†…å®¹åˆ†æç»“æœå¯ç”¨      |
| F004   | å±•ç¤ºæ¨¡å¼åº”ç”¨ | å°†é€‰æ‹©çš„å±•ç¤ºæ¨¡å¼åº”ç”¨åˆ°SmartQAResultç»„ä»¶ | SmartQAResult | å±•ç¤ºæ¨¡å¼é€‰æ‹©å®Œæˆ      |
| F005   | åŠ¨æ€å†…å®¹å±•ç¤º | æ ¹æ®å±•ç¤ºæ¨¡å¼åŠ¨æ€å±•ç¤ºæ–‡æœ¬/å›¾ç‰‡/è¡¨æ ¼å†…å®¹ | SmartQAResult | æŸ¥è¯¢ç»“æœå¯ç”¨          |
| F006   | æ‰‹åŠ¨æ¨¡å¼åˆ‡æ¢ | å…è®¸ç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢å±•ç¤ºæ¨¡å¼ | DisplayModeSelector | å±•ç¤ºæ¨¡å¼é€‰æ‹©å®Œæˆ |
| F007   | å†…å®¹ç±»å‹æ£€æµ‹ | æ£€æµ‹æŸ¥è¯¢ç»“æœä¸­çš„å†…å®¹ç±»å‹åˆ†å¸ƒ | SmartQAResult | æŸ¥è¯¢ç»“æœå¯ç”¨ |

### 2. æ ¸å¿ƒä¸šåŠ¡æµç¨‹

#### 2.1 æŸ¥è¯¢ç±»å‹é€‰æ‹©æµç¨‹
```
ç”¨æˆ·é€‰æ‹©æŸ¥è¯¢ç±»å‹ â†’ DisplayModeSelectoræ˜¾ç¤ºæŸ¥è¯¢ç±»å‹ä¿¡æ¯ â†’ å‘é€æŸ¥è¯¢åˆ°åç«¯
```

#### 2.2 æ™ºèƒ½åˆ†ææµç¨‹
```
åç«¯è¿”å›contentAnalysis â†’ DisplayModeSelectoræ˜¾ç¤ºæ™ºèƒ½åˆ†æç»“æœ â†’ æ ¹æ®confidenceé€‰æ‹©å±•ç¤ºæ¨¡å¼
```

#### 2.3 å±•ç¤ºæ¨¡å¼åº”ç”¨æµç¨‹
```
å±•ç¤ºæ¨¡å¼é€‰æ‹©å®Œæˆ â†’ SmartQAResultæ¥æ”¶å±•ç¤ºæ¨¡å¼ â†’ æ ¹æ®æ¨¡å¼åŠ¨æ€å±•ç¤ºå†…å®¹
```

#### 2.4 å†…å®¹å±•ç¤ºæµç¨‹
```
æŸ¥è¯¢ç»“æœåˆ°è¾¾ â†’ SmartQAResultæ£€æµ‹å†…å®¹ç±»å‹ â†’ æ ¹æ®å±•ç¤ºæ¨¡å¼æ¸²æŸ“å¯¹åº”å†…å®¹ç»„ä»¶
```

## å››ã€è¯¦ç»†è®¾è®¡

### 1. Vue 3.xç»„ä»¶æ¶æ„è®¾è®¡

#### 1.1 ç»„ä»¶æ¶æ„å›¾
```mermaid
graph TD
    A[Chat.vue] --> B[DisplayModeSelector]
    A --> C[SmartQAResult]
    
    B --> D[æŸ¥è¯¢ç±»å‹è¯†åˆ«]
    B --> E[æ™ºèƒ½åˆ†ææ˜¾ç¤º]
    B --> F[å±•ç¤ºæ¨¡å¼é€‰æ‹©]
    
    C --> G[å±•ç¤ºæ¨¡å¼åº”ç”¨]
    C --> H[åŠ¨æ€å†…å®¹å±•ç¤º]
    C --> I[å†…å®¹ç±»å‹æ£€æµ‹]
    
    J[åç«¯API] --> B
    J --> C
    
    K[Element Plus] --> B
    K --> C
```

#### 1.2 ç»„ä»¶è®¾è®¡ç‰¹ç‚¹
- **ç»„ä»¶åˆ†ç¦»**ï¼šDisplayModeSelectorè´Ÿè´£æ¨¡å¼é€‰æ‹©ï¼ŒSmartQAResultè´Ÿè´£å†…å®¹å±•ç¤º
- **Vue 3.xç°ä»£åŒ–**ï¼šä½¿ç”¨Composition APIå’Œç°ä»£Vue 3ç‰¹æ€§
- **æ™ºèƒ½åˆ†æ**ï¼šåŸºäºåç«¯è¿”å›çš„contentAnalysisè¿›è¡Œæ™ºèƒ½å±•ç¤ºæ¨¡å¼é€‰æ‹©
- **åŠ¨æ€æ¸²æŸ“**ï¼šæ ¹æ®å±•ç¤ºæ¨¡å¼åŠ¨æ€æ¸²æŸ“ä¸åŒçš„å†…å®¹ç»„ä»¶
- **ç”¨æˆ·äº¤äº’**ï¼šæ”¯æŒæ‰‹åŠ¨åˆ‡æ¢å±•ç¤ºæ¨¡å¼ï¼Œæä¾›ç”¨æˆ·æ§åˆ¶çµæ´»æ€§

### 2. æ ¸å¿ƒç»„ä»¶è®¾è®¡

#### 2.1 DisplayModeSelectorç»„ä»¶
**ä½ç½®**ï¼š`frontend/src/components/DisplayModeSelector.vue`

```vue
<template>
  <div class="display-mode-selector">
    <!-- æŸ¥è¯¢ç±»å‹æŒ‡ç¤ºå™¨ -->
    <div class="query-type-indicator">
      <span class="type-icon">{{ currentQueryType.icon }}</span>
      <span class="type-name">{{ currentQueryType.name }}</span>
      <span class="type-desc">{{ currentQueryType.description }}</span>
    </div>
    
    <!-- æ™ºèƒ½åˆ†æç»“æœ -->
    <div v-if="showAnalysis && contentAnalysis" class="intelligence-analysis">
      <h4>ğŸ¤– æ™ºèƒ½åˆ†æç»“æœ</h4>
      <div class="analysis-content">
        <div class="analysis-item">
          <span class="item-label">æ£€æµ‹åˆ°çš„å†…å®¹ç±»å‹ï¼š</span>
          <span class="item-value">{{ contentAnalysis.content_types?.join('ã€') || 'æœªçŸ¥' }}</span>
        </div>
        <div class="analysis-item">
          <span class="item-label">æ¨èå±•ç¤ºæ¨¡å¼ï¼š</span>
          <span class="item-value">{{ getDisplayModeName(displayMode) }}</span>
        </div>
        <div class="analysis-item">
          <span class="item-label">ç½®ä¿¡åº¦ï¼š</span>
          <span class="item-value">{{ (confidence * 100).toFixed(0) }}%</span>
        </div>
      </div>
    </div>
    
    <!-- æ‰‹åŠ¨æ¨¡å¼é€‰æ‹© -->
    <div v-if="allowManualSelection" class="manual-selection">
      <h4>ğŸ›ï¸ æ‰‹åŠ¨é€‰æ‹©å±•ç¤ºæ¨¡å¼</h4>
      <el-radio-group v-model="selectedMode" @change="handleModeChange">
        <el-radio-button 
          v-for="mode in availableModes" 
          :key="mode.id" 
          :label="mode.id"
        >
          {{ mode.icon }} {{ mode.name }}
        </el-radio-button>
      </el-radio-group>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'

const props = defineProps({
  queryType: {
    type: String,
    default: 'text'
  },
  displayMode: {
    type: String,
    default: 'text-focused'
  },
  contentAnalysis: {
    type: Object,
    default: null
  },
  confidence: {
    type: Number,
    default: 0.5
  },
  allowManualSelection: {
    type: Boolean,
    default: false
  }
})

const emit = defineEmits(['display-mode-change'])

// æŸ¥è¯¢ç±»å‹é…ç½®
const queryTypes = {
  'text': {
    name: 'æ–‡æœ¬æŸ¥è¯¢',
    icon: 'ğŸ“',
    description: 'æŸ¥è¯¢æ–‡æœ¬å†…å®¹',
    displayMode: 'text-focused'
  },
  'image': {
    name: 'å›¾ç‰‡æŸ¥è¯¢',
    icon: 'ğŸ–¼ï¸',
    description: 'æŸ¥è¯¢å›¾ç‰‡å†…å®¹',
    displayMode: 'image-focused'
  },
  'table': {
    name: 'è¡¨æ ¼æŸ¥è¯¢',
    icon: 'ğŸ“Š',
    description: 'æŸ¥è¯¢è¡¨æ ¼æ•°æ®',
    displayMode: 'table-focused'
  },
  'smart': {
    name: 'æ™ºèƒ½æŸ¥è¯¢',
    icon: 'ğŸ¤–',
    description: 'æ™ºèƒ½æ£€æµ‹æŸ¥è¯¢ç±»å‹',
    displayMode: 'intelligent-detection'
  },
  'hybrid': {
    name: 'æ··åˆæŸ¥è¯¢',
    icon: 'ğŸ”€',
    description: 'æŸ¥è¯¢å¤šç§å†…å®¹ç±»å‹',
    displayMode: 'mixed-layout'
  }
}

// å±•ç¤ºæ¨¡å¼é…ç½®
const displayModes = {
  'text-focused': {
    name: 'æ–‡æœ¬ä¼˜å…ˆ',
    icon: 'ğŸ“',
    description: 'ä¼˜å…ˆå±•ç¤ºæ–‡æœ¬å†…å®¹'
  },
  'image-focused': {
    name: 'å›¾ç‰‡ä¼˜å…ˆ',
    icon: 'ğŸ–¼ï¸',
    description: 'ä¼˜å…ˆå±•ç¤ºå›¾ç‰‡å†…å®¹'
  },
  'table-focused': {
    name: 'è¡¨æ ¼ä¼˜å…ˆ',
    icon: 'ğŸ“Š',
    description: 'ä¼˜å…ˆå±•ç¤ºè¡¨æ ¼å†…å®¹'
  },
  'mixed-layout': {
    name: 'æ··åˆå¸ƒå±€',
    icon: 'ğŸ”€',
    description: 'æ··åˆå±•ç¤ºæ‰€æœ‰å†…å®¹'
  },
  'intelligent-detection': {
    name: 'æ™ºèƒ½æ£€æµ‹',
    icon: 'ğŸ¤–',
    description: 'æ™ºèƒ½é€‰æ‹©æœ€ä½³å±•ç¤ºæ¨¡å¼'
  }
}

// è®¡ç®—å±æ€§
const currentQueryType = computed(() => queryTypes[props.queryType] || queryTypes['text'])
const showAnalysis = computed(() => ['smart', 'hybrid'].includes(props.queryType))
const availableModes = computed(() => {
  const modes = Object.values(displayModes)
  return modes.map(mode => ({
    id: mode.name.toLowerCase().replace(/\s+/g, '-'),
    ...mode
  }))
})

// æ–¹æ³•
const getDisplayModeName = (mode) => {
  return displayModes[mode]?.name || mode
}

const handleModeChange = (mode) => {
  emit('display-mode-change', mode)
}
</script>
```

#### 2.2 SmartQAResultç»„ä»¶
**ä½ç½®**ï¼š`frontend/src/components/SmartQAResult.vue`

```vue
<template>
  <div class="smart-qa-result">
    <!-- å±•ç¤ºæ¨¡å¼é€‰æ‹©å™¨ -->
    <DisplayModeSelector
      :query-type="queryType"
      :display-mode="displayMode"
      :content-analysis="contentAnalysis"
      :confidence="confidence"
      :allow-manual-selection="false"
      @display-mode-change="handleDisplayModeChange"
    />
    
    <!-- æ ¹æ®å±•ç¤ºæ¨¡å¼åŠ¨æ€æ˜¾ç¤ºå†…å®¹ -->
    <div class="result-content">
      <!-- æ–‡æœ¬ä¼˜å…ˆæ¨¡å¼ -->
      <div v-if="displayMode === 'text-focused'" class="text-focused-display">
        <div class="text-content">
          <!-- LLMç­”æ¡ˆ -->
          <div class="llm-answer">
            <MarkdownRenderer :content="llmAnswer" />
          </div>
          
          <!-- æ¥æºä¿¡æ¯ -->
          <div class="source-section">
            <SourceAttribution :sources="sources" />
          </div>
          
          <!-- ç›¸å…³æ–‡æœ¬å†…å®¹ -->
          <div v-if="textResults.length > 0" class="text-results">
            <h3>ğŸ“ ç›¸å…³æ–‡æœ¬å†…å®¹</h3>
            <div v-for="result in displayedTextResults" :key="result.chunk_id" class="text-result">
              <div class="text-preview">
                <MarkdownRenderer :content="result.content" />
              </div>
              <div class="text-meta">
                <span class="source">{{ result.document_name }}</span>
                <span class="page">ç¬¬{{ result.page_number }}é¡µ</span>
                <span class="score">ç›¸å…³æ€§: {{ (result.similarity_score * 100).toFixed(0) }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- å›¾ç‰‡ä¼˜å…ˆæ¨¡å¼ -->
      <div v-else-if="displayMode === 'image-focused'" class="image-focused-display">
        <div class="image-content">
          <!-- LLMç­”æ¡ˆ -->
          <div class="llm-answer">
            <MarkdownRenderer :content="llmAnswer" />
          </div>
          
          <!-- æ¥æºä¿¡æ¯ -->
          <div class="source-section">
            <SourceAttribution :sources="sources" />
          </div>
          
          <!-- ç›¸å…³å›¾ç‰‡ -->
          <div v-if="imageResults.length > 0" class="image-gallery">
            <ImageGallery :images="imageResults" />
          </div>
        </div>
      </div>
      
      <!-- è¡¨æ ¼ä¼˜å…ˆæ¨¡å¼ -->
      <div v-else-if="displayMode === 'table-focused'" class="table-focused-display">
        <div class="table-content">
          <!-- LLMç­”æ¡ˆ -->
          <div class="llm-answer">
            <MarkdownRenderer :content="llmAnswer" />
          </div>
          
          <!-- æ¥æºä¿¡æ¯ -->
          <div class="source-section">
            <SourceAttribution :sources="sources" />
          </div>
          
          <!-- ç›¸å…³è¡¨æ ¼ -->
          <div v-if="tableResults.length > 0" class="table-results">
            <h3>ğŸ“Š ç›¸å…³è¡¨æ ¼æ•°æ®</h3>
            <div v-for="result in tableResults" :key="result.chunk_id" class="table-result">
              <div class="table-preview">
                <TableRenderer :table="result" />
              </div>
              <div class="table-meta">
                <span class="source">{{ result.document_name }}</span>
                <span class="page">ç¬¬{{ result.page_number }}é¡µ</span>
                <span class="score">ç›¸å…³æ€§: {{ (result.similarity_score * 100).toFixed(0) }}%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- æ··åˆå¸ƒå±€æ¨¡å¼ -->
      <div v-else-if="displayMode === 'mixed-layout'" class="mixed-layout-display">
        <div class="mixed-content">
          <!-- LLMç­”æ¡ˆ -->
          <div class="llm-answer">
            <MarkdownRenderer :content="llmAnswer" />
          </div>
          
          <!-- æ¥æºä¿¡æ¯ -->
          <div class="source-section">
            <SourceAttribution :sources="sources" />
          </div>
          
          <!-- æ··åˆå†…å®¹å±•ç¤º -->
          <div class="mixed-results">
            <!-- æ–‡æœ¬å†…å®¹ -->
            <div v-if="textResults.length > 0" class="text-section">
              <h3>ğŸ“ ç›¸å…³æ–‡æœ¬å†…å®¹</h3>
              <div v-for="result in textResults.slice(0, 3)" :key="result.chunk_id" class="text-result">
                <MarkdownRenderer :content="result.content" />
              </div>
            </div>
            
            <!-- å›¾ç‰‡å†…å®¹ -->
            <div v-if="imageResults.length > 0" class="image-section">
              <h3>ğŸ–¼ï¸ ç›¸å…³å›¾ç‰‡å†…å®¹</h3>
              <ImageGallery :images="imageResults.slice(0, 3)" />
            </div>
            
            <!-- è¡¨æ ¼å†…å®¹ -->
            <div v-if="tableResults.length > 0" class="table-section">
              <h3>ğŸ“Š ç›¸å…³è¡¨æ ¼æ•°æ®</h3>
              <div v-for="result in tableResults.slice(0, 2)" :key="result.chunk_id" class="table-result">
                <TableRenderer :table="result" />
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'
import DisplayModeSelector from './DisplayModeSelector.vue'
import MarkdownRenderer from './MarkdownRenderer.vue'
import SourceAttribution from './SourceAttribution.vue'
import ImageGallery from './ImageGallery.vue'
import TableRenderer from './TableRenderer.vue'

const props = defineProps({
  queryType: {
    type: String,
    default: 'text'
  },
  displayMode: {
    type: String,
    default: 'text-focused'
  },
  llmAnswer: {
    type: String,
    default: ''
  },
  sources: {
    type: Array,
    default: () => []
  },
  contentAnalysis: {
    type: Object,
    default: null
  },
  confidence: {
    type: Number,
    default: 0.5
  }
})

const emit = defineEmits(['display-mode-change'])

// å“åº”å¼æ•°æ®
const textResults = ref([])
const imageResults = ref([])
const tableResults = ref([])
const showAllText = ref(false)
const maxTextDisplayCount = 3

// è®¡ç®—å±æ€§
const displayedTextResults = computed(() => {
  if (showAllText.value) {
    return textResults.value
  }
  return textResults.value.slice(0, maxTextDisplayCount)
})

// æ–¹æ³•
const handleDisplayModeChange = (mode) => {
  emit('display-mode-change', mode)
}

// ç›‘å¬propså˜åŒ–
watch(() => props.sources, (newSources) => {
  // æ ¹æ®sourcesæ›´æ–°å„ç§ç»“æœ
  textResults.value = newSources.filter(source => source.chunk_type === 'text')
  imageResults.value = newSources.filter(source => source.chunk_type === 'image')
  tableResults.value = newSources.filter(source => source.chunk_type === 'table')
}, { immediate: true })
</script>
<template>
  <div class="display-mode-selector">
    <!-- æŸ¥è¯¢ç±»å‹æŒ‡ç¤ºå™¨ -->
    <div class="query-type-indicator">
      <span class="type-icon">{{ currentQueryType.icon }}</span>
      <span class="type-name">{{ currentQueryType.name }}</span>
      <span class="type-desc">{{ currentQueryType.description }}</span>
    </div>
    
    <!-- å±•ç¤ºæ¨¡å¼çŠ¶æ€ -->
    <div class="display-mode-status">
      <span class="mode-label">å½“å‰å±•ç¤ºæ¨¡å¼ï¼š</span>
      <span class="mode-value">{{ currentDisplayMode.name }}</span>
      <span class="mode-desc">{{ currentDisplayMode.description }}</span>
    </div>
    
    <!-- æ™ºèƒ½åˆ†æç»“æœï¼ˆä»…æ™ºèƒ½å’Œæ··åˆæŸ¥è¯¢æ˜¾ç¤ºï¼‰ -->
    <div v-if="showAnalysis" class="intelligence-analysis">
      <h4>ğŸ¤– æ™ºèƒ½åˆ†æç»“æœ</h4>
      <div class="analysis-content">
        <div class="analysis-item">
          <span class="item-label">æ£€æµ‹åˆ°çš„å†…å®¹ç±»å‹ï¼š</span>
          <span class="item-value">{{ analysisResult.contentTypes.join('ã€') }}</span>
        </div>
        <div class="analysis-item">
          <span class="item-label">æ¨èå±•ç¤ºæ¨¡å¼ï¼š</span>
          <span class="item-value">{{ analysisResult.recommendedMode }}</span>
        </div>
        <div class="analysis-item">
          <span class="item-label">ç½®ä¿¡åº¦ï¼š</span>
          <span class="item-value">{{ (analysisResult.confidence * 100).toFixed(0) }}%</span>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue'
import { ContentAnalyzer } from '@/utils/ContentAnalyzer'
import { DisplayModeManager } from '@/utils/DisplayModeManager'

const props = defineProps({
  queryType: String,
  query: String,
  llmAnswer: String,
  allResults: Object,
  actualQueryType: String  // æ™ºèƒ½æŸ¥è¯¢æ—¶åç«¯è¿”å›çš„å®é™…æŸ¥è¯¢ç±»å‹
})

const emit = defineEmits(['display-mode-change'])

const contentAnalyzer = new ContentAnalyzer()
const displayModeManager = new DisplayModeManager()

const currentDisplayMode = ref(null)
const analysisResult = ref(null)

// æŸ¥è¯¢ç±»å‹é…ç½®
const queryTypes = {
  'text': {
    name: 'æ–‡æœ¬æŸ¥è¯¢',
    icon: 'ï¿½ï¿½',
    description: 'æŸ¥è¯¢æ–‡æœ¬å†…å®¹',
    displayMode: 'text-focused'
  },
  'image': {
    name: 'å›¾ç‰‡æŸ¥è¯¢',
    icon: 'ï¿½ï¿½ï¸',
    description: 'æŸ¥è¯¢å›¾ç‰‡å†…å®¹',
    displayMode: 'image-focused'
  },
  'table': {
    name: 'è¡¨æ ¼æŸ¥è¯¢',
    icon: 'ï¿½ï¿½',
    description: 'æŸ¥è¯¢è¡¨æ ¼æ•°æ®',
    displayMode: 'table-focused'
  },
  'smart': {
    name: 'æ™ºèƒ½æŸ¥è¯¢',
    icon: 'ï¿½ï¿½',
    description: 'ç³»ç»Ÿè‡ªåŠ¨åˆ¤æ–­æŸ¥è¯¢ç±»å‹',
    displayMode: 'auto-detect'
  },
  'hybrid': {
    name: 'æ··åˆæŸ¥è¯¢',
    icon: 'ï¿½ï¿½',
    description: 'è·¨ç±»å‹å†…å®¹æŸ¥è¯¢',
    displayMode: 'hybrid-layout'
  }
}

// å½“å‰æŸ¥è¯¢ç±»å‹
const currentQueryType = computed(() => {
  return queryTypes[props.queryType] || queryTypes.smart
})

// æ˜¯å¦æ˜¾ç¤ºåˆ†æç»“æœ
const showAnalysis = computed(() => {
  return props.queryType === 'smart' || props.queryType === 'hybrid'
})

// ç›‘å¬æŸ¥è¯¢ç±»å‹å˜åŒ–ï¼Œè‡ªåŠ¨é€‰æ‹©å±•ç¤ºæ¨¡å¼
watch(() => props.queryType, (newType) => {
  if (newType) {
    selectDisplayModeForQueryType(newType)
  }
}, { immediate: true })

// ç›‘å¬æ™ºèƒ½æŸ¥è¯¢ç»“æœå˜åŒ–ï¼Œå¤„ç†å±•ç¤ºæ¨¡å¼é€‰æ‹©
watch(() => props.actualQueryType, (newType) => {
  if (props.queryType === 'smart' && newType) {
    handleSmartQueryResult(newType)
  }
})

// ç›‘å¬LLMå›ç­”å˜åŒ–ï¼Œé‡æ–°åˆ†æï¼ˆæ··åˆæŸ¥è¯¢ï¼‰
watch(() => props.llmAnswer, (newAnswer) => {
  if (props.queryType === 'hybrid' && newAnswer) {
    analyzeLLMAnswer(newAnswer)
  }
})

// æ ¹æ®æŸ¥è¯¢ç±»å‹é€‰æ‹©å±•ç¤ºæ¨¡å¼
const selectDisplayModeForQueryType = (queryType) => {
  if (queryType === 'smart') {
    // æ™ºèƒ½æŸ¥è¯¢ï¼šåç«¯ä¼šè‡ªåŠ¨é€‰æ‹©æŸ¥è¯¢ç±»å‹ï¼Œå‰ç«¯æ ¹æ®åç«¯è¿”å›çš„æŸ¥è¯¢ç±»å‹ç›´æ¥åŒ¹é…å±•ç¤ºæ¨¡å¼
    // æ— éœ€å‰ç«¯åˆ†æï¼Œç­‰å¾…åç«¯è¿”å›ç»“æœåæ ¹æ®å®é™…æŸ¥è¯¢ç±»å‹åŒ¹é…
    currentDisplayMode.value = displayModeManager.getDisplayMode('auto-detect')
  } else if (queryType === 'hybrid') {
    // æ··åˆæŸ¥è¯¢ï¼šç­‰å¾…LLMå›ç­”ååˆ†æ
    currentDisplayMode.value = displayModeManager.getDisplayMode('hybrid-layout')
  } else {
    // å•ç±»æŸ¥è¯¢ï¼šç›´æ¥åº”ç”¨å¯¹åº”å±•ç¤ºæ¨¡å¼
    const displayMode = queryTypes[queryType].displayMode
    currentDisplayMode.value = displayModeManager.getDisplayMode(displayMode)
    emit('display-mode-change', displayMode)
  }
}

// å¤„ç†æ™ºèƒ½æŸ¥è¯¢ç»“æœï¼ˆæ™ºèƒ½æŸ¥è¯¢ï¼‰
const handleSmartQueryResult = (actualQueryType) => {
  try {
    // æ ¹æ®åç«¯è¿”å›çš„å®é™…æŸ¥è¯¢ç±»å‹ç›´æ¥åŒ¹é…å±•ç¤ºæ¨¡å¼
    const modeMap = {
      'text': 'text-focused',
      'image': 'image-focused',
      'table': 'table-focused',
      'hybrid': 'hybrid-layout'
    }
    
    const displayMode = modeMap[actualQueryType] || 'text-focused'
    currentDisplayMode.value = displayModeManager.getDisplayMode(displayMode)
    emit('display-mode-change', displayMode)
    
    // è®°å½•æ™ºèƒ½æŸ¥è¯¢çš„å®é™…é€‰æ‹©
    analysisResult.value = {
      actualQueryType: actualQueryType,
      selectedDisplayMode: displayMode,
      confidence: 1.0,
      reason: `æ™ºèƒ½æŸ¥è¯¢è‡ªåŠ¨é€‰æ‹©äº†${actualQueryType}æŸ¥è¯¢ç±»å‹`
    }
    
  } catch (error) {
    console.error('æ™ºèƒ½æŸ¥è¯¢ç»“æœå¤„ç†å¤±è´¥:', error)
    // å¤„ç†å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤æ¨¡å¼
    currentDisplayMode.value = displayModeManager.getDisplayMode('text-focused')
    emit('display-mode-change', 'text-focused')
  }
}

// åˆ†æLLMå›ç­”ï¼ˆæ··åˆæŸ¥è¯¢ï¼‰
const analyzeLLMAnswer = async (answer) => {
  try {
    const analysis = await contentAnalyzer.analyzeLLMAnswer(answer, props.allResults)
    analysisResult.value = analysis
    
    // æ ¹æ®åˆ†æç»“æœé€‰æ‹©å±•ç¤ºæ¨¡å¼
    const displayMode = analysis.recommendedDisplayMode
    currentDisplayMode.value = displayModeManager.getDisplayMode(displayMode)
    emit('display-mode-change', displayMode)
    
  } catch (error) {
    console.error('LLMå›ç­”åˆ†æå¤±è´¥:', error)
    // åˆ†æå¤±è´¥æ—¶ä½¿ç”¨æ··åˆå¸ƒå±€æ¨¡å¼
    currentDisplayMode.value = displayModeManager.getDisplayMode('hybrid-layout')
    emit('display-mode-change', 'hybrid-layout')
  }
}
</script>
```

#### 2.2 ContentAnalyzerç±»ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
**å®ç°ç­–ç•¥**ï¼šå…ˆå®ç°ç®€åŒ–ç‰ˆæœ¬ï¼Œå¤æ‚åŠŸèƒ½å¯åç»­å®Œå–„

```javascript
// ContentAnalyzer.js - å†…å®¹æ™ºèƒ½åˆ†æå™¨ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
export class ContentAnalyzer {
  /**
   * åˆ†ææŸ¥è¯¢å†…å®¹ï¼Œæ™ºèƒ½åˆ¤æ–­æŸ¥è¯¢ç±»å‹ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
   */
  async analyzeQueryContent(query) {
    const analysis = {
      contentTypes: [],
      confidence: 0,
      keywords: [],
      recommendedDisplayMode: 'text-focused'
    }
    
    try {
      // ç®€åŒ–ç‰ˆæœ¬ï¼šä½¿ç”¨åŸºç¡€å…³é”®è¯åŒ¹é…
      const keywords = this.extractKeywordsSimple(query)
      analysis.keywords = keywords
      
      // ç®€åŒ–ç‰ˆæœ¬ï¼šä½¿ç”¨ç®€å•çš„é˜ˆå€¼åˆ¤æ–­
      const scores = this.calculateScoresSimple(query, keywords)
      
      // ç®€åŒ–ç‰ˆæœ¬ï¼šç›´æ¥é€‰æ‹©æœ€é«˜åˆ†ç±»å‹
      const maxType = Object.keys(scores).reduce((a, b) => scores[a] > scores[b] ? a : b)
      const maxScore = scores[maxType]
      
      if (maxScore > 0.5) {  // é™ä½é˜ˆå€¼ï¼Œç®€åŒ–åˆ¤æ–­
        analysis.contentTypes = [maxType]
        analysis.confidence = maxScore
        
        // æ ¹æ®ç±»å‹æ¨èå±•ç¤ºæ¨¡å¼
        const modeMap = {
          'image': 'image-focused',
          'table': 'table-focused',
          'text': 'text-focused'
        }
        analysis.recommendedDisplayMode = modeMap[maxType]
      } else {
        // æ— æ³•ç¡®å®šç±»å‹ï¼Œä½¿ç”¨æ–‡æœ¬æ¨¡å¼
        analysis.contentTypes = ['text']
        analysis.confidence = 0.5
        analysis.recommendedDisplayMode = 'text-focused'
      }
      
      return analysis
      
    } catch (error) {
      console.error('æŸ¥è¯¢å†…å®¹åˆ†æå¤±è´¥:', error)
      return {
        contentTypes: ['text'],
        confidence: 0.3,
        keywords: [],
        recommendedDisplayMode: 'text-focused'
      }
    }
  }
  
  /**
   * ç®€åŒ–çš„å…³é”®è¯æå–
   */
  extractKeywordsSimple(query) {
    const keywords = []
    const lowerQuery = query.toLowerCase()
    
    // ç®€åŒ–çš„å…³é”®è¯åŒ¹é…
    if (lowerQuery.includes('å›¾ç‰‡') || lowerQuery.includes('å›¾è¡¨') || lowerQuery.includes('å›¾')) {
      keywords.push({ type: 'image', keyword: 'å›¾ç‰‡ç›¸å…³', weight: 0.8 })
    }
    if (lowerQuery.includes('è¡¨æ ¼') || lowerQuery.includes('æ•°æ®') || lowerQuery.includes('ç»Ÿè®¡')) {
      keywords.push({ type: 'table', keyword: 'è¡¨æ ¼ç›¸å…³', weight: 0.8 })
    }
    if (lowerQuery.includes('æŠ¥å‘Š') || lowerQuery.includes('åˆ†æ') || lowerQuery.includes('è¯´æ˜')) {
      keywords.push({ type: 'text', keyword: 'æ–‡æœ¬ç›¸å…³', weight: 0.6 })
    }
    
    return keywords
  }
  
  /**
   * ç®€åŒ–çš„åˆ†æ•°è®¡ç®—
   */
  calculateScoresSimple(query, keywords) {
    const scores = { image: 0, table: 0, text: 0 }
    
    keywords.forEach(kw => {
      scores[kw.type] += kw.weight
    })
    
    // å¦‚æœæ²¡æœ‰å…³é”®è¯ï¼Œé»˜è®¤ä¸ºæ–‡æœ¬
    if (Object.values(scores).every(s => s === 0)) {
      scores.text = 0.5
    }
    
    return scores
  }
  
  /**
   * åˆ†æLLMå›ç­”å†…å®¹ï¼Œæ™ºèƒ½é€‰æ‹©å±•ç¤ºæ¨¡å¼
   */
  async analyzeLLMAnswer(answer, allResults) {
    const analysis = {
      contentTypes: [],
      confidence: 0,
      contentFeatures: {},
      recommendedDisplayMode: 'hybrid-layout'
    }
    
    try {
      // 1. åˆ†æLLMå›ç­”ä¸­çš„å†…å®¹å¼•ç”¨
      const answerAnalysis = this.analyzeAnswerContent(answer)
      
      // 2. åˆ†æå®é™…è¿”å›çš„ç»“æœå†…å®¹
      const resultsAnalysis = this.analyzeResultsContent(allResults)
      
      // 3. ç»¼åˆåˆ†æï¼Œæ¨èå±•ç¤ºæ¨¡å¼
      analysis.contentTypes = this.mergeContentTypes(answerAnalysis, resultsAnalysis)
      analysis.contentFeatures = this.mergeContentFeatures(answerAnalysis, resultsAnalysis)
      analysis.confidence = this.calculateConfidence(answerAnalysis, resultsAnalysis)
      
      // 4. æ ¹æ®å†…å®¹ç‰¹å¾æ¨èå±•ç¤ºæ¨¡å¼
      analysis.recommendedDisplayMode = this.recommendDisplayMode(analysis)
      
      return analysis
      
    } catch (error) {
      console.error('LLMå›ç­”åˆ†æå¤±è´¥:', error)
      return {
        contentTypes: ['text'],
        confidence: 0.3,
        contentFeatures: {},
        recommendedDisplayMode: 'hybrid-layout'
      }
    }
  }
  
  /**
   * æå–æŸ¥è¯¢å…³é”®è¯
   */
  extractKeywords(query) {
    const keywords = []
    
    // å›¾ç‰‡ç›¸å…³å…³é”®è¯
    const imageKeywords = ['å›¾ç‰‡', 'ç…§ç‰‡', 'å›¾è¡¨', 'æˆªå›¾', 'å›¾åƒ', 'photo', 'image', 'chart', 'graph']
    imageKeywords.forEach(keyword => {
      if (query.includes(keyword)) {
        keywords.push({ type: 'image', keyword, weight: 0.8 })
      }
    })
    
    // è¡¨æ ¼ç›¸å…³å…³é”®è¯
    const tableKeywords = ['è¡¨æ ¼', 'æ•°æ®', 'ç»Ÿè®¡', 'æŠ¥è¡¨', 'table', 'data', 'statistics', 'report']
    tableKeywords.forEach(keyword => {
      if (query.includes(keyword)) {
        keywords.push({ type: 'table', keyword, weight: 0.8 })
      }
    })
    
    // æ–‡æœ¬ç›¸å…³å…³é”®è¯
    const textKeywords = ['æŠ¥å‘Š', 'åˆ†æ', 'è¯´æ˜', 'ä»‹ç»', 'report', 'analysis', 'description']
    textKeywords.forEach(keyword => {
      if (query.includes(keyword)) {
        keywords.push({ type: 'text', keyword, weight: 0.6 })
      }
    })
    
    return keywords
  }
  
  /**
   * è®¡ç®—å›¾ç‰‡æŸ¥è¯¢åˆ†æ•°
   */
  calculateImageScore(query, keywords) {
    let score = 0
    
    // å…³é”®è¯åˆ†æ•°
    const imageKeywords = keywords.filter(k => k.type === 'image')
    score += imageKeywords.length * 0.3
    
    // æŸ¥è¯¢æ¨¡å¼åˆ†æ•°
    if (query.includes('è¿™ä¸ªå›¾') || query.includes('è¿™å¼ å›¾') || query.includes('å›¾ç‰‡æ˜¾ç¤º')) {
      score += 0.4
    }
    
    // è§†è§‰æè¿°åˆ†æ•°
    if (query.includes('é¢œè‰²') || query.includes('å½¢çŠ¶') || query.includes('å¤§å°')) {
      score += 0.2
    }
    
    return Math.min(score, 1.0)
  }
  
  /**
   * è®¡ç®—è¡¨æ ¼æŸ¥è¯¢åˆ†æ•°
   */
  calculateTableScore(query, keywords) {
    let score = 0
    
    // å…³é”®è¯åˆ†æ•°
    const tableKeywords = keywords.filter(k => k.type === 'table')
    score += tableKeywords.length * 0.3
    
    // æŸ¥è¯¢æ¨¡å¼åˆ†æ•°
    if (query.includes('æ•°æ®') || query.includes('æ•°å€¼') || query.includes('ç»Ÿè®¡')) {
      score += 0.4
    }
    
    // æ¯”è¾ƒæŸ¥è¯¢åˆ†æ•°
    if (query.includes('å¯¹æ¯”') || query.includes('æ¯”è¾ƒ') || query.includes('è¶‹åŠ¿')) {
      score += 0.2
    }
    
    return Math.min(score, 1.0)
  }
  
  /**
   * è®¡ç®—æ–‡æœ¬æŸ¥è¯¢åˆ†æ•°
   */
  calculateTextScore(query, keywords) {
    let score = 0
    
    // å…³é”®è¯åˆ†æ•°
    const textKeywords = keywords.filter(k => k.type === 'text')
    score += textKeywords.length * 0.3
    
    // æŸ¥è¯¢æ¨¡å¼åˆ†æ•°
    if (query.includes('ä»€ä¹ˆ') || query.includes('å¦‚ä½•') || query.includes('ä¸ºä»€ä¹ˆ')) {
      score += 0.3
    }
    
    // å†…å®¹ç±»å‹åˆ†æ•°
    if (query.includes('æŠ¥å‘Š') || query.includes('åˆ†æ') || query.includes('è¯´æ˜')) {
      score += 0.2
    }
    
    return Math.min(score, 1.0)
  }
  
  /**
   * åˆ†æLLMå›ç­”å†…å®¹
   */
  analyzeAnswerContent(answer) {
    const analysis = {
      contentTypes: [],
      contentFeatures: {}
    }
    
    // æ£€æµ‹å›¾ç‰‡å¼•ç”¨
    if (answer.includes('å›¾ç‰‡') || answer.includes('å›¾è¡¨') || answer.includes('æˆªå›¾')) {
      analysis.contentTypes.push('image')
      analysis.contentFeatures.hasImageReference = true
    }
    
    // æ£€æµ‹è¡¨æ ¼å¼•ç”¨
    if (answer.includes('è¡¨æ ¼') || answer.includes('æ•°æ®') || /\d+\.\d+/.test(answer)) {
      analysis.contentTypes.push('table')
      analysis.contentFeatures.hasTableReference = true
    }
    
    // æ£€æµ‹ç»“æ„åŒ–æ•°æ®
    if (answer.includes('è¥æ”¶') || answer.includes('å‡€åˆ©æ¶¦') || answer.includes('å¸‚åœºä»½é¢')) {
      analysis.contentTypes.push('structured-data')
      analysis.contentFeatures.hasStructuredData = true
    }
    
    // å¦‚æœæ²¡æœ‰æ£€æµ‹åˆ°ç‰¹å®šç±»å‹ï¼Œé»˜è®¤ä¸ºæ–‡æœ¬
    if (analysis.contentTypes.length === 0) {
      analysis.contentTypes.push('text')
    }
    
    return analysis
  }
  
  /**
   * åˆ†æç»“æœå†…å®¹
   */
  analyzeResultsContent(allResults) {
    const analysis = {
      contentTypes: [],
      contentFeatures: {}
    }
    
    if (allResults) {
      if (allResults.image_results && allResults.image_results.length > 0) {
        analysis.contentTypes.push('image')
        analysis.contentFeatures.hasImages = true
        analysis.contentFeatures.imageCount = allResults.image_results.length
      }
      
      if (allResults.table_results && allResults.table_results.length > 0) {
        analysis.contentTypes.push('table')
        analysis.contentFeatures.hasTables = true
        analysis.contentFeatures.tableCount = allResults.table_results.length
      }
      
      if (allResults.text_results && allResults.text_results.length > 0) {
        analysis.contentTypes.push('text')
        analysis.contentFeatures.hasText = true
        analysis.contentFeatures.textCount = allResults.text_results.length
      }
    }
    
    return analysis
  }
  
  /**
   * åˆå¹¶å†…å®¹ç±»å‹
   */
  mergeContentTypes(answerAnalysis, resultsAnalysis) {
    const allTypes = new Set([
      ...answerAnalysis.contentTypes,
      ...resultsAnalysis.contentTypes
    ])
    return Array.from(allTypes)
  }
  
  /**
   * åˆå¹¶å†…å®¹ç‰¹å¾
   */
  mergeContentFeatures(answerAnalysis, resultsAnalysis) {
    return {
      ...answerAnalysis.contentFeatures,
      ...resultsAnalysis.contentFeatures
    }
  }
  
  /**
   * è®¡ç®—ç½®ä¿¡åº¦
   */
  calculateConfidence(answerAnalysis, resultsAnalysis) {
    let confidence = 0.5 // åŸºç¡€ç½®ä¿¡åº¦
    
    // å¦‚æœLLMå›ç­”å’Œå®é™…ç»“æœéƒ½æåˆ°äº†ç›¸åŒç±»å‹ï¼Œæé«˜ç½®ä¿¡åº¦
    const commonTypes = answerAnalysis.contentTypes.filter(type => 
      resultsAnalysis.contentTypes.includes(type)
    )
    confidence += commonTypes.length * 0.2
    
    // å¦‚æœå†…å®¹ç‰¹å¾ä¸°å¯Œï¼Œæé«˜ç½®ä¿¡åº¦
    const featureCount = Object.keys(resultsAnalysis.contentFeatures).length
    confidence += Math.min(featureCount * 0.1, 0.3)
    
    return Math.min(confidence, 1.0)
  }
  
  /**
   * æ¨èå±•ç¤ºæ¨¡å¼
   */
  recommendDisplayMode(analysis) {
    const { contentTypes, contentFeatures } = analysis
    
    // å¦‚æœåªæœ‰ä¸€ç§å†…å®¹ç±»å‹ï¼Œä½¿ç”¨å¯¹åº”çš„ä¸“æ³¨æ¨¡å¼
    if (contentTypes.length === 1) {
      const type = contentTypes[0]
      const modeMap = {
        'image': 'image-focused',
        'table': 'table-focused',
        'text': 'text-focused'
      }
      return modeMap[type] || 'text-focused'
    }
    
    // å¦‚æœåŒ…å«å›¾ç‰‡å’Œè¡¨æ ¼ï¼Œä½¿ç”¨æ··åˆå¸ƒå±€
    if (contentTypes.includes('image') && contentTypes.includes('table')) {
      return 'hybrid-layout'
    }
    
    // å¦‚æœåŒ…å«å›¾ç‰‡ï¼Œä½¿ç”¨å›¾ç‰‡ä¼˜å…ˆ
    if (contentTypes.includes('image')) {
      return 'image-focused'
    }
    
    // å¦‚æœåŒ…å«è¡¨æ ¼ï¼Œä½¿ç”¨è¡¨æ ¼ä¼˜å…ˆ
    if (contentTypes.includes('table')) {
      return 'table-focused'
    }
    
    // é»˜è®¤ä½¿ç”¨æ–‡æœ¬æ¨¡å¼
    return 'text-focused'
  }
}
```

#### 2.3 DisplayModeManagerç±»
```javascript
// DisplayModeManager.js - å±•ç¤ºæ¨¡å¼ç®¡ç†å™¨
export class DisplayModeManager {
  constructor() {
    this.displayModes = this.initializeDisplayModes()
  }
  
  /**
   * åˆå§‹åŒ–å±•ç¤ºæ¨¡å¼
   */
  initializeDisplayModes() {
    return {
      'text-focused': {
        id: 'text-focused',
        name: 'æ–‡æœ¬ä¼˜å…ˆ',
        icon: 'ğŸ“',
        description: 'é€‚åˆæ–‡æœ¬å†…å®¹ä¸ºä¸»çš„æŸ¥è¯¢',
        layout: 'vertical',
        priority: ['text', 'table', 'image']
      },
      'image-focused': {
        id: 'image-focused',
        name: 'å›¾ç‰‡ä¼˜å…ˆ',
        icon: 'ğŸ–¼ï¸',
        description: 'é€‚åˆå›¾ç‰‡å†…å®¹ä¸ºä¸»çš„æŸ¥è¯¢',
        layout: 'horizontal',
        priority: ['image', 'text', 'table']
      },
      'table-focused': {
        id: 'table-focused',
        name: 'è¡¨æ ¼ä¼˜å…ˆ',
        icon: 'ğŸ“Š',
        description: 'é€‚åˆè¡¨æ ¼æ•°æ®ä¸ºä¸»çš„æŸ¥è¯¢',
        layout: 'horizontal',
        priority: ['table', 'text', 'image']
      },
      'hybrid-layout': {
        id: 'hybrid-layout',
        name: 'æ··åˆå¸ƒå±€',
        icon: 'ğŸ”€',
        description: 'é€‚åˆå¤šç§å†…å®¹ç±»å‹çš„æŸ¥è¯¢',
        layout: 'grid',
        priority: ['text', 'table', 'image']
      },
      'auto-detect': {
        id: 'auto-detect',
        name: 'æ™ºèƒ½æ£€æµ‹',
        icon: 'ğŸ¤–',
        description: 'ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä½³å±•ç¤ºæ¨¡å¼',
        layout: 'adaptive',
        priority: ['auto']
      }
    }
  }
  
  /**
   * è·å–å±•ç¤ºæ¨¡å¼
   */
  getDisplayMode(modeId) {
    return this.displayModes[modeId] || this.displayModes['text-focused']
  }
  
  /**
   * è·å–æ‰€æœ‰å±•ç¤ºæ¨¡å¼
   */
  getAllDisplayModes() {
    return Object.values(this.displayModes)
  }
  
  /**
   * æ ¹æ®å†…å®¹ç±»å‹æ¨èå±•ç¤ºæ¨¡å¼
   */
  recommendDisplayMode(contentTypes, confidence = 0.5) {
    if (contentTypes.length === 0) {
      return this.displayModes['text-focused']
    }
    
    if (contentTypes.length === 1) {
      const type = contentTypes[0]
      const modeMap = {
        'image': 'image-focused',
        'table': 'table-focused',
        'text': 'text-focused'
      }
      return this.displayModes[modeMap[type] || 'text-focused']
    }
    
    // å¤šç§å†…å®¹ç±»å‹ï¼Œä½¿ç”¨æ··åˆå¸ƒå±€
    return this.displayModes['hybrid-layout']
  }
  
  /**
   * éªŒè¯å±•ç¤ºæ¨¡å¼æ˜¯å¦é€‚åˆå†…å®¹
   */
  validateDisplayMode(modeId, contentTypes) {
    const mode = this.getDisplayMode(modeId)
    if (!mode) return false
    
    // æ£€æŸ¥å†…å®¹ç±»å‹æ˜¯å¦ä¸æ¨¡å¼åŒ¹é…
    const modePriority = mode.priority
    const hasMatchingContent = contentTypes.some(type => 
      modePriority.includes(type)
    )
    
    return hasMatchingContent
  }
}
```

### 3. å±•ç¤ºæ¨¡å¼åº”ç”¨é€»è¾‘

#### 3.1 å•ç±»æŸ¥è¯¢å±•ç¤ºæ¨¡å¼åº”ç”¨
```javascript
// å•ç±»æŸ¥è¯¢ï¼šç›´æ¥åº”ç”¨å¯¹åº”å±•ç¤ºæ¨¡å¼
const applySingleTypeDisplayMode = (queryType) => {
  const modeMap = {
    'text': 'text-focused',
    'image': 'image-focused',
    'table': 'table-focused'
  }
  
  const displayMode = modeMap[queryType]
  if (displayMode) {
    return {
      mode: displayMode,
      confidence: 1.0,
      reason: `ç”¨æˆ·æ˜ç¡®é€‰æ‹©${queryType}æŸ¥è¯¢ç±»å‹`
    }
  }
  
  return {
    mode: 'text-focused',
    confidence: 0.5,
    reason: 'æœªçŸ¥æŸ¥è¯¢ç±»å‹ï¼Œä½¿ç”¨é»˜è®¤æ–‡æœ¬æ¨¡å¼'
  }
}
```

#### 3.2 æ™ºèƒ½æŸ¥è¯¢å±•ç¤ºæ¨¡å¼åº”ç”¨
```javascript
// æ™ºèƒ½æŸ¥è¯¢ï¼šæ ¹æ®åç«¯è¿”å›çš„å®é™…æŸ¥è¯¢ç±»å‹ç›´æ¥åŒ¹é…å±•ç¤ºæ¨¡å¼
const applySmartQueryDisplayMode = (actualQueryType) => {
  try {
    // åç«¯å·²ç»è‡ªåŠ¨é€‰æ‹©äº†æŸ¥è¯¢ç±»å‹ï¼Œå‰ç«¯ç›´æ¥æ ¹æ®ç±»å‹åŒ¹é…å±•ç¤ºæ¨¡å¼
    const modeMap = {
      'text': 'text-focused',
      'image': 'image-focused',
      'table': 'table-focused',
      'hybrid': 'hybrid-layout'
    }
    
    const displayMode = modeMap[actualQueryType] || 'text-focused'
    
    return {
      mode: displayMode,
      confidence: 1.0,
      reason: `æ™ºèƒ½æŸ¥è¯¢è‡ªåŠ¨é€‰æ‹©äº†${actualQueryType}æŸ¥è¯¢ç±»å‹`,
      actualQueryType: actualQueryType
    }
  } catch (error) {
    console.error('æ™ºèƒ½æŸ¥è¯¢å±•ç¤ºæ¨¡å¼åº”ç”¨å¤±è´¥:', error)
    return {
      mode: 'text-focused',
      confidence: 0.3,
      reason: 'æ™ºèƒ½æŸ¥è¯¢å¤„ç†å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ–‡æœ¬æ¨¡å¼'
    }
  }
}
```

#### 3.3 æ··åˆæŸ¥è¯¢å±•ç¤ºæ¨¡å¼åº”ç”¨
```javascript
// æ··åˆæŸ¥è¯¢ï¼šåˆ†æLLMå›ç­”ï¼Œæ™ºèƒ½é€‰æ‹©
const applyHybridQueryDisplayMode = async (llmAnswer, allResults) => {
  try {
    const contentAnalyzer = new ContentAnalyzer()
    const analysis = await contentAnalyzer.analyzeLLMAnswer(llmAnswer, allResults)
    
    return {
      mode: analysis.recommendedDisplayMode,
      confidence: analysis.confidence,
      reason: `åŸºäºLLMå›ç­”åˆ†æï¼Œæ£€æµ‹åˆ°${analysis.contentTypes.join('ã€')}å†…å®¹ç±»å‹`,
      analysis: analysis
    }
  } catch (error) {
    console.error('æ··åˆæŸ¥è¯¢åˆ†æå¤±è´¥:', error)
    return {
      mode: 'hybrid-layout',
      confidence: 0.3,
      reason: 'æ··åˆæŸ¥è¯¢åˆ†æå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ··åˆå¸ƒå±€æ¨¡å¼'
    }
  }
}
```

### 4. é…ç½®ç®¡ç†è®¾è®¡

#### 4.1 å‰ç«¯é»˜è®¤é…ç½®ç­–ç•¥
**è®¾è®¡åŸåˆ™**ï¼šå‰ç«¯é»˜è®¤é…ç½® + åç«¯APIæ”¯æŒï¼Œä¼˜å…ˆä½¿ç”¨å‰ç«¯é…ç½®

**å‰ç«¯é»˜è®¤é…ç½®**ï¼š
```javascript
// frontend/src/utils/constants.js
export const DISPLAY_MODE_CONFIG = {
  enabled: true,                    // æ˜¯å¦å¯ç”¨å±•ç¤ºæ¨¡å¼é€‰æ‹©åŠŸèƒ½
  defaultMode: 'auto-detect',       // é»˜è®¤å±•ç¤ºæ¨¡å¼
  autoSelectionRules: {             // è‡ªåŠ¨é€‰æ‹©è§„åˆ™ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
    textThreshold: 0.7,             // æ–‡æœ¬å†…å®¹é˜ˆå€¼
    imageThreshold: 0.6,            // å›¾ç‰‡å†…å®¹é˜ˆå€¼
    tableThreshold: 0.5             // è¡¨æ ¼å†…å®¹é˜ˆå€¼
  },
  fallbackMode: 'text-focused',     // åˆ†æå¤±è´¥æ—¶çš„å¤‡ç”¨æ¨¡å¼
  simplifiedAnalysis: true          // ä½¿ç”¨ç®€åŒ–çš„å†…å®¹åˆ†æ
}
```

#### 4.2 åç«¯APIé…ç½®æ”¯æŒ
**é…ç½®è·å–æ¥å£**ï¼š
```javascript
// frontend/src/services/api.js
class RAGAPIService {
  async getDisplayModeConfig() {
    try {
      // å°è¯•è·å–åç«¯é…ç½®
      const response = await api.get('/api/v3/rag/config/display-mode')
      return response.data
    } catch (error) {
      // å¦‚æœå¤±è´¥ï¼Œä½¿ç”¨å‰ç«¯é»˜è®¤é…ç½®
      console.warn('ä½¿ç”¨å‰ç«¯é»˜è®¤é…ç½®:', error)
      return DISPLAY_MODE_CONFIG
    }
  }
}
```

#### 4.3 é…ç½®ç»“æ„
```json
{
  "rag_system": {
    "frontend": {
      "display_mode_selection": {
        "enabled": true,
        "default_mode": "auto-detect",
        "confidence_threshold": 0.6,
        "analysis_timeout": 5000,
        "fallback_mode": "text-focused",
        "simplified_analysis": true,
        "user_preference_learning": false
      }
    }
  }
}
```

#### 4.4 é…ç½®å‚æ•°è¯´æ˜

| å‚æ•°åç§°               | é»˜è®¤å€¼         | è¯´æ˜                     |
| ---------------------- | -------------- | ------------------------ |
| `enabled`              | true           | æ˜¯å¦å¯ç”¨å±•ç¤ºæ¨¡å¼é€‰æ‹©åŠŸèƒ½ |
| `default_mode`         | "auto-detect"  | é»˜è®¤å±•ç¤ºæ¨¡å¼             |
| `confidence_threshold` | 0.6            | æ™ºèƒ½åˆ†æç½®ä¿¡åº¦é˜ˆå€¼       |
| `analysis_timeout`     | 5000           | å†…å®¹åˆ†æè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ |
| `fallback_mode`        | "text-focused" | åˆ†æå¤±è´¥æ—¶çš„å¤‡ç”¨æ¨¡å¼     |
| `simplified_analysis`  | true           | ä½¿ç”¨ç®€åŒ–çš„å†…å®¹åˆ†æ       |
| `user_preference_learning` | false    | æ˜¯å¦å¯ç”¨ç”¨æˆ·åå¥½å­¦ä¹      |

## äº”ã€æ¥å£è®¾è®¡

### 1. æ ¸å¿ƒæ¥å£

#### 1.1 é€‰æ‹©å±•ç¤ºæ¨¡å¼æ¥å£
```javascript
async function selectDisplayMode(queryType, query, llmAnswer, allResults) {
  /**
   * é€‰æ‹©å±•ç¤ºæ¨¡å¼
   * 
   * @param {string} queryType - æŸ¥è¯¢ç±»å‹
   * @param {string} query - æŸ¥è¯¢å†…å®¹
   * @param {string} llmAnswer - LLMå›ç­”
   * @param {Object} allResults - æ‰€æœ‰æŸ¥è¯¢ç»“æœ
   * @return {Object} å±•ç¤ºæ¨¡å¼é€‰æ‹©ç»“æœ
   */
}
```

#### 1.2 è¿”å›æ•°æ®ç»“æ„
```javascript
{
  mode: 'image-focused',           // é€‰æ‹©çš„å±•ç¤ºæ¨¡å¼
  confidence: 0.85,                // é€‰æ‹©ç½®ä¿¡åº¦
  reason: 'æ™ºèƒ½åˆ†ææ£€æµ‹åˆ°å›¾ç‰‡å†…å®¹ç±»å‹', // é€‰æ‹©åŸå› 
  analysis: {                      // åˆ†æç»“æœè¯¦æƒ…
    contentTypes: ['image'],
    keywords: [...],
    contentFeatures: {...}
  },
  fallback: false                  // æ˜¯å¦ä½¿ç”¨äº†å¤‡ç”¨æ¨¡å¼
}
```

## å…­ã€ä¸V3ç³»ç»Ÿé›†æˆ

### 1. é›†æˆç­–ç•¥
**è®¾è®¡åŸåˆ™**ï¼šä½œä¸ºå¯é€‰åŠŸèƒ½é›†æˆï¼Œä¸æ›¿æ¢ç°æœ‰é€»è¾‘

**é›†æˆæ–¹å¼**ï¼š
- **åŠŸèƒ½å¼€å…³**ï¼šé€šè¿‡é…ç½®æ§åˆ¶æ˜¯å¦å¯ç”¨æ–°åŠŸèƒ½
- **æ¸è¿›å¼é›†æˆ**ï¼šæ–°åŠŸèƒ½ä¸ç°æœ‰åŠŸèƒ½å¹¶è¡Œè¿è¡Œ
- **é™çº§æœºåˆ¶**ï¼šå¦‚æœæ–°åŠŸèƒ½å‡ºç°é—®é¢˜ï¼Œè‡ªåŠ¨å›é€€åˆ°ç°æœ‰å±•ç¤ºé€»è¾‘
- **å‘åå…¼å®¹**ï¼šç¡®ä¿ç°æœ‰åŠŸèƒ½ä¸å—å½±å“

### 2. é›†æˆç‚¹
- **æŸ¥è¯¢ç±»å‹é€‰æ‹©æ¨¡å—**ï¼šè·å–ç”¨æˆ·é€‰æ‹©çš„æŸ¥è¯¢ç±»å‹
- **å†…å®¹åˆ†ææ¨¡å—**ï¼šåˆ†ææŸ¥è¯¢å†…å®¹å’ŒLLMå›ç­”ç‰¹å¾ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
- **ç»“æœå±•ç¤ºæ¨¡å—**ï¼šåº”ç”¨é€‰æ‹©çš„å±•ç¤ºæ¨¡å¼
- **ç°æœ‰Chat.vue**ï¼šä½œä¸ºå¯é€‰åŠŸèƒ½é›†æˆ

### 3. æ•°æ®æµ
```
ç”¨æˆ·æŸ¥è¯¢ â†’ æŸ¥è¯¢ç±»å‹é€‰æ‹© â†’ å±•ç¤ºæ¨¡å¼é€‰æ‹© â†’ å†…å®¹åˆ†æ â†’ æ¨¡å¼åº”ç”¨ â†’ ç»“æœå±•ç¤º
    â†“
ç°æœ‰é€»è¾‘ï¼ˆå¹¶è¡Œè¿è¡Œï¼Œä½œä¸ºå¤‡ç”¨ï¼‰
```

### 4. Chat.vueé‡æ„æ–¹æ¡ˆ

**é‡æ„ç›®æ ‡**ï¼šè§£å†³ç°æœ‰Chat.vueçš„é—®é¢˜ï¼Œç»Ÿä¸€ä¸ºæ™ºèƒ½é—®ç­”ç³»ç»Ÿ

**ç°æœ‰é—®é¢˜**ï¼š
- é—®ç­”å’Œå†…å®¹æœç´¢çš„ä¾§é‡ç‚¹ä¸æ˜ç¡®
- ç¼ºå°‘é¢„è®¾é—®é¢˜åŠŸèƒ½
- ä¸åŒæŸ¥è¯¢çš„å±•ç¤ºåŒ¹é…ä¸å®Œå–„
- æ¥æºä¿¡æ¯æ˜¾ç¤ºä¸å®Œæ•´ï¼ˆç¼ºå°‘æ–‡æ¡£åã€é¡µç ã€è¡¨æ ¼åã€å›¾ç‰‡åç­‰ï¼‰

**é‡æ„æ–¹æ¡ˆ**ï¼š
```vue
<!-- é‡æ„åçš„Chat.vue - ç»Ÿä¸€æ™ºèƒ½é—®ç­”ç³»ç»Ÿ -->
<template>
  <div class="unified-qa-container">
    <!-- 1. é¢„è®¾é—®é¢˜åŒºåŸŸ -->
    <PresetQuestions 
      :query-type="selectedQueryType"
      @question-selected="handlePresetQuestion"
    />
    
    <!-- 2. æŸ¥è¯¢è¾“å…¥åŒºåŸŸ -->
    <div class="query-input-section">
      <QueryTypeSelector v-model="selectedQueryType" />
      <QueryInput 
        v-model="userQuery"
        :query-type="selectedQueryType"
        @submit="handleQuerySubmit"
      />
    </div>
    
    <!-- 3. å±•ç¤ºæ¨¡å¼é€‰æ‹©åŒºåŸŸ -->
    <DisplayModeSelector 
      v-model="displayMode"
      :query-type="selectedQueryType"
      :query-results="currentResults"
      @mode-change="handleDisplayModeChange"
    />
    
    <!-- 4. æ™ºèƒ½é—®ç­”ç»“æœå±•ç¤ºåŒºåŸŸ -->
    <div class="qa-results-section">
      <!-- åŠ¨æ€å±•ç¤ºç»„ä»¶ -->
      <component 
        :is="currentDisplayComponent"
        :results="currentResults"
        :display-mode="displayMode"
        :query-type="selectedQueryType"
        :llm-answer="llmAnswer"
        :sources="detailedSources"
      />
    </div>
  </div>
</template>
```

**æ¥æºä¿¡æ¯æ˜¾ç¤ºè¦æ±‚**ï¼š
- **æ–‡æ¡£ä¿¡æ¯**ï¼šæ˜¾ç¤ºæ–‡æ¡£åç§°å’Œé¡µç 
- **è¡¨æ ¼ä¿¡æ¯**ï¼šæ˜¾ç¤ºè¡¨æ ¼æ ‡é¢˜ï¼ˆä»å…ƒæ•°æ®è·å–ï¼‰
- **å›¾ç‰‡ä¿¡æ¯**ï¼šæ˜¾ç¤ºå›¾ç‰‡æ ‡é¢˜/è¯´æ˜ï¼ˆä»å…ƒæ•°æ®è·å–ï¼‰
- **ä¸æ˜¾ç¤º**ï¼šchunk-idç­‰å¯¹ç”¨æˆ·ä¸å‹å¥½çš„æŠ€æœ¯æ ‡è¯†
- **å…ƒæ•°æ®æ¥æº**ï¼šä»M15å…ƒæ•°æ®ç®¡ç†æ¨¡å—è·å–è¯¦ç»†ä¿¡æ¯

<script setup>
import { ref, computed, onMounted } from 'vue'
import { DISPLAY_MODE_CONFIG } from '@/utils/constants'
import DisplayModeSelector from '@/components/DisplayModeSelector.vue'

// é…ç½®ç®¡ç†
const displayModeConfig = ref(DISPLAY_MODE_CONFIG)
const displayMode = ref('auto-detect')

// åŠ è½½é…ç½®
onMounted(async () => {
  try {
    const config = await apiService.getDisplayModeConfig()
    displayModeConfig.value = { ...DISPLAY_MODE_CONFIG, ...config }
  } catch (error) {
    console.warn('ä½¿ç”¨å‰ç«¯é»˜è®¤é…ç½®')
  }
})

// å±•ç¤ºæ¨¡å¼åˆ‡æ¢å¤„ç†
const handleDisplayModeChange = (newMode) => {
  displayMode.value = newMode
  // è®°å½•ç”¨æˆ·åå¥½ï¼Œç”¨äºåç»­ä¼˜åŒ–
  apiService.updateDisplayModePreference(newMode).catch(console.warn)
}
</script>
```

### 3. é›†æˆç¤ºä¾‹
```vue
<!-- åœ¨æŸ¥è¯¢å¤„ç†ç»„ä»¶ä¸­çš„ä½¿ç”¨ -->
<template>
  <div class="query-processor">
    <!-- æŸ¥è¯¢ç±»å‹é€‰æ‹© -->
    <QueryTypeSelector @type-change="handleQueryTypeChange" />
    
    <!-- å±•ç¤ºæ¨¡å¼é€‰æ‹©å™¨ -->
    <DisplayModeSelector 
      :query-type="currentQueryType"
      :query="currentQuery"
      :llm-answer="llmAnswer"
      :all-results="allResults"
      @display-mode-change="handleDisplayModeChange"
    />
    
    <!-- ç»“æœå±•ç¤ºï¼ˆåº”ç”¨é€‰æ‹©çš„å±•ç¤ºæ¨¡å¼ï¼‰ -->
    <ResultDisplay 
      :display-mode="selectedDisplayMode"
      :results="allResults"
      :sources="sources"
    />
  </div>
</template>

<script setup>
import { ref } from 'vue'
import QueryTypeSelector from './QueryTypeSelector.vue'
import DisplayModeSelector from './DisplayModeSelector.vue'
import ResultDisplay from './ResultDisplay.vue'

const currentQueryType = ref('text')
const currentQuery = ref('')
const llmAnswer = ref('')
const allResults = ref({})
const selectedDisplayMode = ref('text-focused')

const handleQueryTypeChange = (type) => {
  currentQueryType.value = type
}

const handleDisplayModeChange = (mode) => {
  selectedDisplayMode.value = mode
}
</script>
```

## ä¸ƒã€å‰ç«¯å±•ç¤ºæ¨¡å¼ç»„ä»¶

### 1. æ–‡æœ¬ä¼˜å…ˆå±•ç¤ºç»„ä»¶
```vue
<!-- TextFocusedDisplay.vue -->
<template>
  <div class="text-focused-display">
    <div class="text-content">
      <div class="llm-answer">{{ llmAnswer }}</div>
      <div class="text-results" v-if="textResults.length > 0">
        <h3>ğŸ“ ç›¸å…³æ–‡æœ¬å†…å®¹</h3>
        <div v-for="result in textResults" :key="result.id" class="text-result">
          <div class="text-preview">{{ result.content }}</div>
          <div class="text-meta">
            <span class="source">{{ result.document_name }}</span>
            <span class="page">ç¬¬{{ result.page_number }}é¡µ</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="side-content">
      <SourceAttribution :sources="sources" />
    </div>
  </div>
</template>
```

### 2. å›¾ç‰‡ä¼˜å…ˆå±•ç¤ºç»„ä»¶
```vue
<!-- ImageFocusedDisplay.vue -->
<template>
  <div class="image-focused-display">
    <div class="image-content">
      <div class="image-gallery">
        <div v-for="image in imageResults" :key="image.id" class="image-item">
          <img :src="image.image_path" :alt="image.caption" class="gallery-image" />
          <div class="image-info">
            <div class="image-caption">{{ image.caption }}</div>
            <div class="image-meta">
              <span class="source">{{ image.document_name }}</span>
              <span class="page">ç¬¬{{ image.page_number }}é¡µ</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="llm-answer">{{ llmAnswer }}</div>
    </div>
    
    <div class="side-content">
      <SourceAttribution :sources="sources" />
    </div>
  </div>
</template>
```

### 3. è¡¨æ ¼ä¼˜å…ˆå±•ç¤ºç»„ä»¶
```vue
<!-- TableFocusedDisplay.vue -->
<template>
  <div class="table-focused-display">
    <div class="table-content">
      <div class="table-results" v-if="tableResults.length > 0">
        <h3>ğŸ“Š ç›¸å…³è¡¨æ ¼æ•°æ®</h3>
        <div v-for="table in tableResults" :key="table.id" class="table-result">
          <div class="table-header">
            <h4>{{ table.title || 'è¡¨æ ¼æ•°æ®' }}</h4>
            <div class="table-meta">
              <span class="source">{{ table.document_name }}</span>
              <span class="page">ç¬¬{{ table.page_number }}é¡µ</span>
            </div>
          </div>
          <div class="table-body" v-html="table.table_html"></div>
        </div>
      </div>
      
      <div class="llm-answer">{{ llmAnswer }}</div>
    </div>
    
    <div class="side-content">
      <SourceAttribution :sources="sources" />
    </div>
  </div>
</template>
```

### 4. æ··åˆå¸ƒå±€å±•ç¤ºç»„ä»¶
```vue
<!-- HybridLayoutDisplay.vue -->
<template>
  <div class="hybrid-layout-display">
    <div class="main-content">
      <!-- æ ¹æ®å†…å®¹ç±»å‹åŠ¨æ€å¸ƒå±€ -->
      <div class="content-grid">
        <div v-if="hasImages" class="image-section">
          <ImageGallery :images="imageResults" />
        </div>
        
        <div v-if="hasTables" class="table-section">
          <TableDisplay :tables="tableResults" />
        </div>
        
        <div v-if="hasText" class="text-section">
          <TextResults :texts="textResults" />
        </div>
      </div>
      
      <div class="llm-answer">{{ llmAnswer }}</div>
    </div>
    
    <div class="side-content">
      <SourceAttribution :sources="sources" />
    </div>
  </div>
</template>
```

## å…«ã€æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 1. åˆ†ææ€§èƒ½ä¼˜åŒ–
- **å¼‚æ­¥åˆ†æ**ï¼šå†…å®¹åˆ†æå¼‚æ­¥è¿›è¡Œï¼Œä¸é˜»å¡ç”¨æˆ·äº¤äº’
- **ç¼“å­˜æœºåˆ¶**ï¼šå¯¹ç›¸åŒæŸ¥è¯¢çš„åˆ†æç»“æœè¿›è¡Œç¼“å­˜
- **è¶…æ—¶æ§åˆ¶**ï¼šè®¾ç½®åˆ†æè¶…æ—¶ï¼Œé¿å…é•¿æ—¶é—´ç­‰å¾…

### 2. å±•ç¤ºæ€§èƒ½ä¼˜åŒ–
- **ç»„ä»¶æ‡’åŠ è½½**ï¼šæŒ‰éœ€åŠ è½½å±•ç¤ºç»„ä»¶
- **è™šæ‹Ÿæ»šåŠ¨**ï¼šå¤§é‡å†…å®¹æ—¶ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- **å›¾ç‰‡æ‡’åŠ è½½**ï¼šå›¾ç‰‡æŒ‰éœ€åŠ è½½ï¼Œæå‡é¡µé¢æ€§èƒ½

### 3. ç›‘æ§æŒ‡æ ‡
- **åˆ†æå“åº”æ—¶é—´**ï¼šå†…å®¹åˆ†æçš„å“åº”æ—¶é—´
- **æ¨¡å¼é€‰æ‹©å‡†ç¡®ç‡**ï¼šå±•ç¤ºæ¨¡å¼é€‰æ‹©çš„å‡†ç¡®æ€§
- **ç”¨æˆ·æ»¡æ„åº¦**ï¼šç”¨æˆ·å¯¹å±•ç¤ºæ•ˆæœçš„æ»¡æ„åº¦

## ä¹ã€æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•
- **å†…å®¹åˆ†ææµ‹è¯•**ï¼šæµ‹è¯•å„ç§æŸ¥è¯¢å†…å®¹çš„åˆ†æå‡†ç¡®æ€§
- **æ¨¡å¼é€‰æ‹©æµ‹è¯•**ï¼šæµ‹è¯•å±•ç¤ºæ¨¡å¼é€‰æ‹©çš„é€»è¾‘æ­£ç¡®æ€§
- **ç»„ä»¶æ¸²æŸ“æµ‹è¯•**ï¼šæµ‹è¯•å„ç§å±•ç¤ºç»„ä»¶çš„æ¸²æŸ“æ•ˆæœ

### 2. é›†æˆæµ‹è¯•
- **ç«¯åˆ°ç«¯æµ‹è¯•**ï¼šæµ‹è¯•å®Œæ•´çš„æŸ¥è¯¢åˆ°å±•ç¤ºæµç¨‹
- **æ€§èƒ½æµ‹è¯•**ï¼šæµ‹è¯•å¤§é‡å†…å®¹æ—¶çš„æ€§èƒ½è¡¨ç°
- **å…¼å®¹æ€§æµ‹è¯•**ï¼šæµ‹è¯•ä¸åŒæµè§ˆå™¨çš„å…¼å®¹æ€§

### 3. æµ‹è¯•åœºæ™¯
- **å•ç±»æŸ¥è¯¢åœºæ™¯**ï¼šæµ‹è¯•å„ç§å•ç±»æŸ¥è¯¢çš„å±•ç¤ºæ•ˆæœ
- **æ™ºèƒ½æŸ¥è¯¢åœºæ™¯**ï¼šæµ‹è¯•æ™ºèƒ½æŸ¥è¯¢çš„è‡ªåŠ¨åˆ¤æ–­å‡†ç¡®æ€§
- **æ··åˆæŸ¥è¯¢åœºæ™¯**ï¼šæµ‹è¯•æ··åˆæŸ¥è¯¢çš„æ™ºèƒ½å¸ƒå±€æ•ˆæœ

## åã€éƒ¨ç½²ä¸è¿ç»´

### 1. éƒ¨ç½²è¦æ±‚
- **å‰ç«¯ç¯å¢ƒ**ï¼šVue 3.x + ç°ä»£æµè§ˆå™¨æ”¯æŒ
- **å¼€å‘å·¥å…·**ï¼šVS Code + Live Serveræ’ä»¶
- **æ„å»ºå·¥å…·**ï¼šå¯é€‰ä½¿ç”¨Viteè¿›è¡Œå¼€å‘æ„å»º

### 2. é…ç½®ç®¡ç†
- **é…ç½®æ–‡ä»¶**ï¼šv3_config.jsonä¸­çš„frontend.display_mode_selectionèŠ‚ç‚¹
- **è¿è¡Œæ—¶é…ç½®**ï¼šæ”¯æŒåŠ¨æ€è°ƒæ•´åˆ†æå‚æ•°å’Œé˜ˆå€¼
- **ç¯å¢ƒå˜é‡**ï¼šæ”¯æŒé€šè¿‡ç¯å¢ƒå˜é‡è¦†ç›–é…ç½®

### 3. ç›‘æ§å‘Šè­¦
- **æ€§èƒ½ç›‘æ§**ï¼šå±•ç¤ºæ¨¡å¼é€‰æ‹©çš„å“åº”æ—¶é—´
- **é”™è¯¯å‘Šè­¦**ï¼šå†…å®¹åˆ†æå¤±è´¥ã€æ¨¡å¼é€‰æ‹©å¼‚å¸¸ç­‰
- **ç”¨æˆ·è¡Œä¸ºç›‘æ§**ï¼šç”¨æˆ·å¯¹ä¸åŒå±•ç¤ºæ¨¡å¼çš„åé¦ˆ

## åä¸€ã€æ€»ç»“

### 1. è®¾è®¡äº®ç‚¹
- **ä¸‰å±‚æ™ºèƒ½åŒ¹é…**ï¼šä»ç”¨æˆ·æ§åˆ¶åˆ°ç³»ç»Ÿæ™ºèƒ½ï¼Œæ™ºèƒ½ç¨‹åº¦é€æ­¥æå‡
- **å†…å®¹ç‰¹å¾é©±åŠ¨**ï¼šå±•ç¤ºæ¨¡å¼é€‰æ‹©åŸºäºå†…å®¹ç‰¹å¾ï¼Œè€Œéå›ºå®šè§„åˆ™
- **åŠ¨æ€æ¨¡å¼è°ƒæ•´**ï¼šæ”¯æŒæ ¹æ®ç»“æœå†…å®¹åŠ¨æ€è°ƒæ•´å±•ç¤ºæ¨¡å¼
- **ç”¨æˆ·å‹å¥½è®¾è®¡**ï¼šä¿æŒç”¨æˆ·æ§åˆ¶çš„çµæ´»æ€§ï¼ŒåŒæ—¶æä¾›æ™ºèƒ½åŒ–è¾…åŠ©

### 2. æŠ€æœ¯ä¼˜åŠ¿
- **æ™ºèƒ½åˆ†æå‡†ç¡®**ï¼šåŸºäºå…³é”®è¯å’Œæ¨¡å¼è¯†åˆ«çš„æ™ºèƒ½å†…å®¹åˆ†æ
- **å±•ç¤ºæ¨¡å¼åŒ¹é…**ï¼šç¡®ä¿å±•ç¤ºæ¨¡å¼ä¸å†…å®¹ç‰¹å¾çš„æœ€ä½³åŒ¹é…
- **æ€§èƒ½è¡¨ç°ä¼˜ç§€**ï¼šå¼‚æ­¥åˆ†æã€ç¼“å­˜æœºåˆ¶ã€æ‡’åŠ è½½ç­‰ä¼˜åŒ–
- **æ‰©å±•æ€§å¼º**ï¼šæ”¯æŒæ–°å¢å±•ç¤ºæ¨¡å¼å’Œå†…å®¹ç±»å‹

### 3. åº”ç”¨ä»·å€¼
- **ç”¨æˆ·ä½“éªŒæå‡**ï¼šæ™ºèƒ½é€‰æ‹©æœ€é€‚åˆçš„å±•ç¤ºæ–¹å¼
- **å†…å®¹ç†è§£å¢å¼º**ï¼šç³»ç»Ÿèƒ½æ›´å¥½åœ°ç†è§£ç”¨æˆ·æ„å›¾å’Œå†…å®¹ç‰¹å¾
- **å±•ç¤ºæ•ˆæœä¼˜åŒ–**ï¼šç¡®ä¿æ¯ç§å†…å®¹ç±»å‹éƒ½èƒ½å¾—åˆ°æœ€ä½³å±•ç¤º
- **å¼€å‘æ•ˆç‡æå‡**ï¼šç»„ä»¶åŒ–è®¾è®¡ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•

### 4. ä¸V2çš„å¯¹æ¯”
| æ–¹é¢             | V2ç³»ç»Ÿ                 | V3ç³»ç»Ÿ               |
| ---------------- | ---------------------- | -------------------- |
| **å±•ç¤ºæ¨¡å¼é€‰æ‹©** | åŸºäºæ•°æ®ç»“æ„ç¡¬ç¼–ç åˆ¤æ–­ | åŸºäºå†…å®¹ç‰¹å¾æ™ºèƒ½é€‰æ‹© |
| **ç”¨æˆ·æ§åˆ¶**     | å›ºå®šå±•ç¤ºæ–¹å¼           | çµæ´»æ§åˆ¶+æ™ºèƒ½è¾…åŠ©    |
| **å†…å®¹ç†è§£**     | ç®€å•ç±»å‹è¯†åˆ«           | æ·±åº¦å†…å®¹ç‰¹å¾åˆ†æ     |
| **å±•ç¤ºæ•ˆæœ**     | ç»Ÿä¸€å¸ƒå±€               | åŠ¨æ€å¸ƒå±€+å†…å®¹é€‚é…    |
| **ç»´æŠ¤æˆæœ¬**     | é«˜ï¼ˆç¡¬ç¼–ç é€»è¾‘ï¼‰       | ä½ï¼ˆç»„ä»¶åŒ–+é…ç½®åŒ–ï¼‰  |

è¿™ä¸ªV3å±•ç¤ºæ¨¡å¼é€‰æ‹©æ¨¡å—è®¾è®¡å……åˆ†ä½“ç°äº†"æ™ºèƒ½ç¨‹åº¦é€’å¢"å’Œ"å†…å®¹ç‰¹å¾åŒ¹é…"çš„è®¾è®¡ç†å¿µï¼Œé€šè¿‡ä¸‰å±‚æ™ºèƒ½åŒ¹é…ç­–ç•¥ï¼Œæ—¢ä¿æŒäº†ç”¨æˆ·æ§åˆ¶çš„çµæ´»æ€§ï¼Œåˆæä¾›äº†æ™ºèƒ½åŒ–çš„è‡ªåŠ¨åˆ¤æ–­ï¼Œç¡®ä¿å±•ç¤ºæ¨¡å¼ä¸å†…å®¹ç‰¹å¾çš„æœ€ä½³åŒ¹é…ï¼Œä¸ºç”¨æˆ·æä¾›äº†æœ€ä¼˜çš„æŸ¥è¯¢ç»“æœå±•ç¤ºä½“éªŒã€‚