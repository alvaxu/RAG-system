
## �� RAG系统设计文档修改计划

### �� 总体策略
采用**分阶段、模块化**的修改策略，每次专注于1-2个相关模块，确保修改质量和一致性。

### �� 文档对应关系分析

| 现有设计文档 | 对应新文档 | 修改优先级 | 主要差异 |
|-------------|-----------|-----------|----------|
| **33.V3_RAG查询处理模块** | @4.智能查询流程分析.md + @3.混合查询流程分析.md | �� 高 | 查询处理架构、智能检测、混合处理流程 |
| **40.RAG系统text和table召回策略** | @1.向量数据库机制详解.md | 🔴 高 | 向量搜索机制、多策略召回、FAISS集成 |
| **41.RAG系统图片召回策略** | @1.向量数据库机制详解.md | �� 高 | 图片双重向量化、4层搜索策略、向量空间分离 |
| **42.RAG系统Reranking模块** | @5.RAG系统重排序机制详解.md | �� 中 | 多模型重排序、分数融合、性能优化 |
| **35.V3_RAG_LLM调用模块** | @2.RAG系统Prompt构建机制详解.md | �� 中 | Prompt构建、上下文管理、LLM调用流程 |

### 🗓️ 分阶段修改计划

#### **第一阶段：核心召回机制修改** (优先级：�� 高)
**目标**：更新向量数据库和召回策略相关文档

**涉及文档**：
- `40.RAG系统text和table召回策略详细设计文档.md`
- `41.RAG系统图片召回策略详细设计文档.md`

**需要阅读的内容**：
1. **代码文件**：
   - `rag_system/core/retrieval.py` (多策略召回实现)
   - `rag_system/core/vector_db_integration.py` (向量搜索集成)
   - `db_system/core/vector_store_manager.py` (FAISS管理)

2. **新文档内容**：
   - `@1.向量数据库机制详解.md` 的"三、向量数据库查询机制详解"部分
   - 重点关注：4层图片搜索策略、双重向量化、向量空间分离

**修改重点**：
- 更新图片召回策略：从简单描述改为4层策略（语义+视觉+关键词+扩展）
- 更新向量化机制：明确双重向量化（visual_embedding + description_embedding）
- 更新搜索策略：明确向量空间分离和模型选择
- 更新FAISS集成：基于实际LangChain FAISS实现

#### **第二阶段：查询处理架构修改** (优先级：�� 高)
**目标**：更新查询处理模块，反映智能查询和混合查询的实际实现

**涉及文档**：
- `33.V3_RAG查询处理模块详细设计文档.md`

**需要阅读的内容**：
1. **代码文件**：
   - `rag_system/core/query_processor.py` (查询处理器)
   - `rag_system/core/simple_smart_processor.py` (智能查询)
   - `rag_system/core/simple_hybrid_processor.py` (混合查询)
   - `rag_system/core/query_router.py` (查询路由)

2. **新文档内容**：
   - `@4.智能查询流程分析.md` 的完整内容
   - `@3.混合查询流程分析.md` 的完整内容

**修改重点**：
- 更新查询处理架构：QueryProcessor → QueryRouter → Smart/Hybrid Processor
- 更新智能查询流程：类型检测 → 置信度判断 → 单类型/混合处理
- 更新混合查询流程：并行检索 → 结果融合 → 去重排序
- 更新服务接口：UnifiedServices统一接口设计

#### **第三阶段：重排序和LLM调用修改** (优先级：�� 中)
**目标**：更新重排序和LLM调用相关文档

**涉及文档**：
- `42.RAG系统Reranking模块详细设计文档.md`
- `35.V3_RAG_LLM调用模块详细设计文档.md`

**需要阅读的内容**：
1. **代码文件**：
   - `rag_system/core/reranking_enhanced.py` (多模型重排序)
   - `rag_system/core/unified_services.py` (统一服务)
   - `rag_system/core/context_manager.py` (上下文管理)
   - `rag_system/core/prompt_manager.py` (提示词管理)

2. **新文档内容**：
   - `@5.RAG系统重排序机制详解.md` 的完整内容
   - `@2.RAG系统Prompt构建机制详解.md` 的完整内容

**修改重点**：
- 更新重排序机制：多模型融合、分数融合算法、性能优化
- 更新LLM调用：Prompt构建机制、上下文管理、表格内容增强
- 更新服务集成：UnifiedServices统一接口设计

#### **第四阶段：系统集成和配置修改** (优先级：🟢 低)
**目标**：更新系统集成和配置管理相关文档

**涉及文档**：
- `46.RAG系统系统集成与架构设计详细设计文档.md`
- `36.RAG系统配置管理详细设计文档.md`

**需要阅读的内容**：
1. **代码文件**：
   - `rag_system/api/main.py` (API入口)
   - `rag_system/api/routes.py` (路由定义)
   - `db_system/config/v3_config.json` (配置文件)

2. **新文档内容**：
   - 所有5个新文档的架构部分
   - 重点关注：整体架构、配置参数、服务集成

### 🔍 每个阶段的具体执行步骤

#### **阶段执行模板**：
1. **阅读阶段** (30分钟)
   - 阅读指定的代码文件
   - 阅读对应的新文档内容
   - 对比现有设计文档

2. **分析阶段** (20分钟)
   - 识别关键差异点
   - 确定需要修改的具体内容
   - 制定修改策略

3. **修改阶段** (40分钟)
   - 更新文档内容
   - 保持格式一致性
   - 确保技术准确性

4. **验证阶段** (10分钟)
   - 检查修改完整性
   - 验证技术逻辑
   - 确认格式规范

### 📝 修改原则

1. **基于实际代码**：所有修改必须基于实际代码实现，不进行推测
2. **保持文档结构**：维持现有设计文档的格式和结构
3. **技术准确性**：确保技术描述与实际实现一致
4. **渐进式更新**：每次只修改一个模块，确保质量
5. **版本标记**：在修改的文档中标记版本更新信息

### ⏰ 时间安排

- **第一阶段**：2小时 (召回机制修改)
- **第二阶段**：2小时 (查询处理修改)  
- **第三阶段**：1.5小时 (重排序和LLM修改)
- **第四阶段**：1小时 (系统集成修改)

**总计**：约6.5小时，建议分2-3天完成

这个计划确保了：
1. **有序进行**：按优先级和依赖关系排序
2. **聚焦修改**：每次专注1-2个模块
3. **质量保证**：每个阶段都有验证步骤
4. **可追溯性**：明确记录修改内容和原因

您觉得这个修改计划如何？需要我调整某些部分吗？