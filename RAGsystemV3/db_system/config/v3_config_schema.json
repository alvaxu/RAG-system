{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": ["version", "system", "paths", "document_processing", "vectorization"],
  "properties": {
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "system": {
      "type": "object",
      "required": ["mode"],
      "properties": {
        "mode": {
          "type": "string",
          "enum": ["auto", "new", "incremental"]
        },
        "log_level": {
          "type": "string",
          "enum": ["DEBUG", "INFO", "WARNING", "ERROR"]
        }
      }
    },
    "paths": {
      "type": "object",
      "required": ["input_pdf_dir", "mineru_output_dir", "final_image_dir", "vector_db_dir"],
      "properties": {
        "input_pdf_dir": {"type": "string"},
        "mineru_output_dir": {"type": "string"},
        "final_image_dir": {"type": "string"},
        "vector_db_dir": {"type": "string"},
        "temp_dir": {"type": "string"},
        "logs_dir": {"type": "string"},
        "config_backups_dir": {"type": "string"},
        "config_versions_dir": {"type": "string"}
      }
    },
    "document_processing": {
      "type": "object",
      "required": ["chunk_size", "chunk_overlap"],
      "properties": {
        "chunk_size": {
          "type": "integer",
          "minimum": 100,
          "maximum": 5000
        },
        "chunk_overlap": {
          "type": "integer",
          "minimum": 0,
          "maximum": 1000
        }
      }
    },
    "vectorization": {
      "type": "object",
      "required": ["text_embedding_model", "image_embedding_model"],
      "properties": {
        "text_embedding_model": {"type": "string"},
        "image_embedding_model": {"type": "string"}
      }
    },
    "image_processing": {
      "type": "object",
      "required": ["enable_enhancement"],
      "properties": {
        "enable_enhancement": {"type": "boolean"},
        "enhancement_model": {"type": "string"},
        "enhancement_model_api": {"type": "string"}
      }
    },
    "mineru": {
      "type": "object",
      "required": ["api_endpoint"],
      "properties": {
        "api_endpoint": {"type": "string"},
        "batch_size": {
          "type": "integer",
          "minimum": 1,
          "maximum": 50
        },
        "timeout": {
          "type": "integer",
          "minimum": 60,
          "maximum": 1800
        },
        "retry_count": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10
        },
        "poll_interval": {
          "type": "integer",
          "minimum": 5,
          "maximum": 60
        }
      }
    },
    "api_rate_limiting": {
      "type": "object",
      "required": ["enhancement_batch_size", "enhancement_delay_seconds", "vectorization_batch_size", "vectorization_delay_seconds"],
      "properties": {
        "enhancement_batch_size": {
          "type": "integer",
          "minimum": 1,
          "maximum": 20
        },
        "enhancement_delay_seconds": {
          "type": "integer",
          "minimum": 1,
          "maximum": 60
        },
        "vectorization_batch_size": {
          "type": "integer",
          "minimum": 1,
          "maximum": 50
        },
        "vectorization_delay_seconds": {
          "type": "integer",
          "minimum": 0,
          "maximum": 30
        },
        "max_retries": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10
        },
        "retry_delay_seconds": {
          "type": "integer",
          "minimum": 1,
          "maximum": 60
        },
        "enable_rate_limiting": {"type": "boolean"}
      }
    },
    "batch_processing": {
      "type": "object",
      "properties": {
        "enhancement_workers": {
          "type": "integer",
          "minimum": 1,
          "maximum": 8
        },
        "vectorization_workers": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10
        },
        "queue_size": {
          "type": "integer",
          "minimum": 10,
          "maximum": 1000
        },
        "timeout_seconds": {
          "type": "integer",
          "minimum": 60,
          "maximum": 1800
        },
        "progress_report_interval": {
          "type": "integer",
          "minimum": 5,
          "maximum": 60
        }
      }
    },
    "failure_handling": {
      "type": "object",
      "required": ["skip_failed_images", "generate_failure_report"],
      "properties": {
        "skip_failed_images": {"type": "boolean"},
        "max_retries": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10
        },
        "retry_delay_seconds": {
          "type": "integer",
          "minimum": 1,
          "maximum": 60
        },
        "continue_on_failure": {"type": "boolean"},
        "generate_failure_report": {"type": "boolean"},
        "failure_report_path": {"type": "string"},
        "mark_for_later_processing": {"type": "boolean"},
        "failure_report_format": {
          "type": "string",
          "enum": ["simple", "detailed"]
        }
      }
    },
    "storage": {
      "type": "object",
      "properties": {
        "backup_enabled": {"type": "boolean"},
        "backup_interval": {
          "type": "integer",
          "minimum": 1,
          "maximum": 168
        }
      }
    },
    "rag_system": {
      "type": "object",
      "properties": {
        "enabled": {"type": "boolean"},
        "version": {"type": "string"},
        "models": {
          "type": "object",
          "properties": {
            "llm": {
              "type": "object",
              "properties": {
                "model_name": {"type": "string"},
                "max_tokens": {"type": "integer"},
                "temperature": {"type": "number"},
                "system_prompt": {"type": "string"}
              }
            },
            "reranking": {
              "type": "object",
              "properties": {
                "model_name": {"type": "string"},
                "batch_size": {"type": "integer"},
                "similarity_threshold": {"type": "number"}
              }
            }
          }
        },
        "query_processing": {
          "type": "object",
          "properties": {
            "max_context_length": {"type": "integer"},
            "max_results": {"type": "integer"},
            "relevance_threshold": {"type": "number"},
            "cache_enabled": {"type": "boolean"},
            "cache_ttl": {"type": "integer"}
          }
        },
        "engines": {
          "type": "object",
          "properties": {
            "text_engine": {"type": "object"},
            "image_engine": {"type": "object"},
            "table_engine": {
              "type": "object",
              "properties": {
                "enabled": {"type": "boolean"},
                "max_results": {"type": "integer", "minimum": 1, "maximum": 100},
                "similarity_threshold": {"type": "number", "minimum": 0.0, "maximum": 1.0},
                "structure_search_threshold": {"type": "number", "minimum": 0.0, "maximum": 1.0},
                "keyword_search_threshold": {"type": "number", "minimum": 0.0, "maximum": 1.0},
                "expansion_search_threshold": {"type": "number", "minimum": 0.0, "maximum": 1.0}
              }
            },
            "hybrid_engine": {"type": "object"}
          }
        },
        "performance": {
          "type": "object",
          "properties": {
            "max_concurrent_queries": {"type": "integer"},
            "query_timeout": {"type": "integer"},
            "enable_monitoring": {"type": "boolean"}
          }
        },
        "prompt_templates": {
          "type": "object",
          "properties": {
            "general_qa": {"type": "string"},
            "table_qa": {"type": "string"},
            "image_qa": {"type": "string"}
          }
        },
        "preset_questions": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "config_file": {"type": "string"},
            "default_confidence": {"type": "number"},
            "default_question_type": {"type": "string"},
            "max_questions_per_type": {"type": "integer"}
          }
        },
        "memory_module": {
          "type": "object",
          "properties": {
            "enabled": {"type": "boolean"},
            "database_path": {"type": "string"},
            "compression": {
              "type": "object",
              "properties": {
                "enabled": {"type": "boolean"},
                "threshold": {"type": "integer", "minimum": 1, "maximum": 1000},
                "strategy": {"type": "string", "enum": ["semantic", "temporal", "importance"]},
                "max_compression_ratio": {"type": "number", "minimum": 0.1, "maximum": 1.0}
              }
            },
            "retrieval": {
              "type": "object",
              "properties": {
                "similarity_threshold": {"type": "number", "minimum": 0.0, "maximum": 1.0},
                "max_results": {"type": "integer", "minimum": 1, "maximum": 100},
                "time_decay_factor": {"type": "number", "minimum": 0.0, "maximum": 1.0}
              }
            },
            "session": {
              "type": "object",
              "properties": {
                "max_sessions_per_user": {"type": "integer", "minimum": 1, "maximum": 1000},
                "session_timeout": {"type": "integer", "minimum": 60, "maximum": 86400},
                "auto_cleanup": {"type": "boolean"}
              }
            },
            "vectorization": {
              "type": "object",
              "properties": {
                "model": {"type": "string"},
                "dimensions": {"type": "integer", "minimum": 128, "maximum": 4096},
                "chunk_type": {"type": "string"}
              }
            }
          }
        }
      }
    }
  }
}
