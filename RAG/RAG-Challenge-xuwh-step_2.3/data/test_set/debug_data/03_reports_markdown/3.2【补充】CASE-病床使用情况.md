# CASE: 病床使用情况

# CASE: 病床使用情况

# CASE：病床使用情况

数据表hospital_bed_usage_data.xlsx，具体见:https:/github.com/cystanford/dashboard_hospital_bed_usage数据表记录了香港各医院病床使用情况，包科室、病房、总病床数、占用病床数等核心指标。TO DO :

1）占用率：各医院及科室病床使用率图表  
2）空闲病床数：实时显示空闲病床数量及分布  
3）病床分布图：不同科室和区域的病床分布情况

# CASE: 病床使用情况

<html><body><table><tr><td>字段名</td><td>字段类型</td><td>说明</td></tr><tr><td>hospital_id</td><td>字符串</td><td>医院唯一标识符</td></tr><tr><td>hospital_name</td><td>字符串</td><td>医院名称</td></tr><tr><td>hospital_district</td><td>字符串</td><td>医院所在区域 (港岛、九龙、新界)</td></tr><tr><td>department_id</td><td>字符串</td><td>科室唯一标识符</td></tr><tr><td>department_name</td><td>字符串</td><td>科室名称</td></tr><tr><td>ward_id</td><td>字符串</td><td>病房唯一标识符</td></tr><tr><td>ward_name</td><td>字符串</td><td>病房名称</td></tr><tr><td>total_beds</td><td>整数</td><td>该病房的总病床数</td></tr><tr><td>occupied_beds</td><td>整数</td><td>已占用的病床数</td></tr><tr><td>available_beds</td><td>整数</td><td>可用的病床数</td></tr><tr><td>occupancy_rate</td><td>浮点数</td><td>病床占用率 (百分比，0-100)</td></tr><tr><td>timestamp</td><td>日期时间</td><td>数据记录时间</td></tr><tr><td>special_status</td><td>字符串</td><td>特殊状态标记 (如"正常"、“满床"、“临时关闭"等)</td></tr></table></body></html>

# CASE: 病床使用情况

<html><body><table><tr><td></td><td>osp</td><td></td><td></td><td>ward_id</td><td>ward_name</td><td>total_bedsoccbupied</td><td></td><td></td><td>available_occupancy_rat</td><td> timestamp</td><td>special_status</td></tr><tr><td>HH001</td><td>玛丽医院港岛</td><td>DEPT01</td><td>内科</td><td></td><td>H101_DEPT内科普通病房1号</td><td>23</td><td>23</td><td></td><td>99</td><td>2023-12-0满床</td><td></td></tr><tr><td>HH001</td><td>玛丽医院港岛</td><td>DEPT01</td><td>内科</td><td>01_W2</td><td>HH001_DEPT内科普通病房2号</td><td>20</td><td>20</td><td>0</td><td>99</td><td>2023-12-01满床 00:00:00</td><td></td></tr><tr><td>HH001</td><td>玛丽医院港岛</td><td>DEPT01</td><td>内科</td><td>01_W3</td><td>HH001_DEPT内科普通病房3号</td><td>28</td><td>28</td><td>0</td><td>99</td><td>2023-12-01满床 00:00:00</td><td></td></tr><tr><td>HH001</td><td>玛丽医院 港岛</td><td>DEPT02</td><td>外科</td><td></td><td>H201_DEPT外科特需病房1号</td><td>6</td><td>6</td><td>0</td><td>94.69</td><td>2023-12-0正常</td><td></td></tr><tr><td>HH001</td><td>玛丽医院港岛</td><td>DEPT03</td><td>儿科</td><td></td><td>H001_DEPT儿科普通病房1号</td><td>37</td><td>35</td><td>2</td><td>94.81</td><td>2023-12-0正常</td><td></td></tr><tr><td>HH001</td><td>玛丽医院港岛</td><td>DEPT04</td><td>妇产科</td><td>04_W1</td><td>HH001_DEPT妇产科普通病房1号</td><td>21</td><td></td><td></td><td>0</td><td>2023-12-01临时关闭 00:00:00</td><td></td></tr><tr><td>HH001</td><td>玛丽医院港岛</td><td>DEPT04</td><td>妇产科</td><td>04_W2</td><td>HH001_DEPT妇产科普通病房2号</td><td>26</td><td>20</td><td>6</td><td>76.87</td><td>2023-12-01正常 00:00:00</td><td></td></tr><tr><td>HH001</td><td>玛丽医院港岛</td><td>DEPT05</td><td>骨科</td><td></td><td>H01_DEPT骨科普通病房1号</td><td>20</td><td>19</td><td>1</td><td>93.44</td><td>2023-12-01正常</td><td></td></tr><tr><td>HH001</td><td>玛丽医院港岛</td><td>DEPT05</td><td>骨科</td><td>05_W2</td><td>HH001_DEPT骨科普通病房2号</td><td>40</td><td>37</td><td>3</td><td>91.78</td><td>2023-12-01正常 00:00:00</td><td></td></tr><tr><td>HH001</td><td>玛丽医院港岛</td><td>DEPT05</td><td>骨科</td><td></td><td>H01_DEPT科普通病房3号</td><td>33</td><td>29</td><td>4</td><td>89.35</td><td>2023-12-01常</td><td></td></tr><tr><td>HH001</td><td>玛丽医院港岛</td><td>DEPT06</td><td>心胸外科</td><td></td><td>H01DEPT心胸外科特需病房1号</td><td>7</td><td>7</td><td>0</td><td>99</td><td>2023-12-01满床</td><td></td></tr><tr><td>HH001</td><td>玛丽医院 港岛</td><td>DEPT06</td><td>心胸外科</td><td>06_W2</td><td>HH001DEPT心胸外科普通病房2号</td><td>20</td><td>19</td><td>1</td><td>94.87</td><td>2023-12-01正常</td><td></td></tr><tr><td>……</td><td></td><td></td><td>……·</td><td></td><td>…·…·</td><td></td><td></td><td></td><td></td><td></td><td></td></tr></table></body></html>

hospital_bed_usage_data.xlsx

# CASE: 病床使用情况

编写Python，查看hospital_bed_usage_data.xlsx的字段和前2o行数据

# $\scriptstyle = = { \frac { } { } }$ 数据字段名称 $\scriptstyle = = { \frac { } { } }$

1. hospital_id   
2.hospital_name   
3.hospital_district   
4.department_id   
5.department_name   
6.ward_id   
7.ward_name   
8.total beds   
9.occupied_beds   
10.available beds   
11.occupancy_rate   
12. timestamp   
13.special_status

$\scriptstyle = = { \frac { } { } }$ 前20行数据 $\scriptstyle = = { \frac { } { } }$ hospital_id hospital_name hospital_district ..

# CASE: 病床使用情况

# 帮我计算：各医院及科室病床使用率

# $\scriptstyle = = { \frac { } { } }$ 各医院及科室病床使用率 $\scriptstyle = = { \frac { } { } }$

hospital_name department_name occupancy_rate 计算病床使用率   
0 东区尤德夫人那打素医院 儿科 91.618351 92.03   
1 东区尤德夫人那打素医院 内科 98.858079 99.88   
2 东区尤德夫人那打素医院 外科 83.877139 83.40   
3 东区尤德夫人那打素医院 妇产科 78.405726 78.75   
4 东区尤德夫人那打素医院 康复科 84.391907 84.63   
233 葛量洪医院 老年科 96.179615 96.66   
234 葛量洪医院 耳鼻喉科 72.270305 73.38   
235 葛量洪医院 肿瘤科 94.620336 95.55   
236 葛量洪医院 重症监护科 84.437119 84.63   
237 葛量洪医院 骨科 91.043842 91.33

[238 rows x 4 columns]$\scriptstyle = = { \frac { } { } }$ 各医院病床使用率 $\scriptstyle = = { \frac { } { } }$

hospital_name occupied_beds total_beds 病床使用率  
0 东区尤德夫人那打素医院 128125 147598 86.81  
1 九龙医院 58059 69184 83.92  
2 伊利沙伯医院 123603 146531 84.35  
3 北区医院 52736 69048 76.38  
4 博爱医院 53719 70033 76.71  
5 基督教联合医院 57444 68433 83.94  
6 大埔那打素医院 53172 68731 77.36  
7 威尔斯亲王医院 113419 147919 76.68  
8 屯门医院 93625 122455 76.46  
9 广华医院 103504 123235 83.99  
10 律敦治医院 106683 122417 87.15  
11 玛丽医院 129366 148135 87.33  
12 玛嘉烈医院 59213 70645 83.82  
13 葛量洪医院 59624 68731 86.75

# CASE: 病床使用情况

![](images/6dc20ccce276ce5b63bb12ddee22a5dfb07486dcbf5106f68c324fbcc621c583.jpg)  
使用适合的可视化图表进行呈现

# CASE: 病床使用情况

![](images/b158dcfe18e429b939b5dfabb5c40c8a542ff69f105fa3346da2fabb0e947ede.jpg)

![](images/b84c7377047026d13ea5a4d8e8fb460854507edc7b7c928b770313caa5d2162d.jpg)

Thinking: 如何完成可视化大屏， 实现更多维度的可视化分析？

# CASE: 病床使用情况

# 图表中的中文有乱码

![](images/585f9d00eaa3d1a5cc62529658ed07302012a8df35942daf8f24016f77eb7caf.jpg)  
香港疫情每日新增与累计确诊数据

# CASE: 病床使用情况

# 我想创建可视化大屏，包括但不限于：

1）占用率：各医院及科室病床使用率图表  
2）空闲病床数：实时显示空闲病床数量及分布  
3）病床分布图：不同科室和区域的病床分布情况  
==3  
帮我安排有哪些适合的图表，整体数量要少（不超过5个，不需要地图）如何在一个可视化大屏上进行呈现，  
可以使用flask $^ +$ echarts

我会帮您设计一个简洁的医院病床使用情况可视化大屏，使用Flask和ECharts来展示。以下是建议的设计方案：...

# CASE: 病床使用情况

![](images/64620dfecb517118474a78a82abca5e2b571799293bb84dcc590e158c547de71.jpg)

大屏搭建出来了，但

# CASE: 病床使用情况

![](images/31afcd2d783b5d90481e217277ec25e5dd338756303e5d2feccecc5ecf75e7f4.jpg)

![](images/46ef7e09d2b3cce79365545192d8f0311463d741c58e38032118243e614197c2.jpg)  
香港医院病床使用情况实时监控  
各医院病床使用率  
医院-科室病床使用率热力图

![](images/b2017f778e263ea46b3dce7713ece4c0338f4a245b3fbe116c8ad3c21ea36b52.jpg)  
主要科室病床使用率

<html><body><table><tr><td rowspan="6">玛嘉烈医院 律敦治医院</td><td colspan="9"></td></tr><tr><td>屯门医院 85.5%</td><td>72.5%</td><td></td><td>84.6%</td><td>81.1%</td><td>80.2%</td><td>72.3%</td><td>85.2%</td><td></td></tr><tr><td>广华医院</td><td>89.9%</td><td>76.9%</td><td>89.9%</td><td>86.8%</td><td>87.3%</td><td></td><td>77.8%</td><td>89.8%</td></tr><tr><td>伊利沙伯医院</td><td>80.0%</td><td>67.0%</td><td>78.8%</td><td>77.0%</td><td>75.5%</td><td>69.4%</td><td></td><td>78.1%</td></tr><tr><td>东区尤德夫人那打素医院</td><td>92.6%</td><td>78.7%</td><td>92.0%</td><td>89.2%</td><td>87.3%</td><td>78.8%</td><td>92.7%</td><td></td></tr><tr><td>威尔斯亲王医院 83.8%</td><td></td><td>72.7%</td><td>83.4%</td><td>81.8%</td><td>83.0%</td><td>72.8%</td><td></td><td>85.1%</td></tr><tr><td>玛丽医院</td><td>99.9%</td><td>96.8%</td><td>99.9%</td><td></td><td>99.7%</td><td>99.3%</td><td>96.2%</td><td>100.0%</td></tr><tr><td colspan="9">内科 外料 儿科 妇产科</td></tr></table></body></html>

# CASE: 病床使用情况

# 图表加载时间太慢，应该是后台在计算，如何提升图表显示的效率

为了提升图表显示效率，我会从以下几个方面优化代码：

1.使用数据缓存机制减少重复计算  
2.优化数据聚合和过滤逻辑  
3.减少不必要的数据传输  
4.延迟加载图表

app.py +182 -122

from flask import Flask，render_template，jsonify   
import pandas as pd   
import json   
import time   
from functools import lru_cache

app $\mathbf { \sigma } = \mathbf { \sigma }$ Flask(__name#读取Excel数据

def load_data(): df $\mathbf { \sigma } = \mathbf { \sigma }$ pd.read_excel('hospital_bed_usage_data.xlsx') return df

# CASE: 病床使用情况

![](images/837dfa1e0d253d03ef9b0292482598c39e90caf51557b21e3649430fa0e5354b.jpg)  
香港医院病床使用情况实时监控

# CASE: 病床使用情况

现在还是显示速度很慢。.xlsx数据不会经常发生变化，最好提前计算出来，如果.xls×没有更新，就用之前的计算结果显示

没有提前生成或计算好么，还是一直在等待

还是第一次加载速度很慢，需要提前把需要的数据计算好（可以是另外一个python文件，将结果保存起来）。下载使用app.py的时候，如果计算结果的时间晚于.xlsx数据的时间，就可以直接使用

帮我查看为什么一直是加载中，数据没有显示出来。最开始的时候没有做加载中的过程，是可以显示出来数据的 (就是速度慢一些)

@app.py@index.html查看下代码，和加载中的逻辑，现在数据不都是提前计算好了么，应该可以直接调取之前计算好的结果

# CASE: 病床使用情况

![](images/45d022c4951f6faf60b78ff98e54301d0b0a5e27296d3715e7dbe24a71a4647c.jpg)

Cursor检索召回相关的代码片段并对app.py进行修改

# CASE: 病床使用情况

还是在加载中，能否去掉加载中，直接将之前计算好的结果显示出来应该是放到了本地的某个文件中

根据我的修改，现在系统能够直接调取预计算的结果了。修改主要包括：

1.后端部分 (app.py)

·修改了API路由函数，让其在未找到数据时返回空数据结构而非"加载中"状态·优化了启动逻辑，应用启动时会立即加载缓存文件中的数据

2.前端部分 (index.html)

·隐藏了所有加载遮罩，默认不显示加载状态·简化了图表初始化流程，不再分批加载数据，而是一次性加载所有图表数据·新增了hideAllLoadingOverlays(）函数来隐藏所有加载提示·新增了loadAllChartData（）函数来同时加载所有图表数据·修改了状态检查函数，不再显示加载遮罩，只更新状态指示器

3.手动创建了预计算缓存文件

·在data_cache目录创建了data_cache.pkl和metadata.json文件·包含了所有需要的图表数据

现在当你访问应用时，会直接显示之前计算好的数据，不再显示"加载中"。即使数据正在计算或更新，用户界面也会显示已有的数据，提供更好的用户体验。

你可以通过浏览器访问http://127.0.0.1:5000来查看应用，所有图表应该能够立即显示，而不会出现加载状态

# CASE: 病床使用情况

![](images/04db4395bf3b327908067c898904f57737f3b2d7ddf1179b23938a81cd7de161.jpg)

# 打卡：病床使用情况

使用hospital_bed_usage_data.xlsx搭建疫情实时监控大屏，可以使用Flask $^ +$ Echarts

1.占用率：各医院及科室病床使用率图表  
2.空闲病床数：实时显示空闲病床数量及分布  
3.病床分布图：不同科室和区域的病床分布情况

![](images/c46222619071ab6d1a73050647b756c07c92f05ca7e09c32b619b97f03e5a51d.jpg)

# Thank You Using data to solve problems