{
  "metainfo": {
    "sha1": "Aitraining",
    "sha1_name": "Aitraining",
    "pages_amount": 10,
    "text_blocks_amount": 45,
    "tables_amount": 0,
    "pictures_amount": 0,
    "equations_amount": 0,
    "footnotes_amount": 0,
    "company_name": "AI应用开发",
    "file_name": "8.2-vanna使用"
  },
  "content": {
    "chunks": [
      {
        "page": 1,
        "length_tokens": 3,
        "text": "Vanna使用",
        "id": 0,
        "type": "text"
      },
      {
        "page": 2,
        "length_tokens": 0,
        "text": "",
        "id": 1,
        "type": "image"
      },
      {
        "page": 3,
        "length_tokens": 3,
        "text": "Vanna特点",
        "id": 2,
        "type": "text"
      },
      {
        "page": 3,
        "length_tokens": 5,
        "text": "Vanna特点: ",
        "id": 3,
        "type": "text"
      },
      {
        "page": 3,
        "length_tokens": 56,
        "text": "·开源与可定制化：Vanna 提供完整的 Python库，支持本地化部署，允许用户自定义大语言模型（LLM）、向量数据库（VectorDB）和关系型数据库（如MySQL、PostgreSQL等）。",
        "id": 4,
        "type": "text"
      },
      {
        "page": 3,
        "length_tokens": 49,
        "text": "·RAG 增强的准确性：通过检索增强生成技术，结合数据库的元数据(如DDL语句、表注释、示例 SQL等)训练模型，显著提升复杂查询的准确率。",
        "id": 5,
        "type": "text"
      },
      {
        "page": 3,
        "length_tokens": 36,
        "text": "·多场景支持：适用于企业数据分析、智能客服、电商搜索、金融报告生成等场景，非技术人员可通过自然语言直接查询数据库。",
        "id": 6,
        "type": "text"
      },
      {
        "page": 3,
        "length_tokens": 44,
        "text": "·灵活的基础设施：支持多种LLM（如OpenAI、本地部署的Ollama）、向量数据库（如ChromaDB），并可扩展至非默认支持的数据库。",
        "id": 7,
        "type": "text"
      },
      {
        "page": 4,
        "length_tokens": 5,
        "text": "Vanna 工作原理",
        "id": 8,
        "type": "text"
      },
      {
        "page": 4,
        "length_tokens": 5,
        "text": "Vanna工作原理",
        "id": 9,
        "type": "text"
      },
      {
        "page": 4,
        "length_tokens": 6,
        "text": "·训练 RAG 模型",
        "id": 10,
        "type": "text"
      },
      {
        "page": 4,
        "length_tokens": 46,
        "text": "输入数据库的元数据（如INFORMATION_SCHEMA）、DDL语句、文档或示例 SQL。  \n模型将这些信息转换为向量并存储到向量库中，用于后续检索。",
        "id": 11,
        "type": "text"
      },
      {
        "page": 4,
        "length_tokens": 4,
        "text": "·生成SQL ",
        "id": 12,
        "type": "text"
      },
      {
        "page": 4,
        "length_tokens": 45,
        "text": "用户提问时，系统从向量库中检索相关上下文，组装成Prompt发送给LLM。  \nLLM生成SQL后，自动执行并返回结果（表格或图表）。",
        "id": 13,
        "type": "text"
      },
      {
        "page": 5,
        "length_tokens": 4,
        "text": "Vanna使用步骤",
        "id": 14,
        "type": "text"
      },
      {
        "page": 5,
        "length_tokens": 5,
        "text": "Vanna使用步骤:",
        "id": 15,
        "type": "text"
      },
      {
        "page": 5,
        "length_tokens": 3,
        "text": "vanna安装",
        "id": 16,
        "type": "text"
      },
      {
        "page": 5,
        "length_tokens": 26,
        "text": "pip install vanna，可选扩展如vanna[chromadb,ollama,mysql]支持本地化部署。",
        "id": 17,
        "type": "text"
      },
      {
        "page": 5,
        "length_tokens": 21,
        "text": "连接数据库自定义run_sql方法（如 MySQL需通过 mysql.connector 返回 Pandas DataFrame）。",
        "id": 18,
        "type": "text"
      },
      {
        "page": 5,
        "length_tokens": 52,
        "text": "·训练模型  \n通过DDL、文档或SQL示例训练，例如：  \nvn.train(ddl $= ^ { \\mathsf { \\Gamma } }$ \"CREATE TABLE uSers (id INT PRIMARY KEY, name VARCHAR(100))\")",
        "id": 19,
        "type": "text"
      },
      {
        "page": 5,
        "length_tokens": 21,
        "text": "提问与查询调用vn.ask(\"查询销售额最高的产品\")，生成并执行SQL。",
        "id": 20,
        "type": "text"
      },
      {
        "page": 6,
        "length_tokens": 7,
        "text": "Vanna使用 (ask函数)",
        "id": 21,
        "type": "text"
      },
      {
        "page": 6,
        "length_tokens": 2,
        "text": "ask函数",
        "id": 22,
        "type": "text"
      },
      {
        "page": 6,
        "length_tokens": 53,
        "text": "作用：用户通过自然语言提问时调用此函数，它是查询的核心入口，会依次调用generate_sql、run_sqI、generate_plotly_code、get_plotly_figure四个函数来完成整个查询及可视化的过程。",
        "id": 23,
        "type": "text"
      },
      {
        "page": 6,
        "length_tokens": 3,
        "text": "工作流程:",
        "id": 24,
        "type": "text"
      },
      {
        "page": 6,
        "length_tokens": 84,
        "text": "·首先将用户的问题转换成向量表示，然后在向量数据库中检索与问题语义最相似的DDL语句、文档和SQL查询。  \n·将检索到的信息和用户的问题一起提供给LLM，生成对应的SQL查询。  \n·执行生成的sQL查询，并将查询结果以表格和Plotly图表的形式返回给用户。",
        "id": 25,
        "type": "text"
      },
      {
        "page": 6,
        "length_tokens": 20,
        "text": "比如：vn.ask(\"查询heros表中 英雄攻击力前5名的英雄\")",
        "id": 26,
        "type": "text"
      },
      {
        "page": 7,
        "length_tokens": 8,
        "text": "Vanna使用 (generate_sql函数)",
        "id": 27,
        "type": "text"
      },
      {
        "page": 7,
        "length_tokens": 3,
        "text": "generate_sql函数",
        "id": 28,
        "type": "text"
      },
      {
        "page": 7,
        "length_tokens": 18,
        "text": "作用：根据用户输入的自然语言问题，生成对应的sQL语句。",
        "id": 29,
        "type": "text"
      },
      {
        "page": 7,
        "length_tokens": 3,
        "text": "工作流程:",
        "id": 30,
        "type": "text"
      },
      {
        "page": 7,
        "length_tokens": 24,
        "text": "，调用get_similar_question_sql函数，在向量数据库中检索与问题相似的sql/question对。",
        "id": 31,
        "type": "text"
      },
      {
        "page": 7,
        "length_tokens": 25,
        "text": "·调用get_related_ddl函数，在向量数据库中检索与问题相似的建表语句ddl。",
        "id": 32,
        "type": "text"
      },
      {
        "page": 7,
        "length_tokens": 22,
        "text": "·调用get_related_documentation函数，在向量数据库中检索与问题相似的文档。",
        "id": 33,
        "type": "text"
      },
      {
        "page": 7,
        "length_tokens": 29,
        "text": "·调用get_sql_prompt函数，结合上述检索到的信息生成prompt，然后将prompt提供给LLM，生成sQL语句。",
        "id": 34,
        "type": "text"
      },
      {
        "page": 7,
        "length_tokens": 23,
        "text": "比如：sql=vn.generate_sql(\"查询heros表中 英雄攻击力前5名的英雄\")",
        "id": 35,
        "type": "text"
      },
      {
        "page": 8,
        "length_tokens": 8,
        "text": "Vanna使用 (generate_sql函数)",
        "id": 36,
        "type": "text"
      },
      {
        "page": 8,
        "length_tokens": 3,
        "text": "run_sql函数",
        "id": 37,
        "type": "text"
      },
      {
        "page": 8,
        "length_tokens": 17,
        "text": "作用：执行generate_sql函数生成的sQL语句，并返回查询结果。",
        "id": 38,
        "type": "text"
      },
      {
        "page": 8,
        "length_tokens": 23,
        "text": "工作流程：将生成的SQL语句发送到连接的数据库中执行，获取并返回查询结果。",
        "id": 39,
        "type": "text"
      },
      {
        "page": 8,
        "length_tokens": 2,
        "text": "比如:",
        "id": 40,
        "type": "text"
      },
      {
        "page": 8,
        "length_tokens": 23,
        "text": "sql $\\ c =$ vn.generate_sql(\"查询heros表中英雄攻击力前5名的英雄\") ",
        "id": 41,
        "type": "text"
      },
      {
        "page": 8,
        "length_tokens": 5,
        "text": "vn.run_sql(sql)",
        "id": 42,
        "type": "text"
      },
      {
        "page": 9,
        "length_tokens": 6,
        "text": "打卡：Text2SQL",
        "id": 43,
        "type": "text"
      },
      {
        "page": 9,
        "length_tokens": 70,
        "text": "在你的工作中，都有哪些SQL查询的场景？（对应的数据表、SQL查询语句，LLM能否完  \n成，是否有临时SQL的需求)  \n使用LangChain或者vanna或者自己调用大模型来完成  \n可以使用heros数据表，或者用自己本地的MySQL数据表",
        "id": 44,
        "type": "text"
      },
      {
        "page": 10,
        "length_tokens": 8,
        "text": "Thank You Using data to solve problems ",
        "id": 45,
        "type": "text"
      }
    ]
  }
}